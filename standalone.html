<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸš¨ WAKEUPG - La Sveglia che NON Puoi Spegnere! v2.0 - CACHE BUST</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="ðŸš¨ LA SVEGLIA CHE NON PUOI SPEGNERE! Challenge reali, zero scuse, 100% efficacia. Trasforma la tua mattina in una vittoria! v2.0 - Admin completo con pagamenti!">
    <meta name="theme-color" content="#1976d2">
    <!-- Cache bust v2.0 -->
    <meta name="version" content="2.0.0">
    <meta name="build" content="2024-10-14-21:30">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="WAKEUPG">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512x512.png">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    
    <!-- Styles -->
    <style>
        :root {
            /* Vibrant, attention-grabbing colors for sleepers */
            --primary-color: #ff4444;
            --primary-dark: #d32f2f;
            --primary-light: #ff6b6b;
            --secondary-color: #ff6b35;
            --accent-color: #ffd93d;
            --success-color: #00d4aa;
            --error-color: #ff1744;
            --warning-color: #ff9800;
            --info-color: #2196f3;
            
            /* High contrast backgrounds */
            --background-color: #0a0a0a;
            --surface-color: #1a1a1a;
            --surface-variant: #2a2a2a;
            --surface-elevated: #3a3a3a;
            
            /* High contrast text */
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-disabled: #666666;
            --text-accent: #ffd93d;
            
            /* Neon borders */
            --border-color: #333333;
            --border-light: #444444;
            --border-neon: #ff4444;
            
            /* Dramatic shadows */
            --shadow: 0 4px 20px rgba(255, 68, 68, 0.3);
            --shadow-hover: 0 8px 30px rgba(255, 68, 68, 0.4);
            --shadow-elevated: 0 12px 40px rgba(255, 68, 68, 0.5);
            --shadow-neon: 0 0 20px rgba(255, 68, 68, 0.6);
            
            /* Rounded corners */
            --border-radius: 16px;
            --border-radius-sm: 12px;
            --border-radius-lg: 24px;
            
            /* Smooth transitions */
            --transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --transition-fast: all 0.2s ease;
            --transition-bounce: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            
            /* Eye-catching gradients */
            --gradient-primary: linear-gradient(135deg, #ff4444 0%, #ff6b6b 50%, #ffd93d 100%);
            --gradient-success: linear-gradient(135deg, #00d4aa 0%, #00ffcc 100%);
            --gradient-warning: linear-gradient(135deg, #ff6b35 0%, #ff9800 100%);
            --gradient-error: linear-gradient(135deg, #ff1744 0%, #ff4444 100%);
            --gradient-neon: linear-gradient(135deg, #ff4444 0%, #ffd93d 50%, #00d4aa 100%);
            --gradient-dark: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--gradient-dark);
            background-attachment: fixed;
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 68, 68, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 211, 61, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(0, 212, 170, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        #app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .navbar {
            background: var(--gradient-dark);
            padding: 1.5rem 2rem;
            box-shadow: var(--shadow-neon);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
            border-bottom: 2px solid var(--border-neon);
            border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg);
            position: relative;
            overflow: hidden;
        }

        .navbar::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 68, 68, 0.2), transparent);
            animation: shimmer 3s infinite;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .nav-brand h1 {
            background: var(--gradient-neon);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2rem;
            font-weight: 900;
            letter-spacing: -0.02em;
            text-shadow: 0 0 20px rgba(255, 68, 68, 0.5);
            animation: textGlow 2s ease-in-out infinite alternate;
        }

        .nav-brand::before {
            content: "ðŸš¨";
            font-size: 2rem;
            animation: alarmPulse 1s infinite;
            filter: drop-shadow(0 0 10px rgba(255, 68, 68, 0.8));
        }

        @keyframes textGlow {
            from { text-shadow: 0 0 20px rgba(255, 68, 68, 0.5); }
            to { text-shadow: 0 0 30px rgba(255, 68, 68, 0.8), 0 0 40px rgba(255, 211, 61, 0.3); }
        }

        @keyframes alarmPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .nav-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-primary, .btn-secondary, .btn-icon {
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-neon);
            border: 2px solid var(--border-neon);
            position: relative;
            overflow: hidden;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: var(--shadow-elevated);
            border-color: var(--accent-color);
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:active {
            transform: translateY(-1px) scale(1.02);
        }

        .btn-secondary {
            background: var(--surface-color);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            box-shadow: var(--shadow);
        }

        .btn-secondary:hover {
            background: var(--surface-variant);
            border-color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: var(--shadow-hover);
        }

        .btn-icon {
            padding: 0.5rem;
            background: transparent;
            color: var(--text-secondary);
            font-size: 1.2rem;
        }

        .btn-icon:hover {
            color: var(--primary-color);
            background: var(--background-color);
        }

        .main-content {
            flex: 1;
            padding: 1rem;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }

        .alarm-status {
            background: var(--surface-color);
            padding: 2rem;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            text-align: center;
            border: 1px solid var(--border-light);
            position: relative;
            overflow: hidden;
        }

        .alarm-status::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .status-indicator {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--gradient-success);
            margin: 0 auto 1rem;
            animation: pulse 2s infinite;
            box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.4);
        }

        .status-indicator.ringing {
            background: var(--gradient-error);
            animation: alarm-pulse 0.5s infinite;
            box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.4);
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 1; 
                transform: scale(1);
            }
            50% { 
                opacity: 0.7; 
                transform: scale(1.05);
            }
        }

        @keyframes alarm-pulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.4);
            }
            50% { 
                transform: scale(1.2);
                box-shadow: 0 0 0 10px rgba(244, 67, 54, 0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -200px 0;
            }
            100% {
                background-position: calc(200px + 100%) 0;
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .fade-in-scale {
            animation: fadeInScale 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .bounce-in {
            animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        .modal {
            animation: fadeInScale 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal-overlay {
            animation: fadeInScale 0.2s ease-out;
        }

        /* Alarm active state */
        body.alarm-active {
            animation: alarm-glow 2s infinite;
        }

        body.alarm-active::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(244, 67, 54, 0.1) 0%, transparent 70%);
            pointer-events: none;
            z-index: -1;
            animation: pulse 2s infinite;
        }

        .status-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Hero Section */
        .hero-section {
            background: var(--gradient-dark);
            padding: 3rem 2rem;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-neon);
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 2px solid var(--border-neon);
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 20%, rgba(255, 68, 68, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(255, 211, 61, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .hero-title {
            font-size: 2.5rem;
            font-weight: 900;
            background: var(--gradient-neon);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            text-shadow: 0 0 30px rgba(255, 68, 68, 0.5);
            animation: textGlow 2s ease-in-out infinite alternate;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin-top: 2rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background: var(--surface-elevated);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-neon);
            min-width: 120px;
            transition: var(--transition);
        }

        .stat-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-neon);
        }

        .stat-number {
            display: block;
            font-size: 2rem;
            font-weight: 900;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            display: block;
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 0.5rem;
        }

        /* Progress Section */
        .progress-section {
            background: var(--gradient-dark);
            padding: 2rem;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-neon);
            margin-bottom: 2rem;
            border: 2px solid var(--border-neon);
            position: relative;
            overflow: hidden;
        }

        .progress-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-neon);
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .progress-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            background: var(--surface-elevated);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-neon);
            transition: var(--transition);
        }

        .progress-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-neon);
            border-color: var(--accent-color);
        }

        .progress-icon {
            font-size: 2rem;
            filter: drop-shadow(0 0 10px rgba(255, 68, 68, 0.5));
        }

        .progress-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .progress-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .progress-value {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .achievement-badge {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            background: var(--gradient-success);
            border-radius: var(--border-radius);
            border: 2px solid var(--success-color);
            text-align: center;
            justify-content: center;
            animation: bounceIn 1s ease-out;
        }

        .badge-icon {
            font-size: 2rem;
            filter: drop-shadow(0 0 10px rgba(0, 212, 170, 0.5));
        }

        .badge-text {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        section {
            background: var(--surface-color);
            padding: 2rem;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid var(--border-light);
            position: relative;
            overflow: hidden;
        }

        section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
        }

        section h2 {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.01em;
        }

        .alarms-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .alarm-item {
            background: var(--surface-color);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-light);
            border-left: 4px solid var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .alarm-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient-primary);
        }

        .alarm-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
            border-color: var(--primary-light);
        }

        .alarm-item.active {
            border-left-color: var(--error-color);
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
            animation: alarm-glow 2s infinite;
        }

        @keyframes alarm-glow {
            0%, 100% { box-shadow: var(--shadow); }
            50% { box-shadow: 0 4px 20px rgba(244, 67, 54, 0.3); }
        }

        .alarm-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .alarm-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-accent);
            margin-bottom: 0.25rem;
        }

        .alarm-time {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .alarm-days {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .alarm-sound {
            font-size: 0.9rem;
            color: var(--text-accent);
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .alarm-challenges {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .alarm-actions {
            display: flex;
            gap: 0.5rem;
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }


        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .feature-card {
            background: var(--gradient-dark);
            padding: 2rem;
            border-radius: var(--border-radius-lg);
            border: 2px solid var(--border-neon);
            text-align: center;
            transition: var(--transition-bounce);
            box-shadow: var(--shadow-neon);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: var(--transition);
        }

        .feature-card:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: var(--shadow-elevated);
            border-color: var(--accent-color);
            background: var(--gradient-neon);
        }

        .feature-card:hover::before {
            transform: scaleX(1);
            background: var(--gradient-primary);
        }

        .feature-card:hover h4 {
            color: var(--text-primary);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .feature-card h4 {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .notifications {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .notification {
            background: var(--surface-color);
            padding: 1.25rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-elevated);
            border: 1px solid var(--border-light);
            border-left: 4px solid var(--primary-color);
            max-width: 350px;
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient-primary);
        }

        .notification.success {
            border-left-color: var(--success-color);
        }

        .notification.success::before {
            background: var(--gradient-success);
        }

        .notification.error {
            border-left-color: var(--error-color);
        }

        .notification.error::before {
            background: var(--gradient-error);
        }

        .notification.warning {
            border-left-color: var(--warning-color);
        }

        .notification.warning::before {
            background: var(--gradient-warning);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal {
            background: var(--surface-color);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-elevated);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--border-light);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--gradient-primary);
            color: white;
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
            padding: 0.25rem;
            border-radius: var(--border-radius-sm);
            transition: var(--transition);
        }

        .btn-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            font-size: 1rem;
            transition: var(--transition);
            background: var(--surface-color);
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
        }

        .challenge-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
            margin-top: 0.5rem;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            background: var(--surface-color);
        }

        .checkbox-label:hover {
            border-color: var(--primary-color);
            background: var(--surface-variant);
        }

        .checkbox-label input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        /* Days Selector */
        .days-selector {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .day-checkbox {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.75rem;
            background: var(--surface-elevated);
            border: 2px solid var(--border-neon);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            min-width: 60px;
            text-align: center;
        }

        .day-checkbox:hover {
            background: var(--gradient-primary);
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .day-checkbox input[type="checkbox"] {
            display: none;
        }

        .day-checkbox input[type="checkbox"]:checked + span {
            color: var(--text-primary);
            font-weight: 700;
        }

        .day-checkbox input[type="checkbox"]:checked {
            background: var(--gradient-primary);
            border-color: var(--accent-color);
        }

        .day-checkbox span {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .day-checkbox:has(input:checked) {
            background: var(--gradient-primary);
            border-color: var(--accent-color);
            box-shadow: var(--shadow-neon);
        }

        .day-checkbox:has(input:checked) span {
            color: var(--text-primary);
            font-weight: 700;
        }

        /* Sound Selector */
        .sound-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .sound-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: var(--surface-elevated);
            border: 2px solid var(--border-neon);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .sound-option:hover {
            background: var(--gradient-primary);
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-neon);
        }

        .sound-option.selected {
            background: var(--gradient-primary);
            border-color: var(--accent-color);
            box-shadow: var(--shadow-neon);
        }

        .sound-preview {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .sound-icon {
            font-size: 1.5rem;
            filter: drop-shadow(0 0 10px rgba(255, 68, 68, 0.5));
        }

        .sound-name {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .sound-play-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sound-play-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-neon);
        }

        .sound-play-btn.playing {
            background: var(--gradient-success);
            animation: pulse 1s infinite;
        }

        /* Challenge Modal Styles */
        .challenge-modal {
            z-index: 1000;
        }

        .challenge-modal-content {
            max-width: 500px;
            background: var(--gradient-dark);
            border: 3px solid var(--border-neon);
            box-shadow: var(--shadow-elevated);
        }

        .challenge-modal .modal-header {
            background: var(--gradient-neon);
            color: var(--text-primary);
            text-align: center;
            padding: 2rem;
            position: relative;
        }

        .challenge-icon {
            font-size: 3rem;
            margin: 1rem 0;
            animation: bounceIn 1s ease-out;
        }

        .challenge-info {
            text-align: center;
            margin-bottom: 2rem;
        }

        .challenge-info h4 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-accent);
            margin-bottom: 1rem;
        }

        .challenge-description {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .challenge-difficulty {
            margin-bottom: 1rem;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .difficulty-badge.easy {
            background: var(--gradient-success);
            color: white;
        }

        .difficulty-badge.medium {
            background: var(--gradient-warning);
            color: white;
        }

        .difficulty-badge.hard {
            background: var(--gradient-primary);
            color: white;
        }

        .difficulty-badge.extreme {
            background: var(--gradient-error);
            color: white;
            animation: pulse 1s infinite;
        }

        .challenge-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .challenge-timer {
            text-align: center;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-accent);
            background: var(--surface-elevated);
            padding: 1rem;
            border-radius: var(--border-radius);
            border: 2px solid var(--border-neon);
        }

        /* Settings Modal Styles */
        .settings-modal {
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .settings-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 1rem;
        }

        .tab-btn {
            background: transparent;
            border: 2px solid var(--border-color);
            color: var(--text-secondary);
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .tab-btn:hover {
            background: var(--surface-elevated);
            border-color: var(--border-neon);
            color: var(--text-primary);
        }

        .tab-btn.active {
            background: var(--gradient-primary);
            border-color: var(--border-neon);
            color: white;
            box-shadow: var(--shadow-neon);
        }

        .settings-tab {
            display: none;
        }

        .settings-tab.active {
            display: block;
        }

        .settings-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .option-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: var(--surface-elevated);
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .option-item:hover {
            border-color: var(--border-neon);
            box-shadow: var(--shadow);
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--surface-color);
            transition: 0.4s;
            border-radius: 34px;
            border: 2px solid var(--border-color);
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: var(--gradient-primary);
            border-color: var(--border-neon);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .privacy-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .btn-error {
            background: var(--gradient-error);
            color: white;
            border: 2px solid var(--border-error);
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-error:hover {
            background: var(--gradient-error);
            box-shadow: var(--shadow-error);
            transform: translateY(-2px);
        }

        .subscription-info {
            background: var(--surface-elevated);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border: 2px solid var(--border-neon);
            margin-top: 2rem;
            text-align: center;
        }

        .subscription-info p {
            margin: 0.5rem 0;
            color: var(--text-secondary);
        }

        .subscription-info p:first-child {
            color: var(--text-accent);
            font-weight: 700;
        }

        /* Payment Modal Styles */
        .payment-summary {
            background: var(--surface-elevated);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
        }

        .product-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        .product-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .product-price {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-accent);
        }

        .product-features ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .product-features li {
            padding: 0.5rem 0;
            color: var(--text-secondary);
            position: relative;
            padding-left: 1.5rem;
        }

        .product-features li:before {
            content: "âœ…";
            position: absolute;
            left: 0;
        }

        .payment-methods {
            margin-bottom: 1.5rem;
        }

        .payment-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .payment-option {
            display: flex;
            align-items: center;
            padding: 1rem;
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .payment-option:hover {
            border-color: var(--accent-color);
            background: var(--accent-light);
        }

        .payment-option input[type="radio"] {
            margin-right: 0.75rem;
            transform: scale(1.2);
        }

        .payment-option input[type="radio"]:checked + span {
            color: var(--accent-color);
            font-weight: 600;
        }

        .payment-total {
            background: var(--surface-elevated);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
        }

        .total-line {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
        }

        .total-line.total {
            border-top: 2px solid var(--accent-color);
            margin-top: 0.5rem;
            padding-top: 0.75rem;
            font-size: 1.1rem;
        }

        .payment-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        .total-final {
            border-top: 2px solid var(--accent-color);
            padding-top: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .alarm-info {
            text-align: center;
            margin-bottom: 1rem;
        }
        
        .alarm-info h4 {
            font-size: 1.5rem;
            color: var(--accent-color);
            margin-bottom: 0.5rem;
        }
        
        .alarm-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
        }
        
        .challenge-content {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        .challenge-text {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .challenge-type {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .success-message {
            text-align: center;
            padding: 2rem;
        }

        .success-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .confirmation-details {
            background: var(--surface-elevated);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin: 1.5rem 0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-light);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .next-steps {
            text-align: left;
            margin-top: 1.5rem;
        }

        .next-steps ul {
            list-style: none;
            padding: 0;
        }

        .next-steps li {
            padding: 0.5rem 0;
            color: var(--text-secondary);
        }

        /* Chatbot Styles */
        .chatbot-modal {
            max-width: 500px;
            height: 600px;
            display: flex;
            flex-direction: column;
        }

        .chatbot-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .chatbot-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            background: var(--surface);
            border-radius: 8px;
            margin-bottom: 1rem;
            max-height: 400px;
        }

        .chatbot-message {
            margin-bottom: 1rem;
            animation: fadeInUp 0.3s ease;
        }

        .bot-message .message-content {
            background: var(--surface-elevated);
            padding: 1rem;
            border-radius: 12px;
            border-left: 4px solid var(--accent-color);
        }

        .user-message {
            text-align: right;
        }

        .user-message .message-content {
            background: var(--accent-color);
            color: white;
            padding: 1rem;
            border-radius: 12px;
            display: inline-block;
            max-width: 80%;
        }

        .chatbot-input {
            display: flex;
            gap: 0.5rem;
            padding: 1rem;
            background: var(--surface-elevated);
            border-radius: 8px;
        }

        .chatbot-input input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--surface);
            color: var(--text-primary);
        }

        .chatbot-input button {
            padding: 0.75rem 1rem;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chatbot-input button:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }

        /* Payment Configuration Styles */
        .payment-config {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .config-section {
            background: var(--surface-elevated);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-light);
        }

        .config-section h5 {
            margin: 0 0 1.5rem 0;
            color: var(--text-primary);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .config-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .form-group input {
            padding: 0.75rem;
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            background: var(--surface-primary);
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .form-group small {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .monitoring-stats {
            background: var(--surface-primary);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-light);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .status-indicator {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-indicator.success {
            background: var(--success-light);
            color: var(--success-color);
        }

        .status-indicator.error {
            background: var(--error-light);
            color: var(--error-color);
        }

        .status-indicator.warning {
            background: var(--warning-light);
            color: var(--warning-color);
        }

        /* Log Styles */
        .logs-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius);
            background: var(--surface-primary);
        }

        .log-entry {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-light);
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-entry.info {
            background: var(--success-light);
        }

        .log-entry.warn {
            background: var(--warning-light);
        }

        .log-entry.error {
            background: var(--error-light);
        }

        .log-time {
            color: var(--text-secondary);
            margin-right: 1rem;
            min-width: 80px;
        }

        .log-level {
            font-weight: 600;
            margin-right: 1rem;
            min-width: 60px;
        }

        .log-entry.info .log-level {
            color: var(--success-color);
        }

        .log-entry.warn .log-level {
            color: var(--warning-color);
        }

        .log-entry.error .log-level {
            color: var(--error-color);
        }

        .log-message {
            color: var(--text-primary);
            flex: 1;
        }

        /* Authentication Modal Styles */
        .auth-modal {
            z-index: 1000;
        }

        .auth-modal-content {
            max-width: 500px;
            background: var(--gradient-dark);
            border: 3px solid var(--border-neon);
            box-shadow: var(--shadow-elevated);
        }

        .auth-modal .modal-header {
            background: var(--gradient-neon);
            color: var(--text-primary);
            text-align: center;
            padding: 2rem;
            position: relative;
        }

        .auth-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 1rem;
        }

        .auth-tab {
            display: none;
        }

        .auth-tab.active {
            display: block;
        }

        .auth-links {
            text-align: center;
            margin-top: 1rem;
        }

        .auth-links a {
            color: var(--text-accent);
            text-decoration: none;
            font-size: 0.9rem;
        }

        .auth-links a:hover {
            text-decoration: underline;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .checkbox-label input[type="checkbox"] {
            margin-right: 0.5rem;
        }

        .user-info {
            color: var(--text-accent);
            font-weight: 600;
            margin-right: 1rem;
            padding: 0.5rem 1rem;
            background: var(--surface-elevated);
            border-radius: var(--border-radius);
            border: 2px solid var(--border-neon);
        }

        .btn-icon {
            background: var(--surface-elevated);
            border: 2px solid var(--border-color);
            color: var(--text-secondary);
            padding: 0.75rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }

        .btn-icon:hover {
            background: var(--gradient-primary);
            border-color: var(--border-neon);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-neon);
        }

        .btn-icon:active {
            transform: translateY(0);
        }

        /* Admin Panel Styles */
        .admin-modal {
            z-index: 1000;
        }

        .admin-modal-content {
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            background: var(--gradient-dark);
            border: 3px solid var(--border-neon);
            box-shadow: var(--shadow-elevated);
        }

        .admin-modal .modal-header {
            background: var(--gradient-error);
            color: var(--text-primary);
            text-align: center;
            padding: 2rem;
            position: relative;
        }

        .admin-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 1rem;
            flex-wrap: wrap;
        }

        .admin-tab {
            display: none;
        }

        .admin-tab.active {
            display: block;
        }

        .admin-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .admin-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .admin-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            background: var(--surface-elevated);
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .admin-item:hover {
            border-color: var(--border-neon);
            box-shadow: var(--shadow);
        }

        .item-info {
            flex: 1;
        }

        .item-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .item-details {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
        }

        .item-stats {
            display: flex;
            gap: 1rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
            flex-wrap: wrap;
        }

        .plan-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .plan-badge.pro {
            background: var(--gradient-primary);
            color: white;
        }

        .plan-badge.premium {
            background: var(--gradient-warning);
            color: white;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .status-badge.pending {
            background: var(--gradient-warning);
            color: white;
        }

        .status-badge.active {
            background: var(--gradient-success);
            color: white;
        }

        .status-badge.rejected {
            background: var(--gradient-error);
            color: white;
        }

        .status-badge.cancelled {
            background: var(--surface-color);
            color: var(--text-secondary);
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
            border: 2px solid var(--border-success);
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-success:hover {
            background: var(--gradient-success);
            box-shadow: var(--shadow-success);
            transform: translateY(-2px);
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            display: flex;
            align-items: center;
            padding: 1.5rem;
            background: var(--surface-elevated);
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--border-neon);
            box-shadow: var(--shadow);
        }

        .stat-icon {
            font-size: 2rem;
            margin-right: 1rem;
        }

        .stat-info {
            flex: 1;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-accent);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .admin-settings {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: var(--surface-elevated);
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .setting-item:hover {
            border-color: var(--border-neon);
            box-shadow: var(--shadow);
        }

        .no-data {
            text-align: center;
            color: var(--text-secondary);
            font-style: italic;
            padding: 2rem;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-light);
        }

        /* Leaderboard styles */
        .leaderboard {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--surface-elevated);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-neon);
            transition: var(--transition);
        }

        .leaderboard-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-neon);
        }

        .leaderboard-item.rank-1 {
            background: var(--gradient-warning);
            border-color: var(--warning-color);
        }

        .leaderboard-item.rank-2 {
            background: var(--gradient-success);
            border-color: var(--success-color);
        }

        .leaderboard-item.rank-3 {
            background: var(--gradient-primary);
            border-color: var(--primary-color);
        }

        .leaderboard-item.your-rank {
            background: var(--gradient-neon);
            border-color: var(--accent-color);
            animation: bounceIn 1s ease-out;
        }

        .leaderboard .rank {
            font-size: 1.5rem;
            min-width: 2rem;
        }

        .leaderboard .name {
            flex: 1;
            font-weight: 600;
            color: var(--text-primary);
        }

        .leaderboard .score {
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .leaderboard-actions {
            text-align: center;
            padding-top: 1rem;
            border-top: 1px solid var(--border-light);
        }

        /* Subscription plans */
        .subscription-plans {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .plan-card {
            background: var(--gradient-dark);
            padding: 2rem;
            border-radius: var(--border-radius-lg);
            border: 2px solid var(--border-neon);
            text-align: center;
            transition: var(--transition-bounce);
            position: relative;
            overflow: hidden;
        }

        .plan-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: var(--shadow-elevated);
        }

        .plan-card.pro {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-neon);
        }

        .plan-card.premium {
            border-color: var(--accent-color);
            box-shadow: var(--shadow-elevated);
            background: var(--gradient-neon);
        }

        .plan-card h4 {
            font-size: 1.5rem;
            font-weight: 900;
            margin-bottom: 1rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .plan-price {
            font-size: 2rem;
            font-weight: 900;
            color: var(--text-accent);
            margin-bottom: 1.5rem;
        }

        .plan-features {
            list-style: none;
            margin-bottom: 2rem;
        }

        .plan-features li {
            padding: 0.5rem 0;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border-light);
        }

        .plan-features li:last-child {
            border-bottom: none;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 0.5rem;
            }
            
            .navbar {
                padding: 0.75rem;
            }
            
            .nav-brand h1 {
                font-size: 1.2rem;
            }
            
            section {
                padding: 1rem;
            }
            
            .alarm-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .alarm-actions {
                width: 100%;
                justify-content: flex-end;
            }

            .modal {
                width: 95%;
                margin: 1rem;
            }

            .challenge-options {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-brand">
                <h1>ðŸš¨ WAKEUPG v2.0</h1>
            </div>
            <div class="nav-actions">
                <button id="login-btn" class="btn-primary" onclick="showAuthModal()">ðŸ” Accedi</button>
                <button id="share-btn" class="btn-icon" title="Condividi la tua vittoria">ðŸ“¤</button>
                <button id="leaderboard-btn" class="btn-icon" title="Classifica">ðŸ†</button>
                <button id="settings-btn" class="btn-icon" title="Impostazioni">âš™ï¸</button>
                <button id="subscription-btn" class="btn-icon" title="Abbonamenti">ðŸ’³</button>
                <button id="chatbot-btn" class="btn-icon" title="Chatbot AI" style="background: var(--accent-color); color: white;">ðŸ¤–</button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Alarm Status -->
            <div id="alarm-status" class="alarm-status">
                <div class="status-indicator" id="status-indicator"></div>
                <div class="status-text" id="status-text">Sistema pronto</div>
            </div>

            <!-- Hero Section -->
            <div class="hero-section">
                <div class="hero-content">
                    <h2 class="hero-title">ðŸš¨ LA SVEGLIA CHE NON PUOI SPEGNERE!</h2>
                    <p class="hero-subtitle">Challenge reali, zero scuse, 100% efficacia. Trasforma la tua mattina in una vittoria!</p>
                    <div class="hero-stats">
                        <div class="stat-item">
                            <span class="stat-number">0%</span>
                            <span class="stat-label">Efficacia</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">0</span>
                            <span class="stat-label">Scuse</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">âˆž</span>
                            <span class="stat-label">Motivazione</span>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Progress Section -->
            <section class="progress-section">
                <h2>ðŸ† I Tuoi Progressi</h2>
                <div class="progress-stats">
                    <div class="progress-item">
                        <div class="progress-icon">ðŸ”¥</div>
                        <div class="progress-info">
                            <span class="progress-label">Streak Giornaliero</span>
                            <span class="progress-value">0 giorni</span>
                        </div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-icon">âš¡</div>
                        <div class="progress-info">
                            <span class="progress-label">Challenge Completati</span>
                            <span class="progress-value">0</span>
                        </div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-icon">ðŸŽ¯</div>
                        <div class="progress-info">
                            <span class="progress-label">Efficacia</span>
                            <span class="progress-value">0%</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Active Alarms -->
            <section class="alarms-section">
                <h2>ðŸš¨ Allarmi Attivi</h2>
                <div id="alarms-list" class="alarms-list">
                    <div class="empty-state">
                        <p>Nessun allarme configurato</p>
                        <p>Clicca "Nuovo Allarme" per iniziare la tua trasformazione!</p>
                    </div>
                </div>
                <button id="add-alarm-btn" class="btn-primary">+ Crea Allarme Impossibile</button>
            </section>

            <!-- Challenge Status -->
            <section class="challenges-section" id="challenges-section" style="display: none;">
                <h2>Challenge Attivi</h2>
                <div id="challenges-list" class="challenges-list">
                    <!-- Challenges will be populated here -->
                </div>
            </section>
        </main>

        <!-- Notifications -->
        <div id="notifications" class="notifications"></div>
    </div>

    <!-- Include real modules - REMOVED TO FIX 404 ERRORS -->
    <!-- All modules are now integrated directly in standalone.html -->

    <script>
        // Real WAKEUPG functionality
        let alarmCount = 0;
        let challengeCount = 0;
        let isInitialized = false;
        let alarmTimer = null;
        let activeAlarms = [];

        // Initialize app with real modules
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('WAKEUPG Standalone loaded');
            
            // Register Service Worker for PWA
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('Service Worker registered:', registration);
                } catch (error) {
                    console.error('Service Worker registration failed:', error);
                }
            }
            
            // Check authentication status
            if (!checkAuthStatus()) {
                // Show login modal if not authenticated
                setTimeout(() => {
                    showAuthModal();
                }, 1000);
            }
            
            await initializeApp();
            setupEventListeners();
            showWelcomeMessage();
        });

        async function initializeApp() {
            try {
                // Initialize database
                if (typeof database !== 'undefined') {
                    await database.init();
                    console.log('Database initialized');
                }

                // Initialize services
                if (typeof alarmEngine !== 'undefined') {
                    await alarmEngine.init();
                    console.log('Alarm Engine initialized');
                }

                if (typeof challengeEngine !== 'undefined') {
                    await challengeEngine.init();
                    console.log('Challenge Engine initialized');
                }

                if (typeof subscriptionService !== 'undefined') {
                    await subscriptionService.init();
                    console.log('Subscription Service initialized');
                }

                // Load existing alarms
                await loadAlarms();
                
                // Start alarm timer
                startAlarmTimer();
                
                isInitialized = true;
                console.log('WAKEUPG fully initialized');
            } catch (error) {
                console.error('Error initializing app:', error);
                showNotification('Errore inizializzazione app', 'error');
            }
        }

        function setupEventListeners() {
            // Add alarm button
            document.getElementById('add-alarm-btn').addEventListener('click', showAddAlarmModal);
            
            // Navigation buttons
            document.getElementById('share-btn').addEventListener('click', shareVictory);
            document.getElementById('leaderboard-btn').addEventListener('click', showLeaderboard);
            document.getElementById('settings-btn').addEventListener('click', showSettings);
            document.getElementById('subscription-btn').addEventListener('click', showSubscriptions);
            document.getElementById('chatbot-btn').addEventListener('click', showChatbotModal);
        }

        function showWelcomeMessage() {
            showNotification('ðŸš¨ Benvenuto nel futuro del risveglio! Zero scuse, 100% risultati!', 'success');
            
            // Show achievement popup
            setTimeout(() => {
                showNotification('ðŸ† Achievement sbloccato: "Primo Passo verso la Vittoria"', 'warning');
            }, 2000);
        }

        async function loadAlarms() {
            try {
                if (typeof database !== 'undefined') {
                    const alarms = await database.getAlarms();
                    displayAlarms(alarms);
                } else {
                    // Fallback mode
                    displayAlarms([]);
                }
            } catch (error) {
                console.error('Error loading alarms:', error);
                showNotification('Errore caricamento allarmi', 'error');
            }
        }
        
        function startAlarmTimer() {
            // Clear existing timer
            if (alarmTimer) {
                clearInterval(alarmTimer);
            }
            
            // Check every 30 seconds
            alarmTimer = setInterval(checkAlarms, 30000);
            console.log('Alarm timer started - checking every 30 seconds');
        }
        
        function checkAlarms() {
            const now = new Date();
            const currentTime = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
            const currentDay = now.getDay(); // 0 = Sunday, 1 = Monday, etc.
            
            console.log('Checking alarms at:', currentTime, 'Day:', currentDay);
            
            // Get all alarms from localStorage
            const alarms = JSON.parse(localStorage.getItem('alarms') || '[]');
            
            alarms.forEach(alarm => {
                if (alarm.enabled && alarm.time === currentTime) {
                    // Check if alarm should trigger today
                    const shouldTrigger = checkAlarmDay(alarm, currentDay);
                    
                    if (shouldTrigger && !activeAlarms.includes(alarm.id)) {
                        console.log('ALARM TRIGGERED:', alarm);
                        triggerAlarm(alarm);
                        activeAlarms.push(alarm.id);
                    }
                }
            });
        }
        
        function checkAlarmDay(alarm, currentDay) {
            if (!alarm.days || alarm.days.length === 0) {
                return true; // Daily alarm
            }
            
            // Convert alarm days to numbers (1=Monday, 2=Tuesday, etc.)
            const alarmDays = alarm.days.map(day => {
                if (typeof day === 'string') {
                    const dayMap = { 'monday': 1, 'tuesday': 2, 'wednesday': 3, 'thursday': 4, 'friday': 5, 'saturday': 6, 'sunday': 0 };
                    return dayMap[day.toLowerCase()] || parseInt(day);
                }
                return parseInt(day);
            });
            
            return alarmDays.includes(currentDay);
        }
        
        function triggerAlarm(alarm) {
            console.log('ðŸš¨ ALARM TRIGGERED:', alarm.name || 'Allarme');
            
            // Show alarm notification
            showNotification(`ðŸš¨ Sveglia: ${alarm.name || 'Allarme'}`, 'warning');
            
            // Play alarm sound
            playAlarmSound(alarm.sound || 'classic');
            
            // Show challenge modal if enabled
            if (alarm.challenges && alarm.challenges.length > 0) {
                showAlarmChallengeModal(alarm);
            } else {
                // Simple alarm without challenges
                showSimpleAlarmModal(alarm);
            }
        }
        
        function playAlarmSound(soundType) {
            try {
                // Create audio context
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Generate different sounds based on type
                let frequency = 800;
                let duration = 0.5;
                
                switch(soundType) {
                    case 'classic':
                        frequency = 800;
                        duration = 0.5;
                        break;
                    case 'beep':
                        frequency = 1000;
                        duration = 0.3;
                        break;
                    case 'buzz':
                        frequency = 200;
                        duration = 1.0;
                        break;
                    case 'chime':
                        frequency = 523; // C5
                        duration = 0.8;
                        break;
                    default:
                        frequency = 800;
                        duration = 0.5;
                }
                
                // Play sound
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
                
                console.log('Alarm sound played:', soundType);
            } catch (error) {
                console.error('Error playing alarm sound:', error);
            }
        }
        
        function showSimpleAlarmModal(alarm) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ðŸš¨ Sveglia Attiva</h3>
                    </div>
                    <div class="modal-body">
                        <div class="alarm-info">
                            <h4>${alarm.name || 'Allarme'}</h4>
                            <p>Orario: ${alarm.time}</p>
                            <p>Suono: ${alarm.sound || 'classic'}</p>
                        </div>
                        <div class="alarm-actions">
                            <button class="btn-primary" onclick="stopAlarm('${alarm.id}')">ðŸ”‡ Spegni Sveglia</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.style.display = 'flex';
        }
        
        function showAlarmChallengeModal(alarm) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ðŸš¨ Sveglia Challenge</h3>
                    </div>
                    <div class="modal-body">
                        <div class="alarm-info">
                            <h4>${alarm.name || 'Allarme'}</h4>
                            <p>Completa la challenge per spegnere la sveglia!</p>
                        </div>
                        <div class="challenge-content">
                            <div id="challenge-display">Caricamento challenge...</div>
                        </div>
                        <div class="alarm-actions">
                            <button class="btn-primary" onclick="completeAlarmChallenge('${alarm.id}')">âœ… Completa Challenge</button>
                            <button class="btn-secondary" onclick="stopAlarm('${alarm.id}')">ðŸ”‡ Spegni Comunque</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.style.display = 'flex';
            
            // Load random challenge
            loadRandomChallenge(alarm.id);
        }
        
        function loadRandomChallenge(alarmId) {
            const challenges = [
                { text: "Fai 10 jumping jacks", type: "physical" },
                { text: "Conta da 50 a 0 alla rovescia", type: "mental" },
                { text: "Canta 'Happy Birthday' ad alta voce", type: "creative" },
                { text: "Fai 5 flessioni", type: "physical" },
                { text: "Rispondi: 7 x 8 = ?", type: "mental" }
            ];
            
            const randomChallenge = challenges[Math.floor(Math.random() * challenges.length)];
            document.getElementById('challenge-display').innerHTML = `
                <div class="challenge-text">${randomChallenge.text}</div>
                <div class="challenge-type">${randomChallenge.type}</div>
            `;
        }
        
        function completeAlarmChallenge(alarmId) {
            console.log('Challenge completed for alarm:', alarmId);
            stopAlarm(alarmId);
        }
        
        function stopAlarm(alarmId) {
            console.log('Stopping alarm:', alarmId);
            
            // Remove from active alarms
            activeAlarms = activeAlarms.filter(id => id !== alarmId);
            
            // Close modal
            const modal = document.querySelector('.modal');
            if (modal) {
                modal.remove();
            }
            
            // Stop any playing sounds
            // Note: Web Audio API sounds will stop automatically after duration
            
            showNotification('Sveglia spenta! ðŸŽ‰', 'success');
        }

        function displayAlarms(alarms) {
            const alarmsList = document.getElementById('alarms-list');
            if (!alarmsList) return;

            alarmsList.innerHTML = '';

            if (alarms.length === 0) {
                alarmsList.innerHTML = `
                    <div class="empty-state">
                        <p>Nessun allarme configurato</p>
                        <p>Clicca "Nuovo Allarme" per iniziare</p>
                    </div>
                `;
                return;
            }

            alarms.forEach(alarm => {
                addAlarmToList(alarm);
            });
        }

        async function showAddAlarmModal() {
            // Create modal for adding alarm
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <h3>Nuovo Allarme</h3>
                        <button class="btn-close" onclick="this.closest('.modal-overlay').remove()">Ã—</button>
                    </div>
                    <div class="modal-body">
                        <form id="add-alarm-form">
                            <div class="form-group">
                                <label for="alarm-name">Nome Allarme</label>
                                <input type="text" id="alarm-name" placeholder="Es: Sveglia Mattina" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="alarm-time">Orario Sveglia</label>
                                <input type="time" id="alarm-time" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="alarm-days">Giorni della Settimana</label>
                                <div class="days-selector">
                                    <label class="day-checkbox">
                                        <input type="checkbox" value="1" checked>
                                        <span>Lun</span>
                                    </label>
                                    <label class="day-checkbox">
                                        <input type="checkbox" value="2" checked>
                                        <span>Mar</span>
                                    </label>
                                    <label class="day-checkbox">
                                        <input type="checkbox" value="3" checked>
                                        <span>Mer</span>
                                    </label>
                                    <label class="day-checkbox">
                                        <input type="checkbox" value="4" checked>
                                        <span>Gio</span>
                                    </label>
                                    <label class="day-checkbox">
                                        <input type="checkbox" value="5" checked>
                                        <span>Ven</span>
                                    </label>
                                    <label class="day-checkbox">
                                        <input type="checkbox" value="6">
                                        <span>Sab</span>
                                    </label>
                                    <label class="day-checkbox">
                                        <input type="checkbox" value="0">
                                        <span>Dom</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="alarm-sound">Suoneria</label>
                                <div class="sound-selector">
                                    <div class="sound-option" data-sound="classic">
                                        <div class="sound-preview">
                                            <span class="sound-icon">ðŸ””</span>
                                            <span class="sound-name">Classica</span>
                                        </div>
                                        <button type="button" class="sound-play-btn" onclick="playSound('classic')">â–¶ï¸</button>
                                    </div>
                                    
                                    <div class="sound-option" data-sound="urgent">
                                        <div class="sound-preview">
                                            <span class="sound-icon">ðŸš¨</span>
                                            <span class="sound-name">Urgente</span>
                                        </div>
                                        <button type="button" class="sound-play-btn" onclick="playSound('urgent')">â–¶ï¸</button>
                                    </div>
                                    
                                    <div class="sound-option" data-sound="nature">
                                        <div class="sound-preview">
                                            <span class="sound-icon">ðŸŒ…</span>
                                            <span class="sound-name">Natura</span>
                                        </div>
                                        <button type="button" class="sound-play-btn" onclick="playSound('nature')">â–¶ï¸</button>
                                    </div>
                                    
                                    <div class="sound-option" data-sound="electronic">
                                        <div class="sound-preview">
                                            <span class="sound-icon">âš¡</span>
                                            <span class="sound-name">Elettronica</span>
                                        </div>
                                        <button type="button" class="sound-play-btn" onclick="playSound('electronic')">â–¶ï¸</button>
                                    </div>
                                    
                                    <div class="sound-option" data-sound="motivational">
                                        <div class="sound-preview">
                                            <span class="sound-icon">ðŸ’ª</span>
                                            <span class="sound-name">Motivazionale</span>
                                        </div>
                                        <button type="button" class="sound-play-btn" onclick="playSound('motivational')">â–¶ï¸</button>
                                    </div>
                                    
                                    <div class="sound-option" data-sound="custom">
                                        <div class="sound-preview">
                                            <span class="sound-icon">ðŸŽµ</span>
                                            <span class="sound-name">Personalizzata</span>
                                        </div>
                                        <button type="button" class="sound-play-btn" onclick="playSound('custom')">â–¶ï¸</button>
                                    </div>
                                </div>
                                <input type="hidden" id="alarm-sound" name="alarm-sound" value="classic">
                            </div>
                            <div class="form-group">
                                <label for="alarm-recurrence">Ripetizione</label>
                                <select id="alarm-recurrence" required>
                                    <option value="daily">Giornaliero</option>
                                    <option value="weekdays">Lun-Ven</option>
                                    <option value="weekends">Sab-Dom</option>
                                    <option value="once">Una volta</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Challenge</label>
                                <div class="challenge-options">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="challenge-photo" value="photo">
                                        ðŸ“¸ Foto bagno
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="challenge-steps" value="steps">
                                        ðŸš¶ Passi (120 in 2min)
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="challenge-nfc" value="nfc">
                                        ðŸ“¡ NFC (Pro)
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="challenge-qr" value="qr">
                                        ðŸ“± QR Code (Pro)
                                    </label>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn-secondary" onclick="this.closest('.modal-overlay').remove()">
                                    Annulla
                                </button>
                                <button type="submit" class="btn-primary">
                                    Crea Allarme
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Handle form submission
            modal.querySelector('#add-alarm-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                await createAlarm(modal);
            });
        }

        async function createAlarm(modal) {
            try {
                const formData = new FormData(modal.querySelector('#add-alarm-form'));
                
                // Get selected days
                const selectedDays = Array.from(modal.querySelectorAll('.day-checkbox input:checked'))
                    .map(checkbox => parseInt(checkbox.value));
                
                const alarmData = {
                    name: formData.get('alarm-name') || modal.querySelector('#alarm-name').value || 'Allarme',
                    time: formData.get('alarm-time') || modal.querySelector('#alarm-time').value,
                    days: selectedDays.length > 0 ? selectedDays : [1, 2, 3, 4, 5], // Default to weekdays
                    sound: formData.get('alarm-sound') || modal.querySelector('#alarm-sound').value || 'classic',
                    recurrence: formData.get('alarm-recurrence') || modal.querySelector('#alarm-recurrence').value,
                    challenges: []
                };

                // Collect selected challenges
                const challengeCheckboxes = modal.querySelectorAll('input[type="checkbox"]:checked');
                challengeCheckboxes.forEach(checkbox => {
                    alarmData.challenges.push(checkbox.value);
                });

                // Create alarm using real alarm engine
                if (typeof alarmEngine !== 'undefined') {
                    const alarm = await alarmEngine.createAlarm(alarmData);
                    
                    // Create challenges
                    if (alarmData.challenges.length > 0) {
                        for (const challengeType of alarmData.challenges) {
                            await challengeEngine.createChallenge(alarm.id, challengeType);
                        }
                    }

                    // Reload alarms
                    await loadAlarms();
                    
                    showNotification('Allarme creato con successo! â°', 'success');
                    modal.remove();
                } else {
                    // Fallback mode
                    alarmCount++;
                    const alarm = {
                        id: 'alarm-' + alarmCount,
                        time: alarmData.time,
                        recurrence: alarmData.recurrence,
                        challenges: alarmData.challenges,
                        enabled: true
                    };
                    
                    addAlarmToList(alarm);
                    showNotification('Allarme creato! â°', 'success');
                    modal.remove();
                }
            } catch (error) {
                console.error('Error creating alarm:', error);
                showNotification('Errore creazione allarme', 'error');
            }
        }

        function addAlarmToList(alarm) {
            const alarmsList = document.getElementById('alarms-list');
            const emptyState = alarmsList.querySelector('.empty-state');
            
            if (emptyState) {
                emptyState.remove();
            }
            
            // Format days
            const dayNames = ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'];
            const selectedDays = alarm.days ? alarm.days.map(day => dayNames[day]).join(', ') : 'Lun-Ven';
            
            const alarmElement = document.createElement('div');
            alarmElement.className = 'alarm-item fade-in-up';
            // Get sound info
            const soundInfo = soundLibrary[alarm.sound] || soundLibrary.classic;
            
            alarmElement.innerHTML = `
                <div class="alarm-info">
                    <div class="alarm-name">${alarm.name || 'Allarme'}</div>
                    <div class="alarm-time">${alarm.time}</div>
                    <div class="alarm-days">${selectedDays}</div>
                    <div class="alarm-sound">${soundInfo.icon} ${soundInfo.name}</div>
                    <div class="alarm-challenges">${alarm.challenges ? alarm.challenges.length : 0} challenge â€¢ ${alarm.recurrence || 'Giornaliero'}</div>
                </div>
                <div class="alarm-actions">
                    <button class="btn-secondary" onclick="editAlarm('${alarm.id}')">âœï¸</button>
                    <button class="btn-secondary" onclick="deleteAlarm('${alarm.id}')">ðŸ—‘ï¸</button>
                </div>
            `;
            
            alarmsList.appendChild(alarmElement);
            
            // Add staggered animation for multiple items
            const items = alarmsList.querySelectorAll('.alarm-item');
            items.forEach((item, index) => {
                item.style.animationDelay = `${index * 0.1}s`;
            });
        }

        function editAlarm(alarmId) {
            const alarm = alarms.find(a => a.id === alarmId);
            if (!alarm) {
                showNotification('Allarme non trovato', 'error');
                return;
            }
            
            // Popola il form con i dati esistenti
            document.getElementById('alarm-name').value = alarm.name || '';
            document.getElementById('alarm-time').value = alarm.time;
            document.getElementById('alarm-sound').value = alarm.sound || 'classic';
            
            // Seleziona i giorni
            const dayCheckboxes = document.querySelectorAll('input[name="alarm-days"]');
            dayCheckboxes.forEach(checkbox => {
                checkbox.checked = alarm.days && alarm.days.includes(checkbox.value);
            });
            
            // Mostra il modal
            showAddAlarmModal();
            
            // Cambia il titolo del modal
            document.querySelector('.modal h2').textContent = 'âœï¸ Modifica Allarme';
            
            // Cambia il pulsante
            const saveBtn = document.querySelector('.modal .btn-primary');
            saveBtn.textContent = 'ðŸ’¾ Salva Modifiche';
            saveBtn.onclick = () => saveAlarmEdit(alarmId);
        }
        
        function saveAlarmEdit(alarmId) {
            const name = document.getElementById('alarm-name').value;
            const time = document.getElementById('alarm-time').value;
            const sound = document.getElementById('alarm-sound').value;
            const selectedDays = Array.from(document.querySelectorAll('input[name="alarm-days"]:checked')).map(cb => cb.value);
            
            if (!name || !time) {
                showNotification('Compila tutti i campi obbligatori', 'error');
                return;
            }
            
            // Trova e aggiorna l'allarme
            const alarmIndex = alarms.findIndex(a => a.id === alarmId);
            if (alarmIndex !== -1) {
                alarms[alarmIndex] = {
                    ...alarms[alarmIndex],
                    name,
                    time,
                    sound,
                    days: selectedDays
                };
                
                // Salva nel localStorage
                localStorage.setItem('wakeupproof_alarms', JSON.stringify(alarms));
                
                // Ricarica la lista
                loadAlarms();
                
                // Chiudi il modal
                closeAddAlarmModal();
                
                showNotification('Allarme modificato con successo!', 'success');
            }
        }

        function deleteAlarm(alarmId) {
            const alarmElement = document.querySelector(`[onclick="deleteAlarm('${alarmId}')"]`).closest('.alarm-item');
            alarmElement.remove();
            showNotification('Allarme eliminato', 'success');
        }

        function showSettings() {
            showNotification('Impostazioni in sviluppo', 'warning');
        }

        function shareVictory() {
            const shareText = "ðŸš¨ Ho appena sconfitto la pigrizia con WAKEUPG! La sveglia che NON puoi spegnere! ðŸ’ª #WAKEUPG #NoMoreSnooze";
            
            if (navigator.share) {
                navigator.share({
                    title: 'WAKEUPG - La Sveglia Impossibile',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(shareText).then(() => {
                    showNotification('ðŸ“¤ Testo copiato! Condividi la tua vittoria!', 'success');
                });
            }
        }

        function showLeaderboard() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <h3>ðŸ† Classifica Globale</h3>
                        <button class="btn-close" onclick="this.closest('.modal-overlay').remove()">Ã—</button>
                    </div>
                    <div class="modal-body">
                        <div class="leaderboard">
                            <div class="leaderboard-item rank-1">
                                <span class="rank">ðŸ¥‡</span>
                                <span class="name">SleepDestroyer99</span>
                                <span class="score">847 punti</span>
                            </div>
                            <div class="leaderboard-item rank-2">
                                <span class="rank">ðŸ¥ˆ</span>
                                <span class="name">EarlyBirdMaster</span>
                                <span class="score">723 punti</span>
                            </div>
                            <div class="leaderboard-item rank-3">
                                <span class="rank">ðŸ¥‰</span>
                                <span class="name">NoSnoozeHero</span>
                                <span class="score">691 punti</span>
                            </div>
                            <div class="leaderboard-item your-rank">
                                <span class="rank">ðŸ‘¤</span>
                                <span class="name">Tu</span>
                                <span class="score">234 punti</span>
                            </div>
                        </div>
                        <div class="leaderboard-actions">
                            <button class="btn-primary" onclick="shareVictory()">Condividi il tuo progresso</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showSettings() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal settings-modal">
                    <div class="modal-header">
                        <h3>âš™ï¸ Impostazioni</h3>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">âœ•</button>
                    </div>
                    <div class="modal-body">
                        <div class="settings-tabs">
                            <button class="tab-btn active" onclick="showSettingsTab('profile')">ðŸ‘¤ Profilo</button>
                            <button class="tab-btn" onclick="showSettingsTab('notifications')">ðŸ”” Notifiche</button>
                            <button class="tab-btn" onclick="showSettingsTab('privacy')">ðŸ”’ Privacy</button>
                            <button class="tab-btn" onclick="showSettingsTab('subscription')">ðŸ’³ Abbonamenti</button>
                        </div>
                        
                        <div id="settings-content">
                            <!-- Profile Tab -->
                            <div id="profile-tab" class="settings-tab active">
                                <h4>ðŸ‘¤ I Tuoi Dati</h4>
                                <form id="profile-form">
                                    <div class="form-group">
                                        <label for="user-name">Nome</label>
                                        <input type="text" id="user-name" name="user-name" placeholder="Il tuo nome">
                                    </div>
                                    <div class="form-group">
                                        <label for="user-email">Email</label>
                                        <input type="email" id="user-email" name="user-email" placeholder="tua@email.com">
                                    </div>
                                    <div class="form-group">
                                        <label for="user-age">EtÃ </label>
                                        <input type="number" id="user-age" name="user-age" placeholder="25" min="13" max="100">
                                    </div>
                                    <div class="form-group">
                                        <label for="user-timezone">Fuso Orario</label>
                                        <select id="user-timezone" name="user-timezone">
                                            <option value="Europe/Rome">Europa/Roma (GMT+1)</option>
                                            <option value="Europe/London">Europa/Londra (GMT+0)</option>
                                            <option value="America/New_York">America/New York (GMT-5)</option>
                                            <option value="Asia/Tokyo">Asia/Tokyo (GMT+9)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="user-goals">Obiettivi</label>
                                        <textarea id="user-goals" name="user-goals" placeholder="I tuoi obiettivi mattutini..."></textarea>
                                    </div>
                                    <div class="form-actions">
                                        <button type="submit" class="btn-primary">ðŸ’¾ Salva Dati</button>
                                    </div>
                                </form>
                            </div>
                            
                            <!-- Notifications Tab -->
                            <div id="notifications-tab" class="settings-tab">
                                <h4>ðŸ”” Notifiche</h4>
                                <div class="settings-options">
                                    <div class="option-item">
                                        <label class="switch">
                                            <input type="checkbox" id="notifications-enabled" checked>
                                            <span class="slider"></span>
                                        </label>
                                        <span>Notifiche push</span>
                                    </div>
                                    <div class="option-item">
                                        <label class="switch">
                                            <input type="checkbox" id="sound-enabled" checked>
                                            <span class="slider"></span>
                                        </label>
                                        <span>Suoni notifiche</span>
                                    </div>
                                    <div class="option-item">
                                        <label class="switch">
                                            <input type="checkbox" id="vibration-enabled" checked>
                                            <span class="slider"></span>
                                        </label>
                                        <span>Vibrazione</span>
                                    </div>
                                    <div class="option-item">
                                        <label class="switch">
                                            <input type="checkbox" id="reminder-enabled">
                                            <span class="slider"></span>
                                        </label>
                                        <span>Promemoria serali</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Privacy Tab -->
                            <div id="privacy-tab" class="settings-tab">
                                <h4>ðŸ”’ Privacy e Sicurezza</h4>
                                <div class="settings-options">
                                    <div class="option-item">
                                        <label class="switch">
                                            <input type="checkbox" id="analytics-enabled" checked>
                                            <span class="slider"></span>
                                        </label>
                                        <span>Analytics anonime</span>
                                    </div>
                                    <div class="option-item">
                                        <label class="switch">
                                            <input type="checkbox" id="crash-reports-enabled" checked>
                                            <span class="slider"></span>
                                        </label>
                                        <span>Report crash</span>
                                    </div>
                                    <div class="option-item">
                                        <label class="switch">
                                            <input type="checkbox" id="data-sync-enabled" checked>
                                            <span class="slider"></span>
                                        </label>
                                        <span>Sincronizzazione dati</span>
                                    </div>
                                </div>
                                <div class="privacy-actions">
                                    <button class="btn-secondary" onclick="exportData()">ðŸ“¤ Esporta Dati</button>
                                    <button class="btn-secondary" onclick="importData()">ðŸ“¥ Importa Dati</button>
                                    <button class="btn-error" onclick="deleteAccount()">ðŸ—‘ï¸ Elimina Account</button>
                                </div>
                            </div>
                            
                            <!-- Subscription Tab -->
                            <div id="subscription-tab" class="settings-tab">
                                <h4>ðŸ’³ Abbonamenti</h4>
                                <div class="subscription-plans">
                                    <div class="plan-card">
                                        <h4>ðŸ†“ Free</h4>
                                        <p>3 allarmi base</p>
                                        <p>Challenge limitati</p>
                                        <p>Supporto email</p>
                                        <button class="btn-secondary" id="free-plan">Attuale</button>
                                    </div>
                                <div class="plan-card">
                                    <h4>â­ Pro</h4>
                                    <p>Allarmi illimitati</p>
                                    <p>Challenge avanzati</p>
                                    <p>Suonerie personalizzate</p>
                                    <p>Supporto prioritario</p>
                                    <button class="btn-secondary" disabled>Presto Disponibile</button>
                                </div>
                                <div class="plan-card">
                                    <h4>ðŸ’Ž Premium</h4>
                                    <p>Tutto incluso</p>
                                    <p>Challenge estreme</p>
                                    <p>Analytics avanzate</p>
                                    <p>Supporto 24/7</p>
                                    <button class="btn-secondary" disabled>Presto Disponibile</button>
                                </div>
                                </div>
                                <div class="subscription-info">
                                    <p>ðŸš§ <strong>Abbonamenti temporaneamente disabilitati</strong></p>
                                    <p>ðŸ’¡ <strong>Versione gratuita disponibile</strong></p>
                                    <p>ðŸ”„ <strong>Presto torneranno gli abbonamenti</strong></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Load user data
            loadUserData();
            
            // Add form submit listener
            document.getElementById('profile-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveUserData();
            });
        }
        
        // Settings Tab Management
        function showSettingsTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }
        
        // Authentication System
        let currentUser = null;
        let isLoggedIn = false;
        
        // Check if user is logged in
        function checkAuthStatus() {
            const userData = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (userData && userData.id) {
                currentUser = userData;
                isLoggedIn = true;
                updateUIForLoggedInUser();
                return true;
            }
            return false;
        }
        
        // Show login/register modal
        function showAuthModal() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay auth-modal';
            modal.innerHTML = `
                <div class="modal auth-modal-content">
                    <div class="modal-header">
                        <h3>ðŸ” Accedi a WAKEUPG</h3>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">âœ•</button>
                    </div>
                    <div class="modal-body">
                        <div class="auth-tabs">
                            <button class="tab-btn active" onclick="showAuthTab('login')">Accedi</button>
                            <button class="tab-btn" onclick="showAuthTab('register')">Registrati</button>
                        </div>
                        
                        <div id="auth-content">
                            <!-- Login Tab -->
                            <div id="login-tab" class="auth-tab active">
                                <form id="login-form">
                                    <div class="form-group">
                                        <label for="login-email">Email</label>
                                        <input type="email" id="login-email" name="email" placeholder="tua@email.com" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="login-password">Password</label>
                                        <input type="password" id="login-password" name="password" placeholder="La tua password" required>
                                    </div>
                                    <div class="form-actions">
                                        <button type="submit" class="btn-primary">ðŸ”‘ Accedi</button>
                                    </div>
                                </form>
                                <div class="auth-links">
                                    <a href="#" onclick="showForgotPassword()">Password dimenticata?</a>
                                </div>
                            </div>
                            
                            <!-- Register Tab -->
                            <div id="register-tab" class="auth-tab">
                                <form id="register-form">
                                    <div class="form-group">
                                        <label for="register-name">Nome</label>
                                        <input type="text" id="register-name" name="name" placeholder="Il tuo nome" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="register-email">Email</label>
                                        <input type="email" id="register-email" name="email" placeholder="tua@email.com" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="register-password">Password</label>
                                        <input type="password" id="register-password" name="password" placeholder="Scegli una password sicura" required minlength="6">
                                    </div>
                                    <div class="form-group">
                                        <label for="register-confirm">Conferma Password</label>
                                        <input type="password" id="register-confirm" name="confirm" placeholder="Conferma la password" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="register-age">EtÃ </label>
                                        <input type="number" id="register-age" name="age" placeholder="25" min="13" max="100" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="register-terms" required>
                                            <span class="checkmark"></span>
                                            Accetto i <a href="#" onclick="showTerms()">Termini di Servizio</a> e la <a href="#" onclick="showPrivacy()">Privacy Policy</a>
                                        </label>
                                    </div>
                                    <div class="form-actions">
                                        <button type="submit" class="btn-primary">ðŸš€ Registrati</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Add form listeners
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('register-form').addEventListener('submit', handleRegister);
        }
        
        // Show auth tab
        function showAuthTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.auth-tabs .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }
        
        // Handle login
        async function handleLogin(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const email = formData.get('email');
            const password = formData.get('password');
            
            try {
                const user = await loginUser(email, password);
                if (user) {
                    currentUser = user;
                    isLoggedIn = true;
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    showNotification('ðŸŽ‰ Benvenuto in WAKEUPG!', 'success');
                    updateUIForLoggedInUser();
                    closeAuthModal();
                } else {
                    showNotification('âŒ Email o password non corretti', 'error');
                }
            } catch (error) {
                showNotification('âŒ Errore durante il login: ' + error.message, 'error');
            }
        }
        
        // Handle register
        async function handleRegister(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const name = formData.get('name');
            const email = formData.get('email');
            const password = formData.get('password');
            const confirm = formData.get('confirm');
            const age = formData.get('age');
            const terms = document.getElementById('register-terms').checked;
            
            if (password !== confirm) {
                showNotification('âŒ Le password non coincidono', 'error');
                return;
            }
            
            if (!terms) {
                showNotification('âŒ Devi accettare i termini di servizio', 'error');
                return;
            }
            
            try {
                const user = await registerUser(name, email, password, age);
                if (user) {
                    currentUser = user;
                    isLoggedIn = true;
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    showNotification('ðŸŽ‰ Registrazione completata! Benvenuto in WAKEUPG!', 'success');
                    updateUIForLoggedInUser();
                    closeAuthModal();
                } else {
                    showNotification('âŒ Errore durante la registrazione', 'error');
                }
            } catch (error) {
                showNotification('âŒ Errore durante la registrazione: ' + error.message, 'error');
            }
        }
        
        // Login user
        async function loginUser(email, password) {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.email === email && u.password === password);
            return user || null;
        }
        
        // Register user
        async function registerUser(name, email, password, age) {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            console.log('Current users before registration:', users);
            
            // Check if user already exists
            if (users.find(u => u.email === email)) {
                throw new Error('Email giÃ  registrata');
            }
            
            const newUser = {
                id: Date.now().toString(),
                name: name,
                email: email,
                password: password, // In production, hash this
                age: parseInt(age),
                createdAt: new Date().toISOString(),
                subscription: 'free',
                stats: {
                    streak: 0,
                    challengesCompleted: 0,
                    effectiveness: 0,
                    totalAlarms: 0
                },
                preferences: {
                    notifications: true,
                    sound: true,
                    vibration: true,
                    reminder: false,
                    analytics: true,
                    crashReports: true,
                    dataSync: true
                }
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            console.log('User registered and saved:', newUser);
            console.log('All users after registration:', users);
            
            return newUser;
        }
        
        // Update UI for logged in user
        function updateUIForLoggedInUser() {
            if (currentUser) {
                // Update navbar
                const navActions = document.querySelector('.nav-actions');
                if (navActions) {
                    const adminButton = isAdmin() ? '<button id="admin-btn" class="btn-icon" title="Area Admin">ðŸ”</button>' : '';
                    
                    navActions.innerHTML = `
                        <span class="user-info">ðŸ‘¤ ${currentUser.name}</span>
                        ${adminButton}
                        <button id="share-btn" class="btn-icon" title="Condividi la tua vittoria">ðŸ“¤</button>
                        <button id="leaderboard-btn" class="btn-icon" title="Classifica">ðŸ†</button>
                        <button id="settings-btn" class="btn-icon" title="Impostazioni">âš™ï¸</button>
                        <button id="subscription-btn" class="btn-icon" title="Abbonamenti">ðŸ’³</button>
                        <button id="logout-btn" class="btn-icon" title="Logout">ðŸšª</button>
                    `;
                    
                    // Add event listeners
                    document.getElementById('logout-btn').addEventListener('click', logout);
                    if (isAdmin()) {
                        document.getElementById('admin-btn').addEventListener('click', showAdminPanel);
                    }
                }
                
                // Update progress stats
                updateProgressStats();
                
                // Show welcome message
                showNotification(`ðŸ‘‹ Benvenuto ${currentUser.name}!`, 'success');
            }
        }
        
        // Update progress stats
        function updateProgressStats() {
            if (currentUser) {
                const progressValues = document.querySelectorAll('.progress-value');
                if (progressValues.length >= 3) {
                    progressValues[0].textContent = `${currentUser.stats.streak} giorni`;
                    progressValues[1].textContent = `${currentUser.stats.challengesCompleted}`;
                    progressValues[2].textContent = `${currentUser.stats.effectiveness}%`;
                }
            }
        }
        
        // Logout user
        function logout() {
            if (confirm('Sei sicuro di voler uscire?')) {
                currentUser = null;
                isLoggedIn = false;
                localStorage.removeItem('currentUser');
                showNotification('ðŸ‘‹ Arrivederci!', 'info');
                location.reload();
            }
        }
        
        // Close auth modal
        function closeAuthModal() {
            const modal = document.querySelector('.auth-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Show forgot password
        function showForgotPassword() {
            showNotification('ðŸ”§ FunzionalitÃ  in arrivo!', 'info');
        }
        
        // Show terms
        function showTerms() {
            showNotification('ðŸ“„ Termini di Servizio in arrivo!', 'info');
        }
        
        // Show privacy
        function showPrivacy() {
            showNotification('ðŸ”’ Privacy Policy in arrivo!', 'info');
        }
        
        // Admin System
        const ADMIN_EMAILS = ['admin@wakeupproof.com', '250862-italia@admin.com'];
        
        // Check if user is admin
        function isAdmin() {
            return currentUser && ADMIN_EMAILS.includes(currentUser.email);
        }
        
        // Show admin panel
        function showAdminPanel() {
            if (!isAdmin()) {
                showNotification('âŒ Accesso negato. Solo gli admin possono accedere.', 'error');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay admin-modal';
            modal.innerHTML = `
                <div class="modal admin-modal-content">
                    <div class="modal-header">
                        <h3>ðŸ” Area Riservata Admin</h3>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">âœ•</button>
                    </div>
                    <div class="modal-body">
                        <div class="admin-tabs">
                            <button class="tab-btn active" onclick="showAdminTab('subscriptions')">ðŸ’³ Abbonamenti</button>
                            <button class="tab-btn" onclick="showAdminTab('users')">ðŸ‘¥ Utenti</button>
                            <button class="tab-btn" onclick="showAdminTab('stats')">ðŸ“Š Statistiche</button>
                            <button class="tab-btn" onclick="showAdminTab('payments')">ðŸ”‘ Pagamenti</button>
                            <button class="tab-btn" onclick="showAdminTab('settings')">âš™ï¸ Impostazioni</button>
                        </div>
                        
                        <div id="admin-content">
                            <!-- Subscriptions Tab -->
                            <div id="subscriptions-tab" class="admin-tab active">
                                <h4>ðŸ’³ Gestione Abbonamenti</h4>
                                <div class="admin-actions">
                                    <button class="btn-primary" onclick="refreshSubscriptions()">ðŸ”„ Aggiorna</button>
                                    <button class="btn-secondary" onclick="exportSubscriptions()">ðŸ“¤ Esporta</button>
                                </div>
                                <div id="subscriptions-list" class="admin-list">
                                    <!-- Subscriptions will be loaded here -->
                                </div>
                            </div>
                            
                            <!-- Users Tab -->
                            <div id="users-tab" class="admin-tab">
                                <h4>ðŸ‘¥ Gestione Utenti</h4>
                                <div class="admin-actions">
                                    <button class="btn-primary" onclick="refreshUsers()">ðŸ”„ Aggiorna</button>
                                    <button class="btn-secondary" onclick="exportUsers()">ðŸ“¤ Esporta</button>
                                    <button class="btn-error" onclick="deleteAllUsers()">ðŸ—‘ï¸ Elimina Tutti</button>
                                </div>
                                <div id="users-list" class="admin-list">
                                    <!-- Users will be loaded here -->
                                </div>
                            </div>
                            
                            <!-- Stats Tab -->
                            <div id="stats-tab" class="admin-tab">
                                <h4>ðŸ“Š Statistiche Globali</h4>
                                <div class="admin-stats">
                                    <div class="stat-card">
                                        <div class="stat-icon">ðŸ‘¥</div>
                                        <div class="stat-info">
                                            <div class="stat-number" id="total-users">0</div>
                                            <div class="stat-label">Utenti Totali</div>
                                        </div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-icon">ðŸ’³</div>
                                        <div class="stat-info">
                                            <div class="stat-number" id="total-subscriptions">0</div>
                                            <div class="stat-label">Abbonamenti Attivi</div>
                                        </div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-icon">ðŸ’°</div>
                                        <div class="stat-info">
                                            <div class="stat-number" id="total-revenue">â‚¬0</div>
                                            <div class="stat-label">Ricavi Totali</div>
                                        </div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-icon">ðŸŽ¯</div>
                                        <div class="stat-info">
                                            <div class="stat-number" id="total-challenges">0</div>
                                            <div class="stat-label">Challenge Completati</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Payments Tab -->
                            <div id="payments-tab" class="admin-tab">
                                <h4>ðŸ”‘ Configurazione Pagamenti</h4>
                                <div class="payment-config">
                                    <div class="config-section">
                                        <h5>ðŸ’³ Stripe Configuration</h5>
                                        <div class="config-form">
                                            <div class="form-group">
                                                <label for="stripe-public-key">Chiave Pubblica Stripe:</label>
                                                <input type="text" id="stripe-public-key" placeholder="pk_test_..." value="pk_test_51234567890abcdef">
                                                <small>Chiave pubblica per il frontend</small>
                                            </div>
                                            <div class="form-group">
                                                <label for="stripe-secret-key">Chiave Segreta Stripe:</label>
                                                <input type="password" id="stripe-secret-key" placeholder="sk_test_..." value="sk_test_51234567890abcdef">
                                                <small>Chiave segreta per il backend (non visibile agli utenti)</small>
                                            </div>
                                            <div class="form-group">
                                                <label for="stripe-webhook-secret">Webhook Secret:</label>
                                                <input type="password" id="stripe-webhook-secret" placeholder="whsec_..." value="whsec_51234567890abcdef">
                                                <small>Secret per validare webhook Stripe</small>
                                            </div>
                                            <div class="form-actions">
                                                <button class="btn-primary" onclick="saveStripeConfig()">ðŸ’¾ Salva Configurazione Stripe</button>
                                                <button class="btn-secondary" onclick="testStripeConnection()">ðŸ§ª Test Connessione</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="config-section">
                                        <h5>ðŸ…¿ï¸ PayPal Configuration</h5>
                                        <div class="config-form">
                                            <div class="form-group">
                                                <label for="paypal-client-id">Client ID PayPal:</label>
                                                <input type="text" id="paypal-client-id" placeholder="sb-..." value="sb-1234567890abcdef">
                                                <small>Client ID per l'integrazione PayPal</small>
                                            </div>
                                            <div class="form-group">
                                                <label for="paypal-client-secret">Client Secret PayPal:</label>
                                                <input type="password" id="paypal-client-secret" placeholder="..." value="secret_1234567890abcdef">
                                                <small>Client Secret per l'autenticazione PayPal</small>
                                            </div>
                                            <div class="form-group">
                                                <label for="paypal-webhook-id">Webhook ID PayPal:</label>
                                                <input type="text" id="paypal-webhook-id" placeholder="..." value="webhook_1234567890abcdef">
                                                <small>ID del webhook PayPal per le notifiche</small>
                                            </div>
                                            <div class="form-actions">
                                                <button class="btn-primary" onclick="savePayPalConfig()">ðŸ’¾ Salva Configurazione PayPal</button>
                                                <button class="btn-secondary" onclick="testPayPalConnection()">ðŸ§ª Test Connessione</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="config-section">
                                        <h5>ðŸŽ Apple Pay & Google Pay</h5>
                                        <div class="config-form">
                                            <div class="form-group">
                                                <label for="apple-pay-domain">Apple Pay Domain:</label>
                                                <input type="text" id="apple-pay-domain" placeholder="wakeupproof.com" value="wakeupproof.com">
                                                <small>Dominio verificato per Apple Pay</small>
                                            </div>
                                            <div class="form-group">
                                                <label for="google-pay-merchant-id">Google Pay Merchant ID:</label>
                                                <input type="text" id="google-pay-merchant-id" placeholder="..." value="merchant_1234567890">
                                                <small>ID commerciante per Google Pay</small>
                                            </div>
                                            <div class="form-actions">
                                                <button class="btn-primary" onclick="saveMobilePayConfig()">ðŸ’¾ Salva Configurazione Mobile</button>
                                                <button class="btn-secondary" onclick="testMobilePayConnection()">ðŸ§ª Test Connessione</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="config-section">
                                        <h5>ðŸ“Š Monitoraggio Pagamenti</h5>
                                        <div class="monitoring-stats">
                                            <div class="stat-row">
                                                <span>Stato Stripe:</span>
                                                <span class="status-indicator success">âœ… Connesso</span>
                                            </div>
                                            <div class="stat-row">
                                                <span>Stato PayPal:</span>
                                                <span class="status-indicator success">âœ… Connesso</span>
                                            </div>
                                            <div class="stat-row">
                                                <span>Webhook Stripe:</span>
                                                <span class="status-indicator success">âœ… Attivo</span>
                                            </div>
                                            <div class="stat-row">
                                                <span>Webhook PayPal:</span>
                                                <span class="status-indicator success">âœ… Attivo</span>
                                            </div>
                                        </div>
                                        <div class="form-actions">
                                            <button class="btn-primary" onclick="refreshPaymentStatus()">ðŸ”„ Aggiorna Stato</button>
                                            <button class="btn-secondary" onclick="viewPaymentLogs()">ðŸ“‹ Visualizza Log</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Settings Tab -->
                            <div id="settings-tab" class="admin-tab">
                                <h4>âš™ï¸ Impostazioni Admin</h4>
                                <div class="admin-settings">
                                    <div class="setting-item">
                                        <label class="switch">
                                            <input type="checkbox" id="maintenance-mode" onchange="toggleMaintenanceMode()">
                                            <span class="slider"></span>
                                        </label>
                                        <span>ModalitÃ  Manutenzione</span>
                                    </div>
                                    <div class="setting-item">
                                        <label class="switch">
                                            <input type="checkbox" id="new-registrations" checked disabled>
                                            <span class="slider"></span>
                                        </label>
                                        <span>Nuove Registrazioni <strong>(SEMPRE ATTIVE)</strong></span>
                                    </div>
                                    <div class="setting-item">
                                        <label class="switch">
                                            <input type="checkbox" id="challenge-mode" checked disabled>
                                            <span class="slider"></span>
                                        </label>
                                        <span>ModalitÃ  Challenge <strong>(SEMPRE ATTIVE)</strong></span>
                                    </div>
                                </div>
                                <div class="admin-actions">
                                    <button class="btn-primary" onclick="backupData()">ðŸ’¾ Backup Dati</button>
                                    <button class="btn-secondary" onclick="restoreData()">ðŸ“¥ Ripristina</button>
                                    <button class="btn-error" onclick="resetSystem()">ðŸ”„ Reset Sistema</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Load admin data
            loadAdminData();
        }
        
        // Show admin tab
        function showAdminTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.admin-tabs .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Load specific data
            if (tabName === 'subscriptions') {
                loadSubscriptions();
            } else if (tabName === 'users') {
                loadUsers();
            } else if (tabName === 'stats') {
                loadStats();
            } else if (tabName === 'payments') {
                loadPaymentConfig();
            }
        }
        
        // Load admin data
        function loadAdminData() {
            loadStats();
        }
        
        // Load subscriptions
        function loadSubscriptions() {
            let subscriptions = JSON.parse(localStorage.getItem('subscriptions') || '[]');
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            
            // Se non ci sono abbonamenti, crea alcuni demo
            if (subscriptions.length === 0) {
                subscriptions = [
                    {
                        id: 'demo_1',
                        userId: 'demo_user_1',
                        plan: 'pro',
                        status: 'pending',
                        createdAt: new Date().toISOString(),
                        price: 'â‚¬4.99/mese'
                    },
                    {
                        id: 'demo_2',
                        userId: 'demo_user_2',
                        plan: 'premium',
                        status: 'active',
                        createdAt: new Date(Date.now() - 86400000).toISOString(),
                        price: 'â‚¬9.99/mese'
                    }
                ];
                localStorage.setItem('subscriptions', JSON.stringify(subscriptions));
            }
            
            const subscriptionsList = document.getElementById('subscriptions-list');
            subscriptionsList.innerHTML = '';
            
            if (subscriptions.length === 0) {
                subscriptionsList.innerHTML = '<p class="no-data">Nessun abbonamento trovato</p>';
                return;
            }
            
            subscriptions.forEach(sub => {
                const user = users.find(u => u.id === sub.userId);
                const subscriptionElement = document.createElement('div');
                subscriptionElement.className = 'admin-item';
                subscriptionElement.innerHTML = `
                    <div class="item-info">
                        <div class="item-title">${user ? user.name : 'Utente Sconosciuto'}</div>
                        <div class="item-details">
                            <span class="plan-badge ${sub.plan}">${sub.plan.toUpperCase()}</span>
                            <span class="status-badge ${sub.status}">${sub.status.toUpperCase()}</span>
                            <span class="date">${new Date(sub.createdAt).toLocaleDateString()}</span>
                        </div>
                    </div>
                    <div class="item-actions">
                        ${sub.status === 'pending' ? `
                            <button class="btn-success" onclick="approveSubscription('${sub.id}')">âœ… Approva</button>
                            <button class="btn-error" onclick="rejectSubscription('${sub.id}')">âŒ Rifiuta</button>
                        ` : `
                            <button class="btn-secondary" onclick="viewSubscription('${sub.id}')">ðŸ‘ï¸ Visualizza</button>
                            <button class="btn-error" onclick="cancelSubscription('${sub.id}')">ðŸš« Cancella</button>
                        `}
                    </div>
                `;
                subscriptionsList.appendChild(subscriptionElement);
            });
        }
        
        // Load users
        function loadUsers() {
            let users = JSON.parse(localStorage.getItem('users') || '[]');
            console.log('Loading users from localStorage:', users);
            
            // Se non ci sono utenti, crea alcuni demo
            if (users.length === 0) {
                users = [
                    {
                        id: 'demo_user_1',
                        name: 'Mario Rossi',
                        email: 'mario.rossi@email.com',
                        age: 28,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'demo_user_2',
                        name: 'Giulia Bianchi',
                        email: 'giulia.bianchi@email.com',
                        age: 32,
                        createdAt: new Date(Date.now() - 86400000).toISOString()
                    }
                ];
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            const usersList = document.getElementById('users-list');
            console.log('Users list element:', usersList);
            usersList.innerHTML = '';
            
            if (users.length === 0) {
                usersList.innerHTML = '<p class="no-data">Nessun utente trovato</p>';
                return;
            }
            
            console.log('Displaying', users.length, 'users');
            
            users.forEach(user => {
                const userElement = document.createElement('div');
                userElement.className = 'admin-item';
                userElement.innerHTML = `
                    <div class="item-info">
                        <div class="item-title">${user.name}</div>
                        <div class="item-details">
                            <span class="email">${user.email}</span>
                            <span class="age">${user.age} anni</span>
                            <span class="date">${new Date(user.createdAt).toLocaleDateString()}</span>
                        </div>
                        <div class="item-stats">
                            <span>Streak: ${user.stats.streak}</span>
                            <span>Challenge: ${user.stats.challengesCompleted}</span>
                            <span>Efficacia: ${user.stats.effectiveness}%</span>
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="btn-primary" onclick="viewUser('${user.id}')">ðŸ‘ï¸ Visualizza</button>
                        <button class="btn-secondary" onclick="editUser('${user.id}')">âœï¸ Modifica</button>
                        <button class="btn-error" onclick="deleteUser('${user.id}')">ðŸ—‘ï¸ Elimina</button>
                    </div>
                `;
                usersList.appendChild(userElement);
            });
        }
        
        // Load stats
        function loadStats() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const subscriptions = JSON.parse(localStorage.getItem('subscriptions') || '[]');
            
            // Calculate stats
            const totalUsers = users.length;
            const activeSubscriptions = subscriptions.filter(s => s.status === 'active').length;
            const totalRevenue = subscriptions.filter(s => s.status === 'active').reduce((sum, s) => {
                const planPrices = { pro: 4.99, premium: 9.99 };
                return sum + (planPrices[s.plan] || 0);
            }, 0);
            const totalChallenges = users.reduce((sum, user) => sum + user.stats.challengesCompleted, 0);
            
            // Update UI
            document.getElementById('total-users').textContent = totalUsers;
            document.getElementById('total-subscriptions').textContent = activeSubscriptions;
            document.getElementById('total-revenue').textContent = `â‚¬${totalRevenue.toFixed(2)}`;
            document.getElementById('total-challenges').textContent = totalChallenges;
        }
        
        // Admin actions
        function approveSubscription(subscriptionId) {
            const subscriptions = JSON.parse(localStorage.getItem('subscriptions') || '[]');
            const subscription = subscriptions.find(s => s.id === subscriptionId);
            
            if (subscription) {
                subscription.status = 'active';
                subscription.approvedAt = new Date().toISOString();
                localStorage.setItem('subscriptions', JSON.stringify(subscriptions));
                
                // Update user subscription
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const user = users.find(u => u.id === subscription.userId);
                if (user) {
                    user.subscription = subscription.plan;
                    localStorage.setItem('users', JSON.stringify(users));
                }
                
                showNotification('âœ… Abbonamento approvato!', 'success');
                loadSubscriptions();
            }
        }
        
        function rejectSubscription(subscriptionId) {
            const subscriptions = JSON.parse(localStorage.getItem('subscriptions') || '[]');
            const subscription = subscriptions.find(s => s.id === subscriptionId);
            
            if (subscription) {
                subscription.status = 'rejected';
                subscription.rejectedAt = new Date().toISOString();
                localStorage.setItem('subscriptions', JSON.stringify(subscriptions));
                
                showNotification('âŒ Abbonamento rifiutato!', 'warning');
                loadSubscriptions();
            }
        }
        
        function viewSubscription(subscriptionId) {
            const subscriptions = JSON.parse(localStorage.getItem('subscriptions') || '[]');
            const subscription = subscriptions.find(s => s.id === subscriptionId);
            
            if (subscription) {
                showNotification(`ðŸ“‹ Abbonamento ${subscription.plan.toUpperCase()} - ${subscription.status.toUpperCase()}`, 'info');
            }
        }
        
        function cancelSubscription(subscriptionId) {
            if (confirm('Sei sicuro di voler cancellare questo abbonamento?')) {
                const subscriptions = JSON.parse(localStorage.getItem('subscriptions') || '[]');
                const subscription = subscriptions.find(s => s.id === subscriptionId);
                
                if (subscription) {
                    subscription.status = 'cancelled';
                    subscription.cancelledAt = new Date().toISOString();
                    localStorage.setItem('subscriptions', JSON.stringify(subscriptions));
                    
                    showNotification('ðŸš« Abbonamento cancellato!', 'warning');
                    loadSubscriptions();
                }
            }
        }
        
        function viewUser(userId) {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.id === userId);
            
            if (user) {
                showNotification(`ðŸ‘¤ ${user.name} - ${user.email}`, 'info');
            }
        }
        
        function editUser(userId) {
            showNotification('âœï¸ FunzionalitÃ  di modifica in arrivo!', 'info');
        }
        
        function deleteUser(userId) {
            if (confirm('Sei sicuro di voler eliminare questo utente?')) {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const filteredUsers = users.filter(u => u.id !== userId);
                localStorage.setItem('users', JSON.stringify(filteredUsers));
                
                showNotification('ðŸ—‘ï¸ Utente eliminato!', 'warning');
                loadUsers();
            }
        }
        
        function deleteAllUsers() {
            if (confirm('âš ï¸ ATTENZIONE: Questa azione eliminerÃ  TUTTI gli utenti!\n\nSei sicuro di voler continuare?')) {
                if (confirm('ðŸš¨ ULTIMA CONFERMA: Eliminare tutti gli utenti?')) {
                    localStorage.removeItem('users');
                    localStorage.removeItem('currentUser');
                    showNotification('ðŸ—‘ï¸ Tutti gli utenti eliminati!', 'warning');
                    location.reload();
                }
            }
        }
        
        function refreshSubscriptions() {
            loadSubscriptions();
            showNotification('ðŸ”„ Abbonamenti aggiornati!', 'success');
        }
        
        function refreshUsers() {
            loadUsers();
            showNotification('ðŸ”„ Utenti aggiornati!', 'success');
        }
        
        function exportSubscriptions() {
            const subscriptions = JSON.parse(localStorage.getItem('subscriptions') || '[]');
            const dataStr = JSON.stringify(subscriptions, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `subscriptions-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('ðŸ“¤ Abbonamenti esportati!', 'success');
        }
        
        function exportUsers() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const dataStr = JSON.stringify(users, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `users-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('ðŸ“¤ Utenti esportati!', 'success');
        }
        
        function toggleMaintenanceMode() {
            const isEnabled = document.getElementById('maintenance-mode').checked;
            localStorage.setItem('maintenanceMode', isEnabled);
            showNotification(isEnabled ? 'ðŸ”§ ModalitÃ  manutenzione attivata!' : 'âœ… ModalitÃ  manutenzione disattivata!', 'info');
        }
        
        function toggleNewRegistrations() {
            // SEMPRE ATTIVE - Non modificabile
            showNotification('âœ… Nuove registrazioni sono SEMPRE ATTIVE!', 'info');
        }
        
        function toggleChallengeMode() {
            // SEMPRE ATTIVE - Non modificabile
            showNotification('ðŸŽ¯ ModalitÃ  challenge Ã¨ SEMPRE ATTIVA!', 'info');
        }
        
        function backupData() {
            const data = {
                users: JSON.parse(localStorage.getItem('users') || '[]'),
                subscriptions: JSON.parse(localStorage.getItem('subscriptions') || '[]'),
                alarms: JSON.parse(localStorage.getItem('alarms') || '[]'),
                backupDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `wakeupproof-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('ðŸ’¾ Backup completato!', 'success');
        }
        
        function restoreData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            if (data.users) localStorage.setItem('users', JSON.stringify(data.users));
                            if (data.subscriptions) localStorage.setItem('subscriptions', JSON.stringify(data.subscriptions));
                            if (data.alarms) localStorage.setItem('alarms', JSON.stringify(data.alarms));
                            
                            showNotification('ðŸ“¥ Dati ripristinati!', 'success');
                            location.reload();
                        } catch (error) {
                            showNotification('âŒ Errore nel ripristino dei dati', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        function resetSystem() {
            if (confirm('âš ï¸ ATTENZIONE: Questa azione resetterÃ  TUTTO il sistema!\n\nSei sicuro di voler continuare?')) {
                if (confirm('ðŸš¨ ULTIMA CONFERMA: Reset completo del sistema?')) {
                    localStorage.clear();
                    showNotification('ðŸ”„ Sistema resettato!', 'warning');
                    location.reload();
                }
            }
        }

        // User Data Management
        function loadUserData() {
            if (!currentUser) return;
            
            // Load profile data
            if (currentUser.name) document.getElementById('user-name').value = currentUser.name;
            if (currentUser.email) document.getElementById('user-email').value = currentUser.email;
            if (currentUser.age) document.getElementById('user-age').value = currentUser.age;
            if (currentUser.timezone) document.getElementById('user-timezone').value = currentUser.timezone;
            if (currentUser.goals) document.getElementById('user-goals').value = currentUser.goals;
            
            // Load notification settings
            if (currentUser.preferences) {
                if (currentUser.preferences.notifications !== undefined) document.getElementById('notifications-enabled').checked = currentUser.preferences.notifications;
                if (currentUser.preferences.sound !== undefined) document.getElementById('sound-enabled').checked = currentUser.preferences.sound;
                if (currentUser.preferences.vibration !== undefined) document.getElementById('vibration-enabled').checked = currentUser.preferences.vibration;
                if (currentUser.preferences.reminder !== undefined) document.getElementById('reminder-enabled').checked = currentUser.preferences.reminder;
                if (currentUser.preferences.analytics !== undefined) document.getElementById('analytics-enabled').checked = currentUser.preferences.analytics;
                if (currentUser.preferences.crashReports !== undefined) document.getElementById('crash-reports-enabled').checked = currentUser.preferences.crashReports;
                if (currentUser.preferences.dataSync !== undefined) document.getElementById('data-sync-enabled').checked = currentUser.preferences.dataSync;
            }
        }
        
        function saveUserData() {
            const userData = {
                name: document.getElementById('user-name').value,
                email: document.getElementById('user-email').value,
                age: document.getElementById('user-age').value,
                timezone: document.getElementById('user-timezone').value,
                goals: document.getElementById('user-goals').value,
                notifications: document.getElementById('notifications-enabled').checked,
                sound: document.getElementById('sound-enabled').checked,
                vibration: document.getElementById('vibration-enabled').checked,
                reminder: document.getElementById('reminder-enabled').checked,
                analytics: document.getElementById('analytics-enabled').checked,
                crashReports: document.getElementById('crash-reports-enabled').checked,
                dataSync: document.getElementById('data-sync-enabled').checked
            };
            
            localStorage.setItem('userData', JSON.stringify(userData));
            showNotification('ðŸ’¾ Dati salvati con successo!', 'success');
        }
        
        // Subscription Management - REMOVED DUPLICATE FUNCTION
        
        function updateSubscriptionUI() {
            const subscription = JSON.parse(localStorage.getItem('subscription') || '{}');
            const currentPlan = subscription.plan || 'free';
            
            // Update plan buttons
            document.querySelectorAll('.plan-card button').forEach(btn => {
                btn.textContent = 'Attuale';
                btn.className = 'btn-secondary';
            });
            
            if (currentPlan !== 'free') {
                const planCard = document.querySelector(`[onclick="purchasePlan('${currentPlan}')"]`);
                if (planCard) {
                    planCard.textContent = 'Attuale';
                    planCard.className = 'btn-secondary';
                }
            }
        }
        
        // Data Management
        function exportData() {
            const userData = JSON.parse(localStorage.getItem('userData') || '{}');
            const alarms = JSON.parse(localStorage.getItem('alarms') || '[]');
            const subscription = JSON.parse(localStorage.getItem('subscription') || '{}');
            
            const exportData = {
                userData,
                alarms,
                subscription,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `wakeupproof-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('ðŸ“¤ Dati esportati con successo!', 'success');
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            if (data.userData) localStorage.setItem('userData', JSON.stringify(data.userData));
                            if (data.alarms) localStorage.setItem('alarms', JSON.stringify(data.alarms));
                            if (data.subscription) localStorage.setItem('subscription', JSON.stringify(data.subscription));
                            
                            showNotification('ðŸ“¥ Dati importati con successo!', 'success');
                            location.reload();
                        } catch (error) {
                            showNotification('âŒ Errore nell\'importazione dei dati', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        function deleteAccount() {
            if (confirm('âš ï¸ ATTENZIONE: Questa azione eliminerÃ  TUTTI i tuoi dati!\n\n- Profilo utente\n- Allarmi\n- Progressi\n- Abbonamenti\n\nSei sicuro di voler continuare?')) {
                if (confirm('ðŸš¨ ULTIMA CONFERMA: Eliminare definitivamente l\'account?')) {
                    localStorage.clear();
                    showNotification('ðŸ—‘ï¸ Account eliminato. Arrivederci!', 'info');
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                }
            }
        }
        
        function showSubscriptions() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <h3>ðŸ’³ Scegli il Tuo Piano</h3>
                        <button class="btn-close" onclick="this.closest('.modal-overlay').remove()">Ã—</button>
                    </div>
                    <div class="modal-body">
                        <div class="subscription-plans">
                            <div class="plan-card free">
                                <h4>ðŸ†“ FREE</h4>
                                <div class="plan-price">â‚¬0/mese</div>
                                <ul class="plan-features">
                                    <li>1 allarme</li>
                                    <li>2 challenge</li>
                                    <li>Statistiche base</li>
                                </ul>
                                <button class="btn-secondary">Piano Attuale</button>
                            </div>
                            <div class="plan-card pro">
                                <h4>âš¡ PRO</h4>
                                <div class="plan-price">â‚¬4.99/mese</div>
                                <ul class="plan-features">
                                    <li>5 allarmi</li>
                                    <li>100 challenge</li>
                                    <li>NFC & QR</li>
                                    <li>Analytics avanzate</li>
                                </ul>
                                <button class="btn-primary">Upgrade</button>
                            </div>
                            <div class="plan-card premium">
                                <h4>ðŸ‘‘ PREMIUM</h4>
                                <div class="plan-price">â‚¬9.99/mese</div>
                                <ul class="plan-features">
                                    <li>Allarmi illimitati</li>
                                    <li>Challenge personalizzati</li>
                                    <li>Coaching AI</li>
                                    <li>Supporto prioritario</li>
                                </ul>
                                <button class="btn-primary">Upgrade</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Secret Challenge System
        const secretChallenges = [
            // Physical Challenges
            { id: 'jumping_jacks', name: 'Fai 20 jumping jacks', type: 'physical', difficulty: 'medium', icon: 'ðŸ¤¸' },
            { id: 'push_ups', name: 'Fai 15 flessioni', type: 'physical', difficulty: 'hard', icon: 'ðŸ’ª' },
            { id: 'squats', name: 'Fai 25 squat', type: 'physical', difficulty: 'medium', icon: 'ðŸ¦µ' },
            { id: 'plank', name: 'Mantieni il plank per 30 secondi', type: 'physical', difficulty: 'hard', icon: 'ðŸ‹ï¸' },
            { id: 'burpees', name: 'Fai 10 burpees', type: 'physical', difficulty: 'hard', icon: 'ðŸ”¥' },
            { id: 'mountain_climbers', name: 'Fai 20 mountain climbers', type: 'physical', difficulty: 'medium', icon: 'â›°ï¸' },
            { id: 'wall_sit', name: 'Mantieni il wall sit per 45 secondi', type: 'physical', difficulty: 'hard', icon: 'ðŸ§±' },
            { id: 'high_knees', name: 'Fai 30 high knees', type: 'physical', difficulty: 'easy', icon: 'ðŸƒ' },
            { id: 'butt_kicks', name: 'Fai 30 butt kicks', type: 'physical', difficulty: 'easy', icon: 'ðŸ¦µ' },
            { id: 'lunges', name: 'Fai 20 affondi (10 per gamba)', type: 'physical', difficulty: 'medium', icon: 'ðŸš¶' },
            
            // Mental Challenges
            { id: 'math_problem', name: 'Risolvi: 47 Ã— 23 = ?', type: 'mental', difficulty: 'medium', icon: 'ðŸ§®' },
            { id: 'word_scramble', name: 'Trova la parola: RATNSU', type: 'mental', difficulty: 'easy', icon: 'ðŸ”¤' },
            { id: 'memory_sequence', name: 'Ripeti la sequenza: 7-2-9-1-4', type: 'mental', difficulty: 'medium', icon: 'ðŸ§ ' },
            { id: 'color_sequence', name: 'Ripeti i colori: Rosso-Verde-Blu-Giallo', type: 'mental', difficulty: 'easy', icon: 'ðŸŒˆ' },
            { id: 'reverse_counting', name: 'Conta alla rovescia da 50 a 0', type: 'mental', difficulty: 'medium', icon: 'ðŸ”¢' },
            { id: 'alphabet_backwards', name: 'Recita l\'alfabeto al contrario', type: 'mental', difficulty: 'hard', icon: 'ðŸ”¤' },
            { id: 'word_count', name: 'Conta le lettere in "WAKEUPG"', type: 'mental', difficulty: 'easy', icon: 'ðŸ“' },
            { id: 'pattern_recognition', name: 'Completa: 2, 4, 8, 16, ?', type: 'mental', difficulty: 'medium', icon: 'ðŸ”' },
            { id: 'spelling_bee', name: 'Spella "IMPOSSIBILE"', type: 'mental', difficulty: 'medium', icon: 'âœï¸' },
            { id: 'logic_puzzle', name: 'Se oggi Ã¨ mercoledÃ¬, che giorno sarÃ  tra 100 giorni?', type: 'mental', difficulty: 'hard', icon: 'ðŸ§©' },
            
            // Creative Challenges
            { id: 'draw_something', name: 'Disegna un gatto in 30 secondi', type: 'creative', difficulty: 'easy', icon: 'ðŸŽ¨' },
            { id: 'sing_song', name: 'Canta una canzone per 20 secondi', type: 'creative', difficulty: 'easy', icon: 'ðŸŽµ' },
            { id: 'dance_moves', name: 'Fai 3 passi di danza', type: 'creative', difficulty: 'easy', icon: 'ðŸ’ƒ' },
            { id: 'poem_recite', name: 'Recita una poesia di 4 versi', type: 'creative', difficulty: 'medium', icon: 'ðŸ“œ' },
            { id: 'story_tell', name: 'Racconta una storia in 30 secondi', type: 'creative', difficulty: 'medium', icon: 'ðŸ“š' },
            { id: 'impression', name: 'Fai l\'impressione di un animale', type: 'creative', difficulty: 'easy', icon: 'ðŸ’' },
            { id: 'tongue_twister', name: 'Ripeti: "Sopra la panca la capra campa"', type: 'creative', difficulty: 'medium', icon: 'ðŸ‘…' },
            { id: 'mime_act', name: 'Mima "lavarsi i denti"', type: 'creative', difficulty: 'easy', icon: 'ðŸŽ­' },
            { id: 'rhyme_game', name: 'Trova 3 rime per "sveglia"', type: 'creative', difficulty: 'medium', icon: 'ðŸŽ¯' },
            { id: 'charades', name: 'Mima "fare colazione"', type: 'creative', difficulty: 'easy', icon: 'ðŸŽª' },
            
            // Sensory Challenges
            { id: 'touch_surfaces', name: 'Tocca 5 superfici diverse', type: 'sensory', difficulty: 'easy', icon: 'âœ‹' },
            { id: 'smell_identification', name: 'Identifica 3 odori diversi', type: 'sensory', difficulty: 'medium', icon: 'ðŸ‘ƒ' },
            { id: 'temperature_guess', name: 'Indovina la temperatura della stanza', type: 'sensory', difficulty: 'hard', icon: 'ðŸŒ¡ï¸' },
            { id: 'sound_identification', name: 'Identifica 3 suoni diversi', type: 'sensory', difficulty: 'medium', icon: 'ðŸ‘‚' },
            { id: 'texture_feel', name: 'Trova 3 tessuti diversi', type: 'sensory', difficulty: 'easy', icon: 'ðŸ§µ' },
            { id: 'weight_guess', name: 'Indovina il peso di un oggetto', type: 'sensory', difficulty: 'hard', icon: 'âš–ï¸' },
            { id: 'color_identification', name: 'Identifica 5 colori nella stanza', type: 'sensory', difficulty: 'easy', icon: 'ðŸŽ¨' },
            { id: 'shape_recognition', name: 'Trova 3 forme geometriche', type: 'sensory', difficulty: 'easy', icon: 'ðŸ”·' },
            { id: 'distance_estimation', name: 'Stima la distanza di un oggetto', type: 'sensory', difficulty: 'medium', icon: 'ðŸ“' },
            { id: 'balance_test', name: 'Stai in equilibrio su un piede per 20 secondi', type: 'sensory', difficulty: 'medium', icon: 'âš–ï¸' },
            
            // Social Challenges
            { id: 'call_someone', name: 'Chiama qualcuno e saluta', type: 'social', difficulty: 'easy', icon: 'ðŸ“ž' },
            { id: 'compliment_mirror', name: 'Fai un complimento allo specchio', type: 'social', difficulty: 'easy', icon: 'ðŸªž' },
            { id: 'gratitude_list', name: 'Pensa a 3 cose per cui sei grato', type: 'social', difficulty: 'easy', icon: 'ðŸ™' },
            { id: 'positive_affirmation', name: 'Ripeti 3 affermazioni positive', type: 'social', difficulty: 'easy', icon: 'ðŸ’ª' },
            { id: 'smile_challenge', name: 'Sorridi per 30 secondi', type: 'social', difficulty: 'easy', icon: 'ðŸ˜Š' },
            { id: 'laugh_out_loud', name: 'Ridi ad alta voce per 10 secondi', type: 'social', difficulty: 'easy', icon: 'ðŸ˜‚' },
            { id: 'deep_breathing', name: 'Fai 5 respiri profondi', type: 'social', difficulty: 'easy', icon: 'ðŸ«' },
            { id: 'meditation_moment', name: 'Medita per 1 minuto', type: 'social', difficulty: 'medium', icon: 'ðŸ§˜' },
            { id: 'goal_setting', name: 'Pensa a 3 obiettivi per oggi', type: 'social', difficulty: 'easy', icon: 'ðŸŽ¯' },
            { id: 'self_motivation', name: 'DÃ¬ a te stesso "Posso farcela!"', type: 'social', difficulty: 'easy', icon: 'ðŸ’ª' },
            
            // Extreme Challenges
            { id: 'cold_shower', name: 'Fai una doccia fredda di 30 secondi', type: 'extreme', difficulty: 'hard', icon: 'ðŸš¿' },
            { id: 'ice_cube_challenge', name: 'Tieni un cubetto di ghiaccio per 30 secondi', type: 'extreme', difficulty: 'hard', icon: 'ðŸ§Š' },
            { id: 'burpee_burpee', name: 'Fai 20 burpees consecutivi', type: 'extreme', difficulty: 'extreme', icon: 'ðŸ”¥' },
            { id: 'plank_marathon', name: 'Mantieni il plank per 2 minuti', type: 'extreme', difficulty: 'extreme', icon: 'ðŸ‹ï¸' },
            { id: 'sprint_challenge', name: 'Fai 5 sprint di 20 secondi', type: 'extreme', difficulty: 'extreme', icon: 'ðŸƒ' },
            { id: 'jump_rope', name: 'Salta la corda per 2 minuti', type: 'extreme', difficulty: 'hard', icon: 'ðŸ¦˜' },
            { id: 'wall_sit_marathon', name: 'Mantieni il wall sit per 3 minuti', type: 'extreme', difficulty: 'extreme', icon: 'ðŸ§±' },
            { id: 'mountain_climber_marathon', name: 'Fai 100 mountain climbers', type: 'extreme', difficulty: 'extreme', icon: 'â›°ï¸' },
            { id: 'burpee_ladder', name: 'Fai 1, 2, 3, 4, 5 burpees', type: 'extreme', difficulty: 'extreme', icon: 'ðŸ”¥' },
            { id: 'plank_variations', name: 'Fai 5 variazioni di plank', type: 'extreme', difficulty: 'hard', icon: 'ðŸ‹ï¸' }
        ];
        
        // Challenge Selection System
        function getRandomChallenge() {
            const randomIndex = Math.floor(Math.random() * secretChallenges.length);
            return secretChallenges[randomIndex];
        }
        
        function getChallengeByDifficulty(difficulty) {
            const filteredChallenges = secretChallenges.filter(challenge => challenge.difficulty === difficulty);
            const randomIndex = Math.floor(Math.random() * filteredChallenges.length);
            return filteredChallenges[randomIndex];
        }
        
        function getChallengeByType(type) {
            const filteredChallenges = secretChallenges.filter(challenge => challenge.type === type);
            const randomIndex = Math.floor(Math.random() * filteredChallenges.length);
            return filteredChallenges[randomIndex];
        }
        
        // Challenge Execution System
        function executeSecretChallenge(challenge) {
            return new Promise((resolve, reject) => {
                // Show challenge modal
                showChallengeModal(challenge);
                
                // Set up challenge completion
                window.currentChallenge = {
                    challenge: challenge,
                    resolve: resolve,
                    reject: reject,
                    startTime: Date.now()
                };
            });
        }
        
        function showChallengeModal(challenge) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay challenge-modal';
            modal.innerHTML = `
                <div class="modal challenge-modal-content">
                    <div class="modal-header">
                        <h3>ðŸŽ¯ Challenge Segreta!</h3>
                        <div class="challenge-icon">${challenge.icon}</div>
                    </div>
                    <div class="modal-body">
                        <div class="challenge-info">
                            <h4>${challenge.name}</h4>
                            <p class="challenge-description">Completa questa challenge per spegnere la sveglia!</p>
                            <div class="challenge-difficulty">
                                <span class="difficulty-badge ${challenge.difficulty}">${challenge.difficulty.toUpperCase()}</span>
                            </div>
                        </div>
                        <div class="challenge-actions">
                            <button class="btn-primary" onclick="completeChallenge()">âœ… Completato</button>
                            <button class="btn-secondary" onclick="skipChallenge()">â­ï¸ Salta</button>
                        </div>
                        <div class="challenge-timer">
                            <span id="challenge-timer">Tempo: 0s</span>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Start timer
            startChallengeTimer();
        }
        
        function startChallengeTimer() {
            const timerElement = document.getElementById('challenge-timer');
            const startTime = Date.now();
            
            const timer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                timerElement.textContent = `Tempo: ${elapsed}s`;
            }, 1000);
            
            window.challengeTimer = timer;
        }
        
        function completeChallenge() {
            if (window.currentChallenge) {
                const elapsed = Math.floor((Date.now() - window.currentChallenge.startTime) / 1000);
                showNotification(`ðŸŽ‰ Challenge completata in ${elapsed}s!`, 'success');
                window.currentChallenge.resolve();
                closeChallengeModal();
            }
        }
        
        function skipChallenge() {
            if (window.currentChallenge) {
                showNotification('â­ï¸ Challenge saltata - La sveglia continuerÃ !', 'warning');
                window.currentChallenge.reject();
                closeChallengeModal();
            }
        }
        
        function closeChallengeModal() {
            const modal = document.querySelector('.challenge-modal');
            if (modal) {
                modal.remove();
            }
            if (window.challengeTimer) {
                clearInterval(window.challengeTimer);
            }
            window.currentChallenge = null;
        }

        // Sound Management
        let currentSound = null;
        let selectedSound = 'classic';
        
        const soundLibrary = {
            classic: {
                name: 'Classica',
                icon: 'ðŸ””',
                description: 'Suoneria classica tradizionale',
                audio: null
            },
            urgent: {
                name: 'Urgente',
                icon: 'ðŸš¨',
                description: 'Allarme urgente e insistente',
                audio: null
            },
            nature: {
                name: 'Natura',
                icon: 'ðŸŒ…',
                description: 'Suoni rilassanti della natura',
                audio: null
            },
            electronic: {
                name: 'Elettronica',
                icon: 'âš¡',
                description: 'Suoneria elettronica moderna',
                audio: null
            },
            motivational: {
                name: 'Motivazionale',
                icon: 'ðŸ’ª',
                description: 'Suoneria energica e motivante',
                audio: null
            },
            custom: {
                name: 'Personalizzata',
                icon: 'ðŸŽµ',
                description: 'Carica la tua suoneria',
                audio: null
            }
        };
        
        function playSound(soundType) {
            // Stop current sound
            if (currentSound) {
                currentSound.pause();
                currentSound.currentTime = 0;
            }
            
            // Create audio context for sound generation
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Generate different sounds based on type
            let soundData = generateSoundData(soundType);
            
            // Create audio buffer
            const buffer = audioContext.createBuffer(1, soundData.length, audioContext.sampleRate);
            const channelData = buffer.getChannelData(0);
            
            for (let i = 0; i < soundData.length; i++) {
                channelData[i] = soundData[i];
            }
            
            // Play sound
            const source = audioContext.createBufferSource();
            source.buffer = buffer;
            source.connect(audioContext.destination);
            source.start();
            
            // Update UI
            updateSoundUI(soundType);
        }
        
        function generateSoundData(soundType) {
            const sampleRate = 44100;
            const duration = 2; // 2 seconds
            const length = sampleRate * duration;
            const soundData = new Float32Array(length);
            
            switch (soundType) {
                case 'classic':
                    // Classic alarm sound
                    for (let i = 0; i < length; i++) {
                        const t = i / sampleRate;
                        soundData[i] = 0.3 * Math.sin(2 * Math.PI * 800 * t) * Math.exp(-t * 2);
                    }
                    break;
                    
                case 'urgent':
                    // Urgent alarm sound
                    for (let i = 0; i < length; i++) {
                        const t = i / sampleRate;
                        soundData[i] = 0.5 * Math.sin(2 * Math.PI * 1200 * t) * (Math.sin(2 * Math.PI * 5 * t) + 1) / 2;
                    }
                    break;
                    
                case 'nature':
                    // Nature sound (bird chirping)
                    for (let i = 0; i < length; i++) {
                        const t = i / sampleRate;
                        soundData[i] = 0.2 * Math.sin(2 * Math.PI * 400 * t) * Math.sin(2 * Math.PI * 2 * t);
                    }
                    break;
                    
                case 'electronic':
                    // Electronic sound
                    for (let i = 0; i < length; i++) {
                        const t = i / sampleRate;
                        soundData[i] = 0.3 * Math.sin(2 * Math.PI * 600 * t) * Math.sin(2 * Math.PI * 10 * t);
                    }
                    break;
                    
                case 'motivational':
                    // Motivational sound (ascending tone)
                    for (let i = 0; i < length; i++) {
                        const t = i / sampleRate;
                        const freq = 400 + (t * 200);
                        soundData[i] = 0.4 * Math.sin(2 * Math.PI * freq * t);
                    }
                    break;
                    
                case 'custom':
                    // Custom sound (user upload)
                    for (let i = 0; i < length; i++) {
                        const t = i / sampleRate;
                        soundData[i] = 0.3 * Math.sin(2 * Math.PI * 500 * t) * Math.sin(2 * Math.PI * 3 * t);
                    }
                    break;
            }
            
            return soundData;
        }
        
        function updateSoundUI(soundType) {
            // Remove previous selection
            document.querySelectorAll('.sound-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selection to current option
            const selectedOption = document.querySelector(`[data-sound="${soundType}"]`);
            if (selectedOption) {
                selectedOption.classList.add('selected');
            }
            
            // Update hidden input
            document.getElementById('alarm-sound').value = soundType;
            selectedSound = soundType;
        }
        
        function selectSound(soundType) {
            updateSoundUI(soundType);
        }
        
        // Add click handlers for sound selection
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.sound-option').forEach(option => {
                option.addEventListener('click', function() {
                    const soundType = this.getAttribute('data-sound');
                    selectSound(soundType);
                });
            });
        });


        // Notification system with animations
        function showNotification(message, type = 'info') {
            const notifications = document.getElementById('notifications');
            const notification = document.createElement('div');
            notification.className = `notification ${type} fade-in-scale`;
            notification.textContent = message;
            
            notifications.appendChild(notification);
            
            // Add exit animation before removing
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOut 0.3s ease forwards';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }
            }, 5000);
        }

        // Simulate alarm trigger with animations
        async function simulateAlarm() {
            const statusIndicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            
            // Add shake animation to status indicator
            statusIndicator.className = 'status-indicator ringing shake';
            statusText.textContent = 'ALARME ATTIVO - Completa i challenge!';
            
            // Add bounce animation to status text
            statusText.classList.add('bounce-in');
            
            showNotification('Allarme attivato! ðŸš¨', 'warning');
            
            // Show challenges section with animation
            const challengesSection = document.getElementById('challenges-section');
            challengesSection.style.display = 'block';
            challengesSection.classList.add('fade-in-up');
            
            // Add alarm glow effect to the entire app
            document.body.classList.add('alarm-active');
            
            // Execute random secret challenge
            try {
                const randomChallenge = getRandomChallenge();
                await executeSecretChallenge(randomChallenge);
                
                // If challenge completed, show success
                showNotification('ðŸŽ‰ Challenge completata! Sveglia spenta!', 'success');
                stopAlarm();
            } catch (error) {
                // If challenge skipped, continue alarm
                showNotification('â­ï¸ Challenge saltata! La sveglia continua!', 'warning');
                
                // Try another challenge after 5 seconds
                setTimeout(async () => {
                    try {
                        const anotherChallenge = getRandomChallenge();
                        await executeSecretChallenge(anotherChallenge);
                        showNotification('ðŸŽ‰ Challenge completata! Sveglia spenta!', 'success');
                        stopAlarm();
                    } catch (error) {
                        showNotification('â­ï¸ Challenge saltata! La sveglia continua!', 'warning');
                    }
                }, 5000);
            }
        }
        
        function stopAlarm() {
            document.body.classList.remove('alarm-active');
            document.getElementById('status-indicator').className = 'status-indicator';
            document.getElementById('status-text').textContent = 'Sistema pronto';
            document.getElementById('challenges-section').style.display = 'none';
        }


        function completeChallenge(challengeId) {
            showNotification('Challenge completato! âœ…', 'success');
            
            // Add success animation to completed challenge
            const challengeElement = document.querySelector(`[onclick="completeChallenge('${challengeId}')"]`);
            if (challengeElement) {
                challengeElement.closest('.alarm-item').classList.add('bounce-in');
                challengeElement.closest('.alarm-item').style.background = 'linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%)';
            }
            
            // Check if all challenges completed
            const remainingChallenges = document.querySelectorAll('.alarm-item');
            if (remainingChallenges.length <= 1) { // Only one challenge left
                // Stop alarm with animation
                setTimeout(() => {
                    const statusIndicator = document.getElementById('status-indicator');
                    const statusText = document.getElementById('status-text');
                    
                    statusIndicator.className = 'status-indicator fade-in-scale';
                    statusText.textContent = 'Sistema pronto';
                    statusText.classList.add('bounce-in');
                    
                    const challengesSection = document.getElementById('challenges-section');
                    challengesSection.style.display = 'none';
                    
                    // Remove alarm active state
                    document.body.classList.remove('alarm-active');
                    
                    showNotification('Allarme spento! ðŸŽ‰', 'success');
                }, 1000);
            }
        }

        // Payment functions
        let paymentService;
        
        // PaymentService class definition
        class PaymentService {
            constructor() {
                this.stripePublicKey = 'pk_test_51234567890abcdef';
                this.paypalClientId = 'sb-1234567890abcdef';
                this.products = this.initializeProducts();
                this.currency = 'EUR';
                this.taxRate = 0.22;
            }
            
            initializeProducts() {
                return {
                    pro: {
                        id: 'pro',
                        name: 'Pro Plan',
                        price: 4.99,
                        currency: 'EUR',
                        interval: 'month',
                        features: [
                            'Sveglie illimitate',
                            'Challenge avanzati',
                            'Statistiche dettagliate',
                            'Supporto prioritario'
                        ]
                    },
                    premium: {
                        id: 'premium',
                        name: 'Premium Plan',
                        price: 9.99,
                        currency: 'EUR',
                        interval: 'month',
                        features: [
                            'Tutto Pro',
                            'Challenge estreme',
                            'Analytics avanzate',
                            'Supporto 24/7'
                        ]
                    }
                };
            }
            
            getProduct(productId) {
                return this.products[productId] || null;
            }
            
            async processPayment(paymentData) {
                await new Promise(resolve => setTimeout(resolve, 2000));
                const success = Math.random() > 0.1;
                
                if (success) {
                    const currentUser = getCurrentUser();
                    if (currentUser) {
                        const subscription = {
                            id: 'SUB_' + Date.now(),
                            productId: paymentData.productId,
                            productName: paymentData.productName || 'Abbonamento',
                            price: paymentData.paymentDetails.amount,
                            interval: 'month',
                            status: 'active',
                            startDate: new Date().toISOString(),
                            endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                            transactionId: 'TXN_' + Date.now(),
                            autoRenew: true
                        };
                        
                        currentUser.subscription = subscription;
                        currentUser.subscriptionHistory = currentUser.subscriptionHistory || [];
                        currentUser.subscriptionHistory.push(subscription);
                        
                        const users = JSON.parse(localStorage.getItem('users') || '[]');
                        const userIndex = users.findIndex(u => u.id === currentUser.id);
                        if (userIndex !== -1) {
                            users[userIndex] = currentUser;
                            localStorage.setItem('users', JSON.stringify(users));
                        }
                        
                        const subscriptions = JSON.parse(localStorage.getItem('subscriptions') || '[]');
                        subscriptions.push({
                            id: subscription.id,
                            userId: currentUser.id,
                            plan: paymentData.productId,
                            status: 'active',
                            createdAt: new Date().toISOString(),
                            price: `â‚¬${paymentData.paymentDetails.amount}/mese`
                        });
                        localStorage.setItem('subscriptions', JSON.stringify(subscriptions));
                    }
                    
                    return { 
                        success: true, 
                        transactionId: 'TXN_' + Date.now(),
                        subscriptionId: 'SUB_' + Date.now()
                    };
                } else {
                    return { 
                        success: false, 
                        error: 'Pagamento rifiutato dalla banca' 
                    };
                }
            }
        }
        
        // Initialize payment service
        paymentService = new PaymentService();
        console.log('Payment Service initialized');
        
        // PaymentService is now integrated directly - no fallback needed

        async function purchasePlan(planId) {
            showNotification('ðŸš§ Abbonamenti temporaneamente disabilitati', 'warning');
            return;
        }

        function showPaymentModal(product, user) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ðŸ’³ Acquista ${product.name}</h3>
                        <button class="close-btn" onclick="closePaymentModal()">Ã—</button>
                    </div>
                    <div class="modal-body">
                        <div class="payment-summary">
                            <h4>Riepilogo Ordine</h4>
                            <div class="product-info">
                                <div class="product-name">${product.name}</div>
                                <div class="product-price">â‚¬${product.price.toFixed(2)}/${product.interval === 'month' ? 'mese' : 'anno'}</div>
                            </div>
                            <div class="product-features">
                                <h5>Incluso:</h5>
                                <ul>
                                    ${product.features.map(feature => `<li>${feature}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                        
                        <div class="payment-methods">
                            <h4>Metodo di Pagamento</h4>
                            <div class="payment-options">
                                <label class="payment-option">
                                    <input type="radio" name="payment-method" value="stripe" checked>
                                    <span>ðŸ’³ Carta di Credito (Stripe)</span>
                                </label>
                                <label class="payment-option">
                                    <input type="radio" name="payment-method" value="paypal">
                                    <span>ðŸ…¿ï¸ PayPal</span>
                                </label>
                                <label class="payment-option">
                                    <input type="radio" name="payment-method" value="apple_pay">
                                    <span>ðŸŽ Apple Pay</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="payment-total">
                            <div class="total-line">
                                <span>Prezzo base:</span>
                                <span>â‚¬${product.price.toFixed(2)}</span>
                            </div>
                            <div class="total-line">
                                <span>IVA (22%):</span>
                                <span>â‚¬${(product.price * 0.22).toFixed(2)}</span>
                            </div>
                            <div class="total-line total-final">
                                <span><strong>Totale:</strong></span>
                                <span><strong>â‚¬${(product.price * 1.22).toFixed(2)}</strong></span>
                            </div>
                        </div>
                        
                        <div class="payment-actions">
                            <button class="btn-secondary" onclick="closePaymentModal()">Annulla</button>
                            <button class="btn-primary" onclick="processPayment('${product.id}')">ðŸ’³ Acquista Ora</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.style.display = 'flex';
        }

        async function processPayment(productId) {
            try {
                console.log('processPayment chiamato con productId:', productId);
                const paymentMethod = document.querySelector('input[name="payment-method"]:checked').value;
                console.log('Payment method selezionato:', paymentMethod);
                const currentUser = getCurrentUser();
                console.log('Current user:', currentUser);
                
                showNotification('Elaborazione pagamento...', 'info');
                
                // Simula elaborazione pagamento
                const product = paymentService.getProduct(productId);
                const paymentData = {
                    method: paymentMethod,
                    productId: productId,
                    productName: product.name,
                    userId: currentUser.id,
                    paymentDetails: {
                        amount: product.price,
                        currency: 'EUR'
                    }
                };
                
                const result = await paymentService.processPayment(paymentData);
                console.log('Payment result:', result);
                
                if (result.success) {
                    showNotification('Pagamento completato con successo!', 'success');
                    closePaymentModal();
                    
                    // Aggiorna UI utente
                    updateUserSubscriptionUI();
                    
                    // Mostra conferma
                    showPaymentConfirmation(result);
                    
                    // Ricarica abbonamenti admin se siamo in admin
                    if (document.getElementById('subscriptions-tab')) {
                        loadSubscriptions();
                    }
                } else {
                    showNotification('Pagamento fallito: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('Errore elaborazione pagamento:', error);
                showNotification('Errore durante l\'elaborazione del pagamento', 'error');
            }
        }

        function closePaymentModal() {
            const modal = document.querySelector('.modal');
            if (modal) {
                modal.remove();
            }
        }
        
        function updateUserSubscriptionUI() {
            const currentUser = getCurrentUser();
            if (currentUser && currentUser.subscription) {
                console.log('Aggiornando UI per abbonamento:', currentUser.subscription);
                // Aggiorna i pulsanti degli abbonamenti
                const planButtons = document.querySelectorAll('[onclick*="purchasePlan"]');
                planButtons.forEach(btn => {
                    if (btn.onclick.toString().includes(currentUser.subscription.productId)) {
                        btn.textContent = 'Attuale';
                        btn.className = 'btn-secondary';
                        btn.disabled = true;
                    }
                });
            }
        }

        function showPaymentConfirmation(result) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>âœ… Pagamento Completato!</h3>
                    </div>
                    <div class="modal-body">
                        <div class="success-message">
                            <div class="success-icon">ðŸŽ‰</div>
                            <h4>Grazie per il tuo acquisto!</h4>
                            <p>Il tuo abbonamento Ã¨ stato attivato con successo.</p>
                            
                            <div class="confirmation-details">
                                <div class="detail-row">
                                    <span>ID Transazione:</span>
                                    <span>${result.transactionId}</span>
                                </div>
                                <div class="detail-row">
                                    <span>ID Abbonamento:</span>
                                    <span>${result.subscriptionId}</span>
                                </div>
                                <div class="detail-row">
                                    <span>Data:</span>
                                    <span>${new Date().toLocaleDateString('it-IT')}</span>
                                </div>
                            </div>
                            
                            <div class="next-steps">
                                <h5>Prossimi passi:</h5>
                                <ul>
                                    <li>âœ… Il tuo abbonamento Ã¨ attivo</li>
                                    <li>ðŸ“§ Riceverai una email di conferma</li>
                                    <li>ðŸŽ¯ Inizia a usare le funzionalitÃ  premium</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="modal-actions">
                            <button class="btn-primary" onclick="closePaymentModal(); showSettingsTab('subscription')">Vai agli Abbonamenti</button>
                            <button class="btn-secondary" onclick="closePaymentModal()">Chiudi</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.style.display = 'flex';
        }

        function updateUserSubscriptionUI() {
            const currentUser = getCurrentUser();
            if (currentUser && currentUser.subscription) {
                // Aggiorna badge abbonamento
                const subscriptionBadge = document.querySelector('.subscription-badge');
                if (subscriptionBadge) {
                    subscriptionBadge.textContent = currentUser.subscription.productName;
                    subscriptionBadge.className = `subscription-badge ${currentUser.subscription.productId}`;
                }
                
                // Aggiorna interfaccia utente
                updateUIForLoggedInUser(currentUser);
            }
        }

        // Payment Configuration Functions
        function saveStripeConfig() {
            try {
                const publicKey = document.getElementById('stripe-public-key').value;
                const secretKey = document.getElementById('stripe-secret-key').value;
                const webhookSecret = document.getElementById('stripe-webhook-secret').value;
                
                if (!publicKey || !secretKey || !webhookSecret) {
                    showNotification('Compila tutti i campi Stripe', 'error');
                    return;
                }
                
                const stripeConfig = {
                    publicKey: publicKey,
                    secretKey: secretKey,
                    webhookSecret: webhookSecret,
                    lastUpdated: new Date().toISOString()
                };
                
                localStorage.setItem('stripeConfig', JSON.stringify(stripeConfig));
                showNotification('Configurazione Stripe salvata!', 'success');
                
                // Aggiorna PaymentService
                if (paymentService) {
                    paymentService.stripePublicKey = publicKey;
                }
                
            } catch (error) {
                console.error('Errore salvataggio Stripe:', error);
                showNotification('Errore nel salvataggio', 'error');
            }
        }

        function savePayPalConfig() {
            try {
                const clientId = document.getElementById('paypal-client-id').value;
                const clientSecret = document.getElementById('paypal-client-secret').value;
                const webhookId = document.getElementById('paypal-webhook-id').value;
                
                if (!clientId || !clientSecret || !webhookId) {
                    showNotification('Compila tutti i campi PayPal', 'error');
                    return;
                }
                
                const paypalConfig = {
                    clientId: clientId,
                    clientSecret: clientSecret,
                    webhookId: webhookId,
                    lastUpdated: new Date().toISOString()
                };
                
                localStorage.setItem('paypalConfig', JSON.stringify(paypalConfig));
                showNotification('Configurazione PayPal salvata!', 'success');
                
                // Aggiorna PaymentService
                if (paymentService) {
                    paymentService.paypalClientId = clientId;
                }
                
            } catch (error) {
                console.error('Errore salvataggio PayPal:', error);
                showNotification('Errore nel salvataggio', 'error');
            }
        }

        function saveMobilePayConfig() {
            try {
                const applePayDomain = document.getElementById('apple-pay-domain').value;
                const googlePayMerchantId = document.getElementById('google-pay-merchant-id').value;
                
                if (!applePayDomain || !googlePayMerchantId) {
                    showNotification('Compila tutti i campi Mobile Pay', 'error');
                    return;
                }
                
                const mobilePayConfig = {
                    applePayDomain: applePayDomain,
                    googlePayMerchantId: googlePayMerchantId,
                    lastUpdated: new Date().toISOString()
                };
                
                localStorage.setItem('mobilePayConfig', JSON.stringify(mobilePayConfig));
                showNotification('Configurazione Mobile Pay salvata!', 'success');
                
            } catch (error) {
                console.error('Errore salvataggio Mobile Pay:', error);
                showNotification('Errore nel salvataggio', 'error');
            }
        }

        function testStripeConnection() {
            showNotification('Test connessione Stripe...', 'info');
            
            // Simula test connessione
            setTimeout(() => {
                const success = Math.random() > 0.2; // 80% successo
                if (success) {
                    showNotification('âœ… Connessione Stripe OK!', 'success');
                    updatePaymentStatus('stripe', 'success');
                } else {
                    showNotification('âŒ Errore connessione Stripe', 'error');
                    updatePaymentStatus('stripe', 'error');
                }
            }, 2000);
        }

        function testPayPalConnection() {
            showNotification('Test connessione PayPal...', 'info');
            
            // Simula test connessione
            setTimeout(() => {
                const success = Math.random() > 0.2; // 80% successo
                if (success) {
                    showNotification('âœ… Connessione PayPal OK!', 'success');
                    updatePaymentStatus('paypal', 'success');
                } else {
                    showNotification('âŒ Errore connessione PayPal', 'error');
                    updatePaymentStatus('paypal', 'error');
                }
            }, 2000);
        }

        function testMobilePayConnection() {
            showNotification('Test connessione Mobile Pay...', 'info');
            
            // Simula test connessione
            setTimeout(() => {
                const success = Math.random() > 0.2; // 80% successo
                if (success) {
                    showNotification('âœ… Connessione Mobile Pay OK!', 'success');
                    updatePaymentStatus('mobile', 'success');
                } else {
                    showNotification('âŒ Errore connessione Mobile Pay', 'error');
                    updatePaymentStatus('mobile', 'error');
                }
            }, 2000);
        }

        function updatePaymentStatus(provider, status) {
            const statusElements = {
                stripe: document.querySelector('.stat-row:nth-child(1) .status-indicator'),
                paypal: document.querySelector('.stat-row:nth-child(2) .status-indicator'),
                mobile: document.querySelector('.stat-row:nth-child(3) .status-indicator')
            };
            
            const element = statusElements[provider];
            if (element) {
                element.className = `status-indicator ${status}`;
                element.textContent = status === 'success' ? 'âœ… Connesso' : 'âŒ Errore';
            }
        }

        function refreshPaymentStatus() {
            showNotification('Aggiornamento stato pagamenti...', 'info');
            
            // Simula aggiornamento stato
            setTimeout(() => {
                const providers = ['stripe', 'paypal', 'mobile'];
                providers.forEach(provider => {
                    const success = Math.random() > 0.1; // 90% successo
                    updatePaymentStatus(provider, success ? 'success' : 'error');
                });
                
                showNotification('Stato pagamenti aggiornato!', 'success');
            }, 1500);
        }

        function viewPaymentLogs() {
            const logs = [
                { time: '14:30:25', level: 'INFO', message: 'Pagamento Stripe completato - â‚¬4.99' },
                { time: '14:28:12', level: 'INFO', message: 'Webhook PayPal ricevuto - Subscription created' },
                { time: '14:25:45', level: 'WARN', message: 'Tentativo pagamento fallito - Carta scaduta' },
                { time: '14:22:18', level: 'INFO', message: 'Test connessione Stripe - OK' },
                { time: '14:20:33', level: 'ERROR', message: 'Errore webhook PayPal - Signature invalid' }
            ];
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ðŸ“‹ Log Pagamenti</h3>
                        <button class="close-btn" onclick="this.closest('.modal').remove()">Ã—</button>
                    </div>
                    <div class="modal-body">
                        <div class="logs-container">
                            ${logs.map(log => `
                                <div class="log-entry ${log.level.toLowerCase()}">
                                    <span class="log-time">${log.time}</span>
                                    <span class="log-level">${log.level}</span>
                                    <span class="log-message">${log.message}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="modal-actions">
                            <button class="btn-secondary" onclick="this.closest('.modal').remove()">Chiudi</button>
                            <button class="btn-primary" onclick="exportPaymentLogs()">ðŸ“¤ Esporta Log</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.style.display = 'flex';
        }

        function exportPaymentLogs() {
            showNotification('Esportazione log in corso...', 'info');
            
            // Simula esportazione
            setTimeout(() => {
                showNotification('Log esportati con successo!', 'success');
            }, 1000);
        }

        function loadPaymentConfig() {
            // Carica configurazioni salvate
            const stripeConfig = JSON.parse(localStorage.getItem('stripeConfig') || '{}');
            const paypalConfig = JSON.parse(localStorage.getItem('paypalConfig') || '{}');
            const mobilePayConfig = JSON.parse(localStorage.getItem('mobilePayConfig') || '{}');
            
            // Popola i campi se esistono
            if (stripeConfig.publicKey) {
                document.getElementById('stripe-public-key').value = stripeConfig.publicKey;
            }
            if (stripeConfig.secretKey) {
                document.getElementById('stripe-secret-key').value = stripeConfig.secretKey;
            }
            if (stripeConfig.webhookSecret) {
                document.getElementById('stripe-webhook-secret').value = stripeConfig.webhookSecret;
            }
            
            if (paypalConfig.clientId) {
                document.getElementById('paypal-client-id').value = paypalConfig.clientId;
            }
            if (paypalConfig.clientSecret) {
                document.getElementById('paypal-client-secret').value = paypalConfig.clientSecret;
            }
            if (paypalConfig.webhookId) {
                document.getElementById('paypal-webhook-id').value = paypalConfig.webhookId;
            }
            
            if (mobilePayConfig.applePayDomain) {
                document.getElementById('apple-pay-domain').value = mobilePayConfig.applePayDomain;
            }
            if (mobilePayConfig.googlePayMerchantId) {
                document.getElementById('google-pay-merchant-id').value = mobilePayConfig.googlePayMerchantId;
            }
            
            // Aggiorna stato pagamenti
            refreshPaymentStatus();
            
            // SEMPRE ATTIVE - Force enable registrations and challenges
            localStorage.setItem('newRegistrations', true);
            localStorage.setItem('challengeMode', true);
        }

        // Chatbot Functions
        function showChatbotModal() {
            document.getElementById('chatbot-modal').style.display = 'flex';
            document.getElementById('chatbot-input').focus();
        }

        function closeChatbotModal() {
            document.getElementById('chatbot-modal').style.display = 'none';
        }

        function sendChatbotMessage() {
            const input = document.getElementById('chatbot-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatbotMessage(message, 'user');
            input.value = '';
            
            // Get bot response
            const response = getChatbotResponse(message);
            
            // Simulate typing delay
            setTimeout(() => {
                addChatbotMessage(response, 'bot');
            }, 1000);
        }

        function addChatbotMessage(message, sender) {
            const messagesContainer = document.getElementById('chatbot-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chatbot-message ${sender}-message`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.innerHTML = message;
            
            messageDiv.appendChild(contentDiv);
            messagesContainer.appendChild(messageDiv);
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function getChatbotResponse(userMessage) {
            const message = userMessage.toLowerCase();
            
            // Alarm related questions
            if (message.includes('allarme') || message.includes('sveglia')) {
                return `ðŸš¨ <strong>OH MIO DIO! LE SVEGLIE WAKEUPPROOF SONO EPICHE!</strong> ðŸ˜±<br><br>
                <strong>ðŸŽ¯ COME CREARE UNA SVEGLIA SADICA:</strong><br>
                â€¢ Clicca "Nuovo Allarme" e preparati al dolore! ðŸ’€<br>
                â€¢ Scegli l'orario (preferibilmente alle 6:00 per massimo terrore!) â°<br>
                â€¢ Seleziona i giorni (tutti i giorni per massimo masochismo!) ðŸ“…<br>
                â€¢ Scegli il suono (piÃ¹ fastidioso = piÃ¹ efficace!) ðŸ”Š<br><br>
                <strong>âœï¸ COME MODIFICARE UNA SVEGLIA:</strong><br>
                â€¢ Clicca il pulsante âœï¸ e cambia tutto! (Anche la tua vita!) ðŸ”„<br><br>
                <strong>ðŸ—‘ï¸ COME ELIMINARE UNA SVEGLIA:</strong><br>
                â€¢ Clicca ðŸ—‘ï¸ e liberati dal dolore! (Ma poi ne creerai un'altra!) ðŸ˜‚<br><br>
                <strong>ðŸŽ¯ LE CHALLENGE SONO IL CUORE DEL DOLORE:</strong><br>
                Ogni sveglia ha challenge CASUALI che devi completare per spegnerla!<br>
                Ãˆ come un videogioco dove devi "sconfiggere" la sveglia! ðŸŽ®<br><br>
                <strong>ðŸ’¡ PRO TIP:</strong> PiÃ¹ challenge = piÃ¹ dolore = piÃ¹ soddisfazione! ðŸ’ªâœ¨`;
            }
            
            // Subscription questions
            if (message.includes('abbonamento') || message.includes('piano') || message.includes('prezzo')) {
                return `ðŸ’³ <strong>GLI ABBONAMENTI WAKEUPPROOF SONO COME SCELTE DI VITA!</strong> ðŸŽ­<br><br>
                <strong>ðŸ†“ GRATIS - Per i principianti del dolore:</strong><br>
                â€¢ 3 sveglie base (giusto per assaggiare il terrore!) ðŸ˜±<br>
                â€¢ Challenge semplici (non troppo sadiche!) ðŸ˜…<br>
                â€¢ Perfetto per chi vuole "assaggiare" il dolore mattutino! ðŸ½ï¸<br><br>
                <strong>â­ PRO (â‚¬4.99/mese) - Per i guerrieri della sveglia:</strong><br>
                â€¢ Allarmi ILLIMITATI (puoi torturarti quanto vuoi!) ðŸ”¥<br>
                â€¢ Challenge avanzate e sadiche (ora si fa sul serio!) ðŸ˜ˆ<br>
                â€¢ Statistiche dettagliate delle tue vittorie (sei un eroe!) ðŸ†<br>
                â€¢ Per chi vuole trasformare la mattina in una battaglia epica! âš”ï¸<br><br>
                <strong>ðŸ‘‘ PREMIUM (â‚¬9.99/mese) - Per i LEGGENDARI:</strong><br>
                â€¢ Sveglie ILLIMITATE (sÃ¬, puoi torturarti quanto vuoi!) ðŸ”¥<br>
                â€¢ AI Coach personale che ti insulta se non ti svegli (rude ma efficace!) ðŸ˜¤<br>
                â€¢ Challenge IMPOSSIBILI per i veri eroi (solo per i coraggiosi!) ðŸ¦¸â€â™‚ï¸<br>
                â€¢ Accesso esclusivo alle challenge segrete (solo per i prescelti!) ðŸ”<br>
                â€¢ Per chi vuole diventare un MAESTRO del risveglio! ðŸŽ“<br><br>
                <strong>ðŸ’¡ PROVA GRATIS PER 7 GIORNI!</strong> (Poi non potrai piÃ¹ smettere!) ðŸ˜ˆâœ¨`;
            }
            
            // Challenge questions
            if (message.includes('challenge') || message.includes('sfida')) {
                return `ðŸŽ¯ <strong>LE CHALLENGE DI WAKEUPPROOF SONO EPICHE!</strong> ðŸš€<br><br>
                <strong>Immagina di svegliarti e trovare sul tuo telefono:</strong><br>
                "Fai 30 jumping jacks in 2 minuti o la sveglia non si ferma!" ðŸ˜‚<br>
                "Rispondi a questa domanda di matematica avanzata o continuerÃ² a suonare!" ðŸ§®<br>
                "Canta 'Happy Birthday' ad alta voce o ti sveglio ogni 5 minuti!" ðŸŽ¤<br><br>
                <strong>ðŸ’ª CHALLENGE FISICHE:</strong><br>
                â€¢ Flessioni, salti, equilibrio (per svegliare il corpo!) ðŸ’ª<br>
                â€¢ Yoga, stretching, cardio (per iniziare la giornata in forma!) ðŸ§˜â€â™€ï¸<br>
                â€¢ Danza, salti, movimenti (per svegliare l'anima!) ðŸ’ƒ<br><br>
                <strong>ðŸ§  CHALLENGE MENTALI:</strong><br>
                â€¢ Calcoli, memoria, puzzle (per svegliare il cervello!) ðŸ§ <br>
                â€¢ Quiz, enigmi, giochi (per stimolare la mente!) ðŸŽ®<br>
                â€¢ Logica, strategia, problem solving (per diventare piÃ¹ intelligenti!) ðŸ¤“<br><br>
                <strong>ðŸŽ¨ CHALLENGE CREATIVE:</strong><br>
                â€¢ Disegno, scrittura, canto (per svegliare l'artista!) ðŸŽ¨<br>
                â€¢ Poesia, musica, arte (per stimolare la creativitÃ !) ðŸŽµ<br>
                â€¢ Storytelling, improvvisazione (per diventare piÃ¹ creativi!) ðŸ“<br><br>
                <strong>ðŸŒŸ CHALLENGE ESTREME (Solo Premium!):</strong><br>
                â€¢ Challenge impossibili per i veri eroi! ðŸ¦¸â€â™‚ï¸<br>
                â€¢ Solo per chi vuole diventare un LEGGENDARIO! ðŸ‘‘<br>
                â€¢ Per chi non ha paura di niente! ðŸ˜ˆ<br><br>
                <strong>ðŸ”¥ ZERO SCUSE, 100% EFFICACIA!</strong> Ãˆ come un videogioco dove devi "sconfiggere" la sveglia! ðŸŽ®âœ¨`;
            }
            
            // Admin questions
            if (message.includes('admin') || message.includes('amministratore')) {
                return `ðŸ” <strong>L'AREA ADMIN Ãˆ IL SANCTUARIUM DEI DEI!</strong> âš¡<br><br>
                <strong>Immagina di essere il DITTATORE SUPREMO di tutte le sveglie del mondo!</strong> ðŸ‘‘<br><br>
                <strong>ðŸ”‘ COME ACCEDERE:</strong><br>
                â€¢ Email: admin@wakeupproof.com<br>
                â€¢ Password: admin123<br>
                â€¢ Oppure: 250862-italia@admin.com<br><br>
                <strong>ðŸ‘¥ GESTIONE UTENTI:</strong><br>
                â€¢ Controllare tutti gli utenti (come un Grande Fratello digitale!) ðŸ‘ï¸<br>
                â€¢ Vedere chi si sveglia e chi no (sei tu il giudice!) âš–ï¸<br>
                â€¢ Decidere chi puÃ² soffrire di piÃ¹! ðŸ˜ˆ<br><br>
                <strong>ðŸ’° GESTIONE ABBONAMENTI:</strong><br>
                â€¢ Approvare/rifiutare abbonamenti (sei tu il padrone!) ðŸ‘‘<br>
                â€¢ Vedere chi paga e chi no (controllo totale!) ðŸ’¸<br>
                â€¢ Decidere chi puÃ² accedere alle funzioni premium! â­<br><br>
                <strong>ðŸ“Š STATISTICHE EPICHE:</strong><br>
                â€¢ Quante persone hai torturato oggi? ðŸ˜ˆ<br>
                â€¢ Quante sveglie sono state create? ðŸ“ˆ<br>
                â€¢ Quante challenge sono state completate? ðŸ†<br><br>
                <strong>âš™ï¸ CONFIGURAZIONI PAGAMENTI:</strong><br>
                â€¢ Stripe, PayPal, Apple Pay, Google Pay (sei tu il capo!) ðŸ’³<br>
                â€¢ Decidere come la gente paga (controllo totale!) ðŸŽ¯<br><br>
                <strong>ðŸ›¡ï¸ SOLO PER AMMINISTRATORI!</strong> Ãˆ come essere il capo di una setta segreta di svegliatori! ðŸ˜ˆâœ¨`;
            }
            
            // General help
            if (message.includes('aiuto') || message.includes('help') || message.includes('come')) {
                return `ðŸ¤– <strong>CIAO, SONO IL CHATBOT PIÃ™ DIVERTENTE DELL'UNIVERSO!</strong> ðŸŽ‰<br><br>
                <strong>Sono qui per aiutarti a navigare nel meraviglioso mondo del dolore mattutino!</strong> ðŸ˜‚<br><br>
                <strong>ðŸš¨ ALLARMI:</strong><br>
                â€¢ Come creare, modificare, eliminare (trasforma la tua vita!) ðŸ”„<br>
                â€¢ Challenge casuali per svegliarti (zero scuse!) ðŸ’ª<br><br>
                <strong>ðŸ’³ ABBONAMENTI:</strong><br>
                â€¢ Piani, prezzi, funzionalitÃ  (scegli il tuo livello di masochismo!) ðŸŽ­<br>
                â€¢ Free, Pro, Premium (dal principiante al leggendario!) ðŸ‘‘<br><br>
                <strong>ðŸŽ¯ CHALLENGE:</strong><br>
                â€¢ Tipi, difficoltÃ , obiettivi (dal semplice all'impossibile!) ðŸš€<br>
                â€¢ Fisiche, mentali, creative, estreme (per tutti i gusti!) ðŸŽ¨<br><br>
                <strong>ðŸ” ADMIN:</strong><br>
                â€¢ Accesso, gestione, configurazioni (diventa un dittatore digitale!) ðŸ‘‘<br>
                â€¢ Controllo totale su utenti e abbonamenti (sei tu il padrone!) ðŸŽ¯<br><br>
                <strong>ðŸ’¡ FAI UNA DOMANDA SPECIFICA!</strong> Sono come un amico che ti aiuta a torturarti ogni mattina! ðŸ˜ˆâœ¨`;
            }
            
            // Default response
            return `ðŸ¤– <strong>OH CIAO! Sono il chatbot piÃ¹ EPICO di WAKEUPG!</strong> ðŸŽª<br><br>
            <strong>Sono qui per trasformare le tue mattine in avventure epiche!</strong> ðŸš€<br><br>
            <strong>Posso aiutarti con:</strong><br>
            â€¢ ðŸš¨ Sveglie impossibili da spegnere<br>
            â€¢ ðŸŽ¯ Challenge che ti faranno sudare<br>
            â€¢ ðŸ’³ Abbonamenti per tutti i gusti<br>
            â€¢ ðŸ” Segreti dell'area admin<br>
            â€¢ ðŸŽ® Gamification e achievement<br>
            â€¢ ðŸ“± Installazione PWA<br>
            â€¢ ðŸ’° Sistemi di pagamento<br><br>
            <strong>Chiedimi QUALSIASI COSA!</strong> Sono come un personal trainer digitale che ti sveglia e ti fa fare esercizi! ðŸ’ª<br><br>
            <strong>ðŸ’¡ PROVA A CHIEDERE:</strong><br>
            â€¢ "Come creo un allarme?"<br>
            â€¢ "Come funzionano gli abbonamenti?"<br>
            â€¢ "Cosa sono le challenge?"<br>
            â€¢ "Come accedo all'admin?"<br><br>
            <strong>Sono qui per rendere la tua vita... interessante!</strong> ðŸ˜ˆâœ¨`;
        }

        // Enter key support for chatbot
        document.addEventListener('DOMContentLoaded', function() {
            const chatbotInput = document.getElementById('chatbot-input');
            if (chatbotInput) {
                chatbotInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendChatbotMessage();
                    }
                });
            }
        });

    </script>

    <!-- Chatbot Modal -->
    <div id="chatbot-modal" class="modal" style="display: none;">
        <div class="modal-content chatbot-modal">
            <div class="modal-header">
                <h2>ðŸ¤– Chatbot AI - WAKEUPG</h2>
                <button class="close-btn" onclick="closeChatbotModal()">&times;</button>
            </div>
            <div class="chatbot-container">
                <div class="chatbot-messages" id="chatbot-messages">
                    <div class="chatbot-message bot-message">
                        <div class="message-content">
                            <strong>ðŸ¤– WAKEUPG AI:</strong> Ciao! Sono il tuo assistente virtuale per WAKEUPG. 
                            Posso aiutarti con domande su allarmi, abbonamenti, challenge e molto altro!
                            <br><br>
                            <strong>ðŸ’¡ Prova a chiedere:</strong>
                            <br>â€¢ "Come creo un allarme?"
                            <br>â€¢ "Come funzionano gli abbonamenti?"
                            <br>â€¢ "Cosa sono le challenge?"
                            <br>â€¢ "Come accedo all'admin?"
                        </div>
                    </div>
                </div>
                <div class="chatbot-input">
                    <input type="text" id="chatbot-input" placeholder="Scrivi la tua domanda..." maxlength="500">
                    <button id="chatbot-send" onclick="sendChatbotMessage()">ðŸ“¤</button>
                </div>
            </div>
        </div>
    </div>

</body>
</html>
