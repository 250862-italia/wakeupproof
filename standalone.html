<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö® WakeUpProof - La Sveglia che NON Puoi Spegnere!</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="üö® LA SVEGLIA CHE NON PUOI SPEGNERE! Challenge reali, zero scuse, 100% efficacia. Trasforma la tua mattina in una vittoria!">
    <meta name="theme-color" content="#1976d2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="WakeUpProof">
    
    <!-- Styles -->
    <style>
        :root {
            /* Vibrant, attention-grabbing colors for sleepers */
            --primary-color: #ff4444;
            --primary-dark: #d32f2f;
            --primary-light: #ff6b6b;
            --secondary-color: #ff6b35;
            --accent-color: #ffd93d;
            --success-color: #00d4aa;
            --error-color: #ff1744;
            --warning-color: #ff9800;
            --info-color: #2196f3;
            
            /* High contrast backgrounds */
            --background-color: #0a0a0a;
            --surface-color: #1a1a1a;
            --surface-variant: #2a2a2a;
            --surface-elevated: #3a3a3a;
            
            /* High contrast text */
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-disabled: #666666;
            --text-accent: #ffd93d;
            
            /* Neon borders */
            --border-color: #333333;
            --border-light: #444444;
            --border-neon: #ff4444;
            
            /* Dramatic shadows */
            --shadow: 0 4px 20px rgba(255, 68, 68, 0.3);
            --shadow-hover: 0 8px 30px rgba(255, 68, 68, 0.4);
            --shadow-elevated: 0 12px 40px rgba(255, 68, 68, 0.5);
            --shadow-neon: 0 0 20px rgba(255, 68, 68, 0.6);
            
            /* Rounded corners */
            --border-radius: 16px;
            --border-radius-sm: 12px;
            --border-radius-lg: 24px;
            
            /* Smooth transitions */
            --transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --transition-fast: all 0.2s ease;
            --transition-bounce: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            
            /* Eye-catching gradients */
            --gradient-primary: linear-gradient(135deg, #ff4444 0%, #ff6b6b 50%, #ffd93d 100%);
            --gradient-success: linear-gradient(135deg, #00d4aa 0%, #00ffcc 100%);
            --gradient-warning: linear-gradient(135deg, #ff6b35 0%, #ff9800 100%);
            --gradient-error: linear-gradient(135deg, #ff1744 0%, #ff4444 100%);
            --gradient-neon: linear-gradient(135deg, #ff4444 0%, #ffd93d 50%, #00d4aa 100%);
            --gradient-dark: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--gradient-dark);
            background-attachment: fixed;
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 68, 68, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 211, 61, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(0, 212, 170, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        #app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .navbar {
            background: var(--gradient-dark);
            padding: 1.5rem 2rem;
            box-shadow: var(--shadow-neon);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
            border-bottom: 2px solid var(--border-neon);
            border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg);
            position: relative;
            overflow: hidden;
        }

        .navbar::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 68, 68, 0.2), transparent);
            animation: shimmer 3s infinite;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .nav-brand h1 {
            background: var(--gradient-neon);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2rem;
            font-weight: 900;
            letter-spacing: -0.02em;
            text-shadow: 0 0 20px rgba(255, 68, 68, 0.5);
            animation: textGlow 2s ease-in-out infinite alternate;
        }

        .nav-brand::before {
            content: "üö®";
            font-size: 2rem;
            animation: alarmPulse 1s infinite;
            filter: drop-shadow(0 0 10px rgba(255, 68, 68, 0.8));
        }

        @keyframes textGlow {
            from { text-shadow: 0 0 20px rgba(255, 68, 68, 0.5); }
            to { text-shadow: 0 0 30px rgba(255, 68, 68, 0.8), 0 0 40px rgba(255, 211, 61, 0.3); }
        }

        @keyframes alarmPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .nav-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-primary, .btn-secondary, .btn-icon {
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-neon);
            border: 2px solid var(--border-neon);
            position: relative;
            overflow: hidden;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: var(--shadow-elevated);
            border-color: var(--accent-color);
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:active {
            transform: translateY(-1px) scale(1.02);
        }

        .btn-secondary {
            background: var(--surface-color);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            box-shadow: var(--shadow);
        }

        .btn-secondary:hover {
            background: var(--surface-variant);
            border-color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: var(--shadow-hover);
        }

        .btn-icon {
            padding: 0.5rem;
            background: transparent;
            color: var(--text-secondary);
            font-size: 1.2rem;
        }

        .btn-icon:hover {
            color: var(--primary-color);
            background: var(--background-color);
        }

        .main-content {
            flex: 1;
            padding: 1rem;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }

        .alarm-status {
            background: var(--surface-color);
            padding: 2rem;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            text-align: center;
            border: 1px solid var(--border-light);
            position: relative;
            overflow: hidden;
        }

        .alarm-status::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .status-indicator {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--gradient-success);
            margin: 0 auto 1rem;
            animation: pulse 2s infinite;
            box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.4);
        }

        .status-indicator.ringing {
            background: var(--gradient-error);
            animation: alarm-pulse 0.5s infinite;
            box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.4);
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 1; 
                transform: scale(1);
            }
            50% { 
                opacity: 0.7; 
                transform: scale(1.05);
            }
        }

        @keyframes alarm-pulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.4);
            }
            50% { 
                transform: scale(1.2);
                box-shadow: 0 0 0 10px rgba(244, 67, 54, 0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -200px 0;
            }
            100% {
                background-position: calc(200px + 100%) 0;
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .fade-in-scale {
            animation: fadeInScale 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .bounce-in {
            animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        .modal {
            animation: fadeInScale 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal-overlay {
            animation: fadeInScale 0.2s ease-out;
        }

        /* Alarm active state */
        body.alarm-active {
            animation: alarm-glow 2s infinite;
        }

        body.alarm-active::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(244, 67, 54, 0.1) 0%, transparent 70%);
            pointer-events: none;
            z-index: -1;
            animation: pulse 2s infinite;
        }

        .status-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Hero Section */
        .hero-section {
            background: var(--gradient-dark);
            padding: 3rem 2rem;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-neon);
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 2px solid var(--border-neon);
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 20%, rgba(255, 68, 68, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(255, 211, 61, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .hero-title {
            font-size: 2.5rem;
            font-weight: 900;
            background: var(--gradient-neon);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            text-shadow: 0 0 30px rgba(255, 68, 68, 0.5);
            animation: textGlow 2s ease-in-out infinite alternate;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin-top: 2rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background: var(--surface-elevated);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-neon);
            min-width: 120px;
            transition: var(--transition);
        }

        .stat-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-neon);
        }

        .stat-number {
            display: block;
            font-size: 2rem;
            font-weight: 900;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            display: block;
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 0.5rem;
        }

        /* Progress Section */
        .progress-section {
            background: var(--gradient-dark);
            padding: 2rem;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-neon);
            margin-bottom: 2rem;
            border: 2px solid var(--border-neon);
            position: relative;
            overflow: hidden;
        }

        .progress-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-neon);
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .progress-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            background: var(--surface-elevated);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-neon);
            transition: var(--transition);
        }

        .progress-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-neon);
            border-color: var(--accent-color);
        }

        .progress-icon {
            font-size: 2rem;
            filter: drop-shadow(0 0 10px rgba(255, 68, 68, 0.5));
        }

        .progress-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .progress-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .progress-value {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .achievement-badge {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            background: var(--gradient-success);
            border-radius: var(--border-radius);
            border: 2px solid var(--success-color);
            text-align: center;
            justify-content: center;
            animation: bounceIn 1s ease-out;
        }

        .badge-icon {
            font-size: 2rem;
            filter: drop-shadow(0 0 10px rgba(0, 212, 170, 0.5));
        }

        .badge-text {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        section {
            background: var(--surface-color);
            padding: 2rem;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid var(--border-light);
            position: relative;
            overflow: hidden;
        }

        section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
        }

        section h2 {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.01em;
        }

        .alarms-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .alarm-item {
            background: var(--surface-color);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-light);
            border-left: 4px solid var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .alarm-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient-primary);
        }

        .alarm-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
            border-color: var(--primary-light);
        }

        .alarm-item.active {
            border-left-color: var(--error-color);
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
            animation: alarm-glow 2s infinite;
        }

        @keyframes alarm-glow {
            0%, 100% { box-shadow: var(--shadow); }
            50% { box-shadow: 0 4px 20px rgba(244, 67, 54, 0.3); }
        }

        .alarm-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .alarm-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-accent);
            margin-bottom: 0.25rem;
        }

        .alarm-time {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .alarm-days {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .alarm-sound {
            font-size: 0.9rem;
            color: var(--text-accent);
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .alarm-challenges {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .alarm-actions {
            display: flex;
            gap: 0.5rem;
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }


        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .feature-card {
            background: var(--gradient-dark);
            padding: 2rem;
            border-radius: var(--border-radius-lg);
            border: 2px solid var(--border-neon);
            text-align: center;
            transition: var(--transition-bounce);
            box-shadow: var(--shadow-neon);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: var(--transition);
        }

        .feature-card:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: var(--shadow-elevated);
            border-color: var(--accent-color);
            background: var(--gradient-neon);
        }

        .feature-card:hover::before {
            transform: scaleX(1);
            background: var(--gradient-primary);
        }

        .feature-card:hover h4 {
            color: var(--text-primary);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .feature-card h4 {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .notifications {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .notification {
            background: var(--surface-color);
            padding: 1.25rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-elevated);
            border: 1px solid var(--border-light);
            border-left: 4px solid var(--primary-color);
            max-width: 350px;
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient-primary);
        }

        .notification.success {
            border-left-color: var(--success-color);
        }

        .notification.success::before {
            background: var(--gradient-success);
        }

        .notification.error {
            border-left-color: var(--error-color);
        }

        .notification.error::before {
            background: var(--gradient-error);
        }

        .notification.warning {
            border-left-color: var(--warning-color);
        }

        .notification.warning::before {
            background: var(--gradient-warning);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal {
            background: var(--surface-color);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-elevated);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--border-light);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--gradient-primary);
            color: white;
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
            padding: 0.25rem;
            border-radius: var(--border-radius-sm);
            transition: var(--transition);
        }

        .btn-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            font-size: 1rem;
            transition: var(--transition);
            background: var(--surface-color);
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
        }

        .challenge-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
            margin-top: 0.5rem;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            background: var(--surface-color);
        }

        .checkbox-label:hover {
            border-color: var(--primary-color);
            background: var(--surface-variant);
        }

        .checkbox-label input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        /* Days Selector */
        .days-selector {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .day-checkbox {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.75rem;
            background: var(--surface-elevated);
            border: 2px solid var(--border-neon);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            min-width: 60px;
            text-align: center;
        }

        .day-checkbox:hover {
            background: var(--gradient-primary);
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .day-checkbox input[type="checkbox"] {
            display: none;
        }

        .day-checkbox input[type="checkbox"]:checked + span {
            color: var(--text-primary);
            font-weight: 700;
        }

        .day-checkbox input[type="checkbox"]:checked {
            background: var(--gradient-primary);
            border-color: var(--accent-color);
        }

        .day-checkbox span {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .day-checkbox:has(input:checked) {
            background: var(--gradient-primary);
            border-color: var(--accent-color);
            box-shadow: var(--shadow-neon);
        }

        .day-checkbox:has(input:checked) span {
            color: var(--text-primary);
            font-weight: 700;
        }

        /* Sound Selector */
        .sound-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .sound-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: var(--surface-elevated);
            border: 2px solid var(--border-neon);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .sound-option:hover {
            background: var(--gradient-primary);
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-neon);
        }

        .sound-option.selected {
            background: var(--gradient-primary);
            border-color: var(--accent-color);
            box-shadow: var(--shadow-neon);
        }

        .sound-preview {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .sound-icon {
            font-size: 1.5rem;
            filter: drop-shadow(0 0 10px rgba(255, 68, 68, 0.5));
        }

        .sound-name {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .sound-play-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sound-play-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-neon);
        }

        .sound-play-btn.playing {
            background: var(--gradient-success);
            animation: pulse 1s infinite;
        }

        /* Challenge Modal Styles */
        .challenge-modal {
            z-index: 1000;
        }

        .challenge-modal-content {
            max-width: 500px;
            background: var(--gradient-dark);
            border: 3px solid var(--border-neon);
            box-shadow: var(--shadow-elevated);
        }

        .challenge-modal .modal-header {
            background: var(--gradient-neon);
            color: var(--text-primary);
            text-align: center;
            padding: 2rem;
            position: relative;
        }

        .challenge-icon {
            font-size: 3rem;
            margin: 1rem 0;
            animation: bounceIn 1s ease-out;
        }

        .challenge-info {
            text-align: center;
            margin-bottom: 2rem;
        }

        .challenge-info h4 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-accent);
            margin-bottom: 1rem;
        }

        .challenge-description {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .challenge-difficulty {
            margin-bottom: 1rem;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .difficulty-badge.easy {
            background: var(--gradient-success);
            color: white;
        }

        .difficulty-badge.medium {
            background: var(--gradient-warning);
            color: white;
        }

        .difficulty-badge.hard {
            background: var(--gradient-primary);
            color: white;
        }

        .difficulty-badge.extreme {
            background: var(--gradient-error);
            color: white;
            animation: pulse 1s infinite;
        }

        .challenge-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .challenge-timer {
            text-align: center;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-accent);
            background: var(--surface-elevated);
            padding: 1rem;
            border-radius: var(--border-radius);
            border: 2px solid var(--border-neon);
        }

        /* Settings Modal Styles */
        .settings-modal {
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .settings-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 1rem;
        }

        .tab-btn {
            background: transparent;
            border: 2px solid var(--border-color);
            color: var(--text-secondary);
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .tab-btn:hover {
            background: var(--surface-elevated);
            border-color: var(--border-neon);
            color: var(--text-primary);
        }

        .tab-btn.active {
            background: var(--gradient-primary);
            border-color: var(--border-neon);
            color: white;
            box-shadow: var(--shadow-neon);
        }

        .settings-tab {
            display: none;
        }

        .settings-tab.active {
            display: block;
        }

        .settings-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .option-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: var(--surface-elevated);
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .option-item:hover {
            border-color: var(--border-neon);
            box-shadow: var(--shadow);
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--surface-color);
            transition: 0.4s;
            border-radius: 34px;
            border: 2px solid var(--border-color);
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: var(--gradient-primary);
            border-color: var(--border-neon);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .privacy-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .btn-error {
            background: var(--gradient-error);
            color: white;
            border: 2px solid var(--border-error);
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-error:hover {
            background: var(--gradient-error);
            box-shadow: var(--shadow-error);
            transform: translateY(-2px);
        }

        .subscription-info {
            background: var(--surface-elevated);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border: 2px solid var(--border-neon);
            margin-top: 2rem;
            text-align: center;
        }

        .subscription-info p {
            margin: 0.5rem 0;
            color: var(--text-secondary);
        }

        .subscription-info p:first-child {
            color: var(--text-accent);
            font-weight: 700;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-light);
        }

        /* Leaderboard styles */
        .leaderboard {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--surface-elevated);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-neon);
            transition: var(--transition);
        }

        .leaderboard-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-neon);
        }

        .leaderboard-item.rank-1 {
            background: var(--gradient-warning);
            border-color: var(--warning-color);
        }

        .leaderboard-item.rank-2 {
            background: var(--gradient-success);
            border-color: var(--success-color);
        }

        .leaderboard-item.rank-3 {
            background: var(--gradient-primary);
            border-color: var(--primary-color);
        }

        .leaderboard-item.your-rank {
            background: var(--gradient-neon);
            border-color: var(--accent-color);
            animation: bounceIn 1s ease-out;
        }

        .leaderboard .rank {
            font-size: 1.5rem;
            min-width: 2rem;
        }

        .leaderboard .name {
            flex: 1;
            font-weight: 600;
            color: var(--text-primary);
        }

        .leaderboard .score {
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .leaderboard-actions {
            text-align: center;
            padding-top: 1rem;
            border-top: 1px solid var(--border-light);
        }

        /* Subscription plans */
        .subscription-plans {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .plan-card {
            background: var(--gradient-dark);
            padding: 2rem;
            border-radius: var(--border-radius-lg);
            border: 2px solid var(--border-neon);
            text-align: center;
            transition: var(--transition-bounce);
            position: relative;
            overflow: hidden;
        }

        .plan-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: var(--shadow-elevated);
        }

        .plan-card.pro {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-neon);
        }

        .plan-card.premium {
            border-color: var(--accent-color);
            box-shadow: var(--shadow-elevated);
            background: var(--gradient-neon);
        }

        .plan-card h4 {
            font-size: 1.5rem;
            font-weight: 900;
            margin-bottom: 1rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .plan-price {
            font-size: 2rem;
            font-weight: 900;
            color: var(--text-accent);
            margin-bottom: 1.5rem;
        }

        .plan-features {
            list-style: none;
            margin-bottom: 2rem;
        }

        .plan-features li {
            padding: 0.5rem 0;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border-light);
        }

        .plan-features li:last-child {
            border-bottom: none;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 0.5rem;
            }
            
            .navbar {
                padding: 0.75rem;
            }
            
            .nav-brand h1 {
                font-size: 1.2rem;
            }
            
            section {
                padding: 1rem;
            }
            
            .alarm-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .alarm-actions {
                width: 100%;
                justify-content: flex-end;
            }

            .modal {
                width: 95%;
                margin: 1rem;
            }

            .challenge-options {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-brand">
                <h1>üö® WakeUpProof</h1>
            </div>
            <div class="nav-actions">
                <button id="share-btn" class="btn-icon" title="Condividi la tua vittoria">üì§</button>
                <button id="leaderboard-btn" class="btn-icon" title="Classifica">üèÜ</button>
                <button id="settings-btn" class="btn-icon" title="Impostazioni">‚öôÔ∏è</button>
                <button id="subscription-btn" class="btn-icon" title="Abbonamenti">üí≥</button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Alarm Status -->
            <div id="alarm-status" class="alarm-status">
                <div class="status-indicator" id="status-indicator"></div>
                <div class="status-text" id="status-text">Sistema pronto</div>
            </div>

            <!-- Hero Section -->
            <div class="hero-section">
                <div class="hero-content">
                    <h2 class="hero-title">üö® LA SVEGLIA CHE NON PUOI SPEGNERE!</h2>
                    <p class="hero-subtitle">Challenge reali, zero scuse, 100% efficacia. Trasforma la tua mattina in una vittoria!</p>
                    <div class="hero-stats">
                        <div class="stat-item">
                            <span class="stat-number">0%</span>
                            <span class="stat-label">Efficacia</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">0</span>
                            <span class="stat-label">Scuse</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">‚àû</span>
                            <span class="stat-label">Motivazione</span>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Progress Section -->
            <section class="progress-section">
                <h2>üèÜ I Tuoi Progressi</h2>
                <div class="progress-stats">
                    <div class="progress-item">
                        <div class="progress-icon">üî•</div>
                        <div class="progress-info">
                            <span class="progress-label">Streak Giornaliero</span>
                            <span class="progress-value">0 giorni</span>
                        </div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-icon">‚ö°</div>
                        <div class="progress-info">
                            <span class="progress-label">Challenge Completati</span>
                            <span class="progress-value">0</span>
                        </div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-icon">üéØ</div>
                        <div class="progress-info">
                            <span class="progress-label">Efficacia</span>
                            <span class="progress-value">0%</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Active Alarms -->
            <section class="alarms-section">
                <h2>üö® Allarmi Attivi</h2>
                <div id="alarms-list" class="alarms-list">
                    <div class="empty-state">
                        <p>Nessun allarme configurato</p>
                        <p>Clicca "Nuovo Allarme" per iniziare la tua trasformazione!</p>
                    </div>
                </div>
                <button id="add-alarm-btn" class="btn-primary">+ Crea Allarme Impossibile</button>
            </section>

            <!-- Challenge Status -->
            <section class="challenges-section" id="challenges-section" style="display: none;">
                <h2>Challenge Attivi</h2>
                <div id="challenges-list" class="challenges-list">
                    <!-- Challenges will be populated here -->
                </div>
            </section>
        </main>

        <!-- Notifications -->
        <div id="notifications" class="notifications"></div>
    </div>

    <!-- Include real modules -->
    <script src="js/database.js"></script>
    <script src="js/alarm-engine.js"></script>
    <script src="js/challenge-engine.js"></script>
    <script src="js/camera-handler.js"></script>
    <script src="js/sensors-handler.js"></script>
    <script src="js/subscription-service.js"></script>
    <script src="js/ui-manager.js"></script>

    <script>
        // Real WakeUpProof functionality
        let alarmCount = 0;
        let challengeCount = 0;
        let isInitialized = false;

        // Initialize app with real modules
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('WakeUpProof Standalone loaded');
            await initializeApp();
            setupEventListeners();
            showWelcomeMessage();
        });

        async function initializeApp() {
            try {
                // Initialize database
                if (typeof database !== 'undefined') {
                    await database.init();
                    console.log('Database initialized');
                }

                // Initialize services
                if (typeof alarmEngine !== 'undefined') {
                    await alarmEngine.init();
                    console.log('Alarm Engine initialized');
                }

                if (typeof challengeEngine !== 'undefined') {
                    await challengeEngine.init();
                    console.log('Challenge Engine initialized');
                }

                if (typeof subscriptionService !== 'undefined') {
                    await subscriptionService.init();
                    console.log('Subscription Service initialized');
                }

                // Load existing alarms
                await loadAlarms();
                
                isInitialized = true;
                console.log('WakeUpProof fully initialized');
            } catch (error) {
                console.error('Error initializing app:', error);
                showNotification('Errore inizializzazione app', 'error');
            }
        }

        function setupEventListeners() {
            // Add alarm button
            document.getElementById('add-alarm-btn').addEventListener('click', showAddAlarmModal);
            
            // Navigation buttons
            document.getElementById('share-btn').addEventListener('click', shareVictory);
            document.getElementById('leaderboard-btn').addEventListener('click', showLeaderboard);
            document.getElementById('settings-btn').addEventListener('click', showSettings);
            document.getElementById('subscription-btn').addEventListener('click', showSubscriptions);
        }

        function showWelcomeMessage() {
            showNotification('üö® Benvenuto nel futuro del risveglio! Zero scuse, 100% risultati!', 'success');
            
            // Show achievement popup
            setTimeout(() => {
                showNotification('üèÜ Achievement sbloccato: "Primo Passo verso la Vittoria"', 'warning');
            }, 2000);
        }

        async function loadAlarms() {
            try {
                if (typeof database !== 'undefined') {
                    const alarms = await database.getAlarms();
                    displayAlarms(alarms);
                } else {
                    // Fallback mode
                    displayAlarms([]);
                }
            } catch (error) {
                console.error('Error loading alarms:', error);
                showNotification('Errore caricamento allarmi', 'error');
            }
        }

        function displayAlarms(alarms) {
            const alarmsList = document.getElementById('alarms-list');
            if (!alarmsList) return;

            alarmsList.innerHTML = '';

            if (alarms.length === 0) {
                alarmsList.innerHTML = `
                    <div class="empty-state">
                        <p>Nessun allarme configurato</p>
                        <p>Clicca "Nuovo Allarme" per iniziare</p>
                    </div>
                `;
                return;
            }

            alarms.forEach(alarm => {
                addAlarmToList(alarm);
            });
        }

        async function showAddAlarmModal() {
            // Create modal for adding alarm
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <h3>Nuovo Allarme</h3>
                        <button class="btn-close" onclick="this.closest('.modal-overlay').remove()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="add-alarm-form">
                            <div class="form-group">
                                <label for="alarm-name">Nome Allarme</label>
                                <input type="text" id="alarm-name" placeholder="Es: Sveglia Mattina" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="alarm-time">Orario Sveglia</label>
                                <input type="time" id="alarm-time" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="alarm-days">Giorni della Settimana</label>
                                <div class="days-selector">
                                    <label class="day-checkbox">
                                        <input type="checkbox" value="1" checked>
                                        <span>Lun</span>
                                    </label>
                                    <label class="day-checkbox">
                                        <input type="checkbox" value="2" checked>
                                        <span>Mar</span>
                                    </label>
                                    <label class="day-checkbox">
                                        <input type="checkbox" value="3" checked>
                                        <span>Mer</span>
                                    </label>
                                    <label class="day-checkbox">
                                        <input type="checkbox" value="4" checked>
                                        <span>Gio</span>
                                    </label>
                                    <label class="day-checkbox">
                                        <input type="checkbox" value="5" checked>
                                        <span>Ven</span>
                                    </label>
                                    <label class="day-checkbox">
                                        <input type="checkbox" value="6">
                                        <span>Sab</span>
                                    </label>
                                    <label class="day-checkbox">
                                        <input type="checkbox" value="0">
                                        <span>Dom</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="alarm-sound">Suoneria</label>
                                <div class="sound-selector">
                                    <div class="sound-option" data-sound="classic">
                                        <div class="sound-preview">
                                            <span class="sound-icon">üîî</span>
                                            <span class="sound-name">Classica</span>
                                        </div>
                                        <button type="button" class="sound-play-btn" onclick="playSound('classic')">‚ñ∂Ô∏è</button>
                                    </div>
                                    
                                    <div class="sound-option" data-sound="urgent">
                                        <div class="sound-preview">
                                            <span class="sound-icon">üö®</span>
                                            <span class="sound-name">Urgente</span>
                                        </div>
                                        <button type="button" class="sound-play-btn" onclick="playSound('urgent')">‚ñ∂Ô∏è</button>
                                    </div>
                                    
                                    <div class="sound-option" data-sound="nature">
                                        <div class="sound-preview">
                                            <span class="sound-icon">üåÖ</span>
                                            <span class="sound-name">Natura</span>
                                        </div>
                                        <button type="button" class="sound-play-btn" onclick="playSound('nature')">‚ñ∂Ô∏è</button>
                                    </div>
                                    
                                    <div class="sound-option" data-sound="electronic">
                                        <div class="sound-preview">
                                            <span class="sound-icon">‚ö°</span>
                                            <span class="sound-name">Elettronica</span>
                                        </div>
                                        <button type="button" class="sound-play-btn" onclick="playSound('electronic')">‚ñ∂Ô∏è</button>
                                    </div>
                                    
                                    <div class="sound-option" data-sound="motivational">
                                        <div class="sound-preview">
                                            <span class="sound-icon">üí™</span>
                                            <span class="sound-name">Motivazionale</span>
                                        </div>
                                        <button type="button" class="sound-play-btn" onclick="playSound('motivational')">‚ñ∂Ô∏è</button>
                                    </div>
                                    
                                    <div class="sound-option" data-sound="custom">
                                        <div class="sound-preview">
                                            <span class="sound-icon">üéµ</span>
                                            <span class="sound-name">Personalizzata</span>
                                        </div>
                                        <button type="button" class="sound-play-btn" onclick="playSound('custom')">‚ñ∂Ô∏è</button>
                                    </div>
                                </div>
                                <input type="hidden" id="alarm-sound" name="alarm-sound" value="classic">
                            </div>
                            <div class="form-group">
                                <label for="alarm-recurrence">Ripetizione</label>
                                <select id="alarm-recurrence" required>
                                    <option value="daily">Giornaliero</option>
                                    <option value="weekdays">Lun-Ven</option>
                                    <option value="weekends">Sab-Dom</option>
                                    <option value="once">Una volta</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Challenge</label>
                                <div class="challenge-options">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="challenge-photo" value="photo">
                                        üì∏ Foto bagno
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="challenge-steps" value="steps">
                                        üö∂ Passi (120 in 2min)
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="challenge-nfc" value="nfc">
                                        üì° NFC (Pro)
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="challenge-qr" value="qr">
                                        üì± QR Code (Pro)
                                    </label>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn-secondary" onclick="this.closest('.modal-overlay').remove()">
                                    Annulla
                                </button>
                                <button type="submit" class="btn-primary">
                                    Crea Allarme
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Handle form submission
            modal.querySelector('#add-alarm-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                await createAlarm(modal);
            });
        }

        async function createAlarm(modal) {
            try {
                const formData = new FormData(modal.querySelector('#add-alarm-form'));
                
                // Get selected days
                const selectedDays = Array.from(modal.querySelectorAll('.day-checkbox input:checked'))
                    .map(checkbox => parseInt(checkbox.value));
                
                const alarmData = {
                    name: formData.get('alarm-name') || modal.querySelector('#alarm-name').value || 'Allarme',
                    time: formData.get('alarm-time') || modal.querySelector('#alarm-time').value,
                    days: selectedDays.length > 0 ? selectedDays : [1, 2, 3, 4, 5], // Default to weekdays
                    sound: formData.get('alarm-sound') || modal.querySelector('#alarm-sound').value || 'classic',
                    recurrence: formData.get('alarm-recurrence') || modal.querySelector('#alarm-recurrence').value,
                    challenges: []
                };

                // Collect selected challenges
                const challengeCheckboxes = modal.querySelectorAll('input[type="checkbox"]:checked');
                challengeCheckboxes.forEach(checkbox => {
                    alarmData.challenges.push(checkbox.value);
                });

                // Create alarm using real alarm engine
                if (typeof alarmEngine !== 'undefined') {
                    const alarm = await alarmEngine.createAlarm(alarmData);
                    
                    // Create challenges
                    if (alarmData.challenges.length > 0) {
                        for (const challengeType of alarmData.challenges) {
                            await challengeEngine.createChallenge(alarm.id, challengeType);
                        }
                    }

                    // Reload alarms
                    await loadAlarms();
                    
                    showNotification('Allarme creato con successo! ‚è∞', 'success');
                    modal.remove();
                } else {
                    // Fallback mode
                    alarmCount++;
                    const alarm = {
                        id: 'alarm-' + alarmCount,
                        time: alarmData.time,
                        recurrence: alarmData.recurrence,
                        challenges: alarmData.challenges,
                        enabled: true
                    };
                    
                    addAlarmToList(alarm);
                    showNotification('Allarme creato! ‚è∞', 'success');
                    modal.remove();
                }
            } catch (error) {
                console.error('Error creating alarm:', error);
                showNotification('Errore creazione allarme', 'error');
            }
        }

        function addAlarmToList(alarm) {
            const alarmsList = document.getElementById('alarms-list');
            const emptyState = alarmsList.querySelector('.empty-state');
            
            if (emptyState) {
                emptyState.remove();
            }
            
            // Format days
            const dayNames = ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'];
            const selectedDays = alarm.days ? alarm.days.map(day => dayNames[day]).join(', ') : 'Lun-Ven';
            
            const alarmElement = document.createElement('div');
            alarmElement.className = 'alarm-item fade-in-up';
            // Get sound info
            const soundInfo = soundLibrary[alarm.sound] || soundLibrary.classic;
            
            alarmElement.innerHTML = `
                <div class="alarm-info">
                    <div class="alarm-name">${alarm.name || 'Allarme'}</div>
                    <div class="alarm-time">${alarm.time}</div>
                    <div class="alarm-days">${selectedDays}</div>
                    <div class="alarm-sound">${soundInfo.icon} ${soundInfo.name}</div>
                    <div class="alarm-challenges">${alarm.challenges ? alarm.challenges.length : 0} challenge ‚Ä¢ ${alarm.recurrence || 'Giornaliero'}</div>
                </div>
                <div class="alarm-actions">
                    <button class="btn-secondary" onclick="editAlarm('${alarm.id}')">‚úèÔ∏è</button>
                    <button class="btn-secondary" onclick="deleteAlarm('${alarm.id}')">üóëÔ∏è</button>
                </div>
            `;
            
            alarmsList.appendChild(alarmElement);
            
            // Add staggered animation for multiple items
            const items = alarmsList.querySelectorAll('.alarm-item');
            items.forEach((item, index) => {
                item.style.animationDelay = `${index * 0.1}s`;
            });
        }

        function editAlarm(alarmId) {
            showNotification('Funzionalit√† di modifica in sviluppo', 'warning');
        }

        function deleteAlarm(alarmId) {
            const alarmElement = document.querySelector(`[onclick="deleteAlarm('${alarmId}')"]`).closest('.alarm-item');
            alarmElement.remove();
            showNotification('Allarme eliminato', 'success');
        }

        function showSettings() {
            showNotification('Impostazioni in sviluppo', 'warning');
        }

        function shareVictory() {
            const shareText = "üö® Ho appena sconfitto la pigrizia con WakeUpProof! La sveglia che NON puoi spegnere! üí™ #WakeUpProof #NoMoreSnooze";
            
            if (navigator.share) {
                navigator.share({
                    title: 'WakeUpProof - La Sveglia Impossibile',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(shareText).then(() => {
                    showNotification('üì§ Testo copiato! Condividi la tua vittoria!', 'success');
                });
            }
        }

        function showLeaderboard() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <h3>üèÜ Classifica Globale</h3>
                        <button class="btn-close" onclick="this.closest('.modal-overlay').remove()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div class="leaderboard">
                            <div class="leaderboard-item rank-1">
                                <span class="rank">ü•á</span>
                                <span class="name">SleepDestroyer99</span>
                                <span class="score">847 punti</span>
                            </div>
                            <div class="leaderboard-item rank-2">
                                <span class="rank">ü•à</span>
                                <span class="name">EarlyBirdMaster</span>
                                <span class="score">723 punti</span>
                            </div>
                            <div class="leaderboard-item rank-3">
                                <span class="rank">ü•â</span>
                                <span class="name">NoSnoozeHero</span>
                                <span class="score">691 punti</span>
                            </div>
                            <div class="leaderboard-item your-rank">
                                <span class="rank">üë§</span>
                                <span class="name">Tu</span>
                                <span class="score">234 punti</span>
                            </div>
                        </div>
                        <div class="leaderboard-actions">
                            <button class="btn-primary" onclick="shareVictory()">Condividi il tuo progresso</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showSettings() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal settings-modal">
                    <div class="modal-header">
                        <h3>‚öôÔ∏è Impostazioni</h3>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">‚úï</button>
                    </div>
                    <div class="modal-body">
                        <div class="settings-tabs">
                            <button class="tab-btn active" onclick="showSettingsTab('profile')">üë§ Profilo</button>
                            <button class="tab-btn" onclick="showSettingsTab('notifications')">üîî Notifiche</button>
                            <button class="tab-btn" onclick="showSettingsTab('privacy')">üîí Privacy</button>
                            <button class="tab-btn" onclick="showSettingsTab('subscription')">üí≥ Abbonamenti</button>
                        </div>
                        
                        <div id="settings-content">
                            <!-- Profile Tab -->
                            <div id="profile-tab" class="settings-tab active">
                                <h4>üë§ I Tuoi Dati</h4>
                                <form id="profile-form">
                                    <div class="form-group">
                                        <label for="user-name">Nome</label>
                                        <input type="text" id="user-name" name="user-name" placeholder="Il tuo nome">
                                    </div>
                                    <div class="form-group">
                                        <label for="user-email">Email</label>
                                        <input type="email" id="user-email" name="user-email" placeholder="tua@email.com">
                                    </div>
                                    <div class="form-group">
                                        <label for="user-age">Et√†</label>
                                        <input type="number" id="user-age" name="user-age" placeholder="25" min="13" max="100">
                                    </div>
                                    <div class="form-group">
                                        <label for="user-timezone">Fuso Orario</label>
                                        <select id="user-timezone" name="user-timezone">
                                            <option value="Europe/Rome">Europa/Roma (GMT+1)</option>
                                            <option value="Europe/London">Europa/Londra (GMT+0)</option>
                                            <option value="America/New_York">America/New York (GMT-5)</option>
                                            <option value="Asia/Tokyo">Asia/Tokyo (GMT+9)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="user-goals">Obiettivi</label>
                                        <textarea id="user-goals" name="user-goals" placeholder="I tuoi obiettivi mattutini..."></textarea>
                                    </div>
                                    <div class="form-actions">
                                        <button type="submit" class="btn-primary">üíæ Salva Dati</button>
                                    </div>
                                </form>
                            </div>
                            
                            <!-- Notifications Tab -->
                            <div id="notifications-tab" class="settings-tab">
                                <h4>üîî Notifiche</h4>
                                <div class="settings-options">
                                    <div class="option-item">
                                        <label class="switch">
                                            <input type="checkbox" id="notifications-enabled" checked>
                                            <span class="slider"></span>
                                        </label>
                                        <span>Notifiche push</span>
                                    </div>
                                    <div class="option-item">
                                        <label class="switch">
                                            <input type="checkbox" id="sound-enabled" checked>
                                            <span class="slider"></span>
                                        </label>
                                        <span>Suoni notifiche</span>
                                    </div>
                                    <div class="option-item">
                                        <label class="switch">
                                            <input type="checkbox" id="vibration-enabled" checked>
                                            <span class="slider"></span>
                                        </label>
                                        <span>Vibrazione</span>
                                    </div>
                                    <div class="option-item">
                                        <label class="switch">
                                            <input type="checkbox" id="reminder-enabled">
                                            <span class="slider"></span>
                                        </label>
                                        <span>Promemoria serali</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Privacy Tab -->
                            <div id="privacy-tab" class="settings-tab">
                                <h4>üîí Privacy e Sicurezza</h4>
                                <div class="settings-options">
                                    <div class="option-item">
                                        <label class="switch">
                                            <input type="checkbox" id="analytics-enabled" checked>
                                            <span class="slider"></span>
                                        </label>
                                        <span>Analytics anonime</span>
                                    </div>
                                    <div class="option-item">
                                        <label class="switch">
                                            <input type="checkbox" id="crash-reports-enabled" checked>
                                            <span class="slider"></span>
                                        </label>
                                        <span>Report crash</span>
                                    </div>
                                    <div class="option-item">
                                        <label class="switch">
                                            <input type="checkbox" id="data-sync-enabled" checked>
                                            <span class="slider"></span>
                                        </label>
                                        <span>Sincronizzazione dati</span>
                                    </div>
                                </div>
                                <div class="privacy-actions">
                                    <button class="btn-secondary" onclick="exportData()">üì§ Esporta Dati</button>
                                    <button class="btn-secondary" onclick="importData()">üì• Importa Dati</button>
                                    <button class="btn-error" onclick="deleteAccount()">üóëÔ∏è Elimina Account</button>
                                </div>
                            </div>
                            
                            <!-- Subscription Tab -->
                            <div id="subscription-tab" class="settings-tab">
                                <h4>üí≥ Abbonamenti</h4>
                                <div class="subscription-plans">
                                    <div class="plan-card">
                                        <h4>üÜì Free</h4>
                                        <p>3 allarmi base</p>
                                        <p>Challenge limitati</p>
                                        <p>Supporto email</p>
                                        <button class="btn-secondary" id="free-plan">Attuale</button>
                                    </div>
                                    <div class="plan-card">
                                        <h4>‚≠ê Pro</h4>
                                        <p>Allarmi illimitati</p>
                                        <p>Challenge avanzati</p>
                                        <p>Suonerie personalizzate</p>
                                        <p>Supporto prioritario</p>
                                        <button class="btn-primary" onclick="purchasePlan('pro')">‚Ç¨4.99/mese</button>
                                    </div>
                                    <div class="plan-card">
                                        <h4>üíé Premium</h4>
                                        <p>Tutto incluso</p>
                                        <p>Challenge estreme</p>
                                        <p>Analytics avanzate</p>
                                        <p>Supporto 24/7</p>
                                        <button class="btn-primary" onclick="purchasePlan('premium')">‚Ç¨9.99/mese</button>
                                    </div>
                                </div>
                                <div class="subscription-info">
                                    <p>üí° <strong>Prova gratis per 7 giorni!</strong></p>
                                    <p>üîÑ Annulla quando vuoi</p>
                                    <p>üîí Pagamenti sicuri</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Load user data
            loadUserData();
            
            // Add form submit listener
            document.getElementById('profile-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveUserData();
            });
        }
        
        // Settings Tab Management
        function showSettingsTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }
        
        // User Data Management
        function loadUserData() {
            const userData = JSON.parse(localStorage.getItem('userData') || '{}');
            
            // Load profile data
            if (userData.name) document.getElementById('user-name').value = userData.name;
            if (userData.email) document.getElementById('user-email').value = userData.email;
            if (userData.age) document.getElementById('user-age').value = userData.age;
            if (userData.timezone) document.getElementById('user-timezone').value = userData.timezone;
            if (userData.goals) document.getElementById('user-goals').value = userData.goals;
            
            // Load notification settings
            if (userData.notifications !== undefined) document.getElementById('notifications-enabled').checked = userData.notifications;
            if (userData.sound !== undefined) document.getElementById('sound-enabled').checked = userData.sound;
            if (userData.vibration !== undefined) document.getElementById('vibration-enabled').checked = userData.vibration;
            if (userData.reminder !== undefined) document.getElementById('reminder-enabled').checked = userData.reminder;
            
            // Load privacy settings
            if (userData.analytics !== undefined) document.getElementById('analytics-enabled').checked = userData.analytics;
            if (userData.crashReports !== undefined) document.getElementById('crash-reports-enabled').checked = userData.crashReports;
            if (userData.dataSync !== undefined) document.getElementById('data-sync-enabled').checked = userData.dataSync;
        }
        
        function saveUserData() {
            const userData = {
                name: document.getElementById('user-name').value,
                email: document.getElementById('user-email').value,
                age: document.getElementById('user-age').value,
                timezone: document.getElementById('user-timezone').value,
                goals: document.getElementById('user-goals').value,
                notifications: document.getElementById('notifications-enabled').checked,
                sound: document.getElementById('sound-enabled').checked,
                vibration: document.getElementById('vibration-enabled').checked,
                reminder: document.getElementById('reminder-enabled').checked,
                analytics: document.getElementById('analytics-enabled').checked,
                crashReports: document.getElementById('crash-reports-enabled').checked,
                dataSync: document.getElementById('data-sync-enabled').checked
            };
            
            localStorage.setItem('userData', JSON.stringify(userData));
            showNotification('üíæ Dati salvati con successo!', 'success');
        }
        
        // Subscription Management
        function purchasePlan(planType) {
            const plans = {
                pro: { name: 'Pro', price: '‚Ç¨4.99/mese', features: ['Allarmi illimitati', 'Challenge avanzati', 'Suonerie personalizzate'] },
                premium: { name: 'Premium', price: '‚Ç¨9.99/mese', features: ['Tutto incluso', 'Challenge estreme', 'Analytics avanzate'] }
            };
            
            const plan = plans[planType];
            if (confirm(`Vuoi acquistare il piano ${plan.name} per ${plan.price}?\n\nCaratteristiche:\n${plan.features.join('\n')}\n\nüí° Prova gratis per 7 giorni!`)) {
                // Simulate purchase process
                showNotification(`üõí Acquisto ${plan.name} in corso...`, 'info');
                
                setTimeout(() => {
                    localStorage.setItem('subscription', JSON.stringify({
                        plan: planType,
                        status: 'active',
                        startDate: new Date().toISOString(),
                        trialEnd: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()
                    }));
                    
                    showNotification(`üéâ Piano ${plan.name} attivato! Prova gratuita di 7 giorni iniziata!`, 'success');
                    
                    // Update UI
                    updateSubscriptionUI();
                }, 2000);
            }
        }
        
        function updateSubscriptionUI() {
            const subscription = JSON.parse(localStorage.getItem('subscription') || '{}');
            const currentPlan = subscription.plan || 'free';
            
            // Update plan buttons
            document.querySelectorAll('.plan-card button').forEach(btn => {
                btn.textContent = 'Attuale';
                btn.className = 'btn-secondary';
            });
            
            if (currentPlan !== 'free') {
                const planCard = document.querySelector(`[onclick="purchasePlan('${currentPlan}')"]`);
                if (planCard) {
                    planCard.textContent = 'Attuale';
                    planCard.className = 'btn-secondary';
                }
            }
        }
        
        // Data Management
        function exportData() {
            const userData = JSON.parse(localStorage.getItem('userData') || '{}');
            const alarms = JSON.parse(localStorage.getItem('alarms') || '[]');
            const subscription = JSON.parse(localStorage.getItem('subscription') || '{}');
            
            const exportData = {
                userData,
                alarms,
                subscription,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `wakeupproof-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('üì§ Dati esportati con successo!', 'success');
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            if (data.userData) localStorage.setItem('userData', JSON.stringify(data.userData));
                            if (data.alarms) localStorage.setItem('alarms', JSON.stringify(data.alarms));
                            if (data.subscription) localStorage.setItem('subscription', JSON.stringify(data.subscription));
                            
                            showNotification('üì• Dati importati con successo!', 'success');
                            location.reload();
                        } catch (error) {
                            showNotification('‚ùå Errore nell\'importazione dei dati', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        function deleteAccount() {
            if (confirm('‚ö†Ô∏è ATTENZIONE: Questa azione eliminer√† TUTTI i tuoi dati!\n\n- Profilo utente\n- Allarmi\n- Progressi\n- Abbonamenti\n\nSei sicuro di voler continuare?')) {
                if (confirm('üö® ULTIMA CONFERMA: Eliminare definitivamente l\'account?')) {
                    localStorage.clear();
                    showNotification('üóëÔ∏è Account eliminato. Arrivederci!', 'info');
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                }
            }
        }
        
        function showSubscriptions() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <h3>üí≥ Scegli il Tuo Piano</h3>
                        <button class="btn-close" onclick="this.closest('.modal-overlay').remove()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div class="subscription-plans">
                            <div class="plan-card free">
                                <h4>üÜì FREE</h4>
                                <div class="plan-price">‚Ç¨0/mese</div>
                                <ul class="plan-features">
                                    <li>1 allarme</li>
                                    <li>2 challenge</li>
                                    <li>Statistiche base</li>
                                </ul>
                                <button class="btn-secondary">Piano Attuale</button>
                            </div>
                            <div class="plan-card pro">
                                <h4>‚ö° PRO</h4>
                                <div class="plan-price">‚Ç¨4.99/mese</div>
                                <ul class="plan-features">
                                    <li>5 allarmi</li>
                                    <li>100 challenge</li>
                                    <li>NFC & QR</li>
                                    <li>Analytics avanzate</li>
                                </ul>
                                <button class="btn-primary">Upgrade</button>
                            </div>
                            <div class="plan-card premium">
                                <h4>üëë PREMIUM</h4>
                                <div class="plan-price">‚Ç¨9.99/mese</div>
                                <ul class="plan-features">
                                    <li>Allarmi illimitati</li>
                                    <li>Challenge personalizzati</li>
                                    <li>Coaching AI</li>
                                    <li>Supporto prioritario</li>
                                </ul>
                                <button class="btn-primary">Upgrade</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Secret Challenge System
        const secretChallenges = [
            // Physical Challenges
            { id: 'jumping_jacks', name: 'Fai 20 jumping jacks', type: 'physical', difficulty: 'medium', icon: 'ü§∏' },
            { id: 'push_ups', name: 'Fai 15 flessioni', type: 'physical', difficulty: 'hard', icon: 'üí™' },
            { id: 'squats', name: 'Fai 25 squat', type: 'physical', difficulty: 'medium', icon: 'ü¶µ' },
            { id: 'plank', name: 'Mantieni il plank per 30 secondi', type: 'physical', difficulty: 'hard', icon: 'üèãÔ∏è' },
            { id: 'burpees', name: 'Fai 10 burpees', type: 'physical', difficulty: 'hard', icon: 'üî•' },
            { id: 'mountain_climbers', name: 'Fai 20 mountain climbers', type: 'physical', difficulty: 'medium', icon: '‚õ∞Ô∏è' },
            { id: 'wall_sit', name: 'Mantieni il wall sit per 45 secondi', type: 'physical', difficulty: 'hard', icon: 'üß±' },
            { id: 'high_knees', name: 'Fai 30 high knees', type: 'physical', difficulty: 'easy', icon: 'üèÉ' },
            { id: 'butt_kicks', name: 'Fai 30 butt kicks', type: 'physical', difficulty: 'easy', icon: 'ü¶µ' },
            { id: 'lunges', name: 'Fai 20 affondi (10 per gamba)', type: 'physical', difficulty: 'medium', icon: 'üö∂' },
            
            // Mental Challenges
            { id: 'math_problem', name: 'Risolvi: 47 √ó 23 = ?', type: 'mental', difficulty: 'medium', icon: 'üßÆ' },
            { id: 'word_scramble', name: 'Trova la parola: RATNSU', type: 'mental', difficulty: 'easy', icon: 'üî§' },
            { id: 'memory_sequence', name: 'Ripeti la sequenza: 7-2-9-1-4', type: 'mental', difficulty: 'medium', icon: 'üß†' },
            { id: 'color_sequence', name: 'Ripeti i colori: Rosso-Verde-Blu-Giallo', type: 'mental', difficulty: 'easy', icon: 'üåà' },
            { id: 'reverse_counting', name: 'Conta alla rovescia da 50 a 0', type: 'mental', difficulty: 'medium', icon: 'üî¢' },
            { id: 'alphabet_backwards', name: 'Recita l\'alfabeto al contrario', type: 'mental', difficulty: 'hard', icon: 'üî§' },
            { id: 'word_count', name: 'Conta le lettere in "WakeUpProof"', type: 'mental', difficulty: 'easy', icon: 'üìù' },
            { id: 'pattern_recognition', name: 'Completa: 2, 4, 8, 16, ?', type: 'mental', difficulty: 'medium', icon: 'üîç' },
            { id: 'spelling_bee', name: 'Spella "IMPOSSIBILE"', type: 'mental', difficulty: 'medium', icon: '‚úçÔ∏è' },
            { id: 'logic_puzzle', name: 'Se oggi √® mercoled√¨, che giorno sar√† tra 100 giorni?', type: 'mental', difficulty: 'hard', icon: 'üß©' },
            
            // Creative Challenges
            { id: 'draw_something', name: 'Disegna un gatto in 30 secondi', type: 'creative', difficulty: 'easy', icon: 'üé®' },
            { id: 'sing_song', name: 'Canta una canzone per 20 secondi', type: 'creative', difficulty: 'easy', icon: 'üéµ' },
            { id: 'dance_moves', name: 'Fai 3 passi di danza', type: 'creative', difficulty: 'easy', icon: 'üíÉ' },
            { id: 'poem_recite', name: 'Recita una poesia di 4 versi', type: 'creative', difficulty: 'medium', icon: 'üìú' },
            { id: 'story_tell', name: 'Racconta una storia in 30 secondi', type: 'creative', difficulty: 'medium', icon: 'üìö' },
            { id: 'impression', name: 'Fai l\'impressione di un animale', type: 'creative', difficulty: 'easy', icon: 'üêí' },
            { id: 'tongue_twister', name: 'Ripeti: "Sopra la panca la capra campa"', type: 'creative', difficulty: 'medium', icon: 'üëÖ' },
            { id: 'mime_act', name: 'Mima "lavarsi i denti"', type: 'creative', difficulty: 'easy', icon: 'üé≠' },
            { id: 'rhyme_game', name: 'Trova 3 rime per "sveglia"', type: 'creative', difficulty: 'medium', icon: 'üéØ' },
            { id: 'charades', name: 'Mima "fare colazione"', type: 'creative', difficulty: 'easy', icon: 'üé™' },
            
            // Sensory Challenges
            { id: 'touch_surfaces', name: 'Tocca 5 superfici diverse', type: 'sensory', difficulty: 'easy', icon: '‚úã' },
            { id: 'smell_identification', name: 'Identifica 3 odori diversi', type: 'sensory', difficulty: 'medium', icon: 'üëÉ' },
            { id: 'temperature_guess', name: 'Indovina la temperatura della stanza', type: 'sensory', difficulty: 'hard', icon: 'üå°Ô∏è' },
            { id: 'sound_identification', name: 'Identifica 3 suoni diversi', type: 'sensory', difficulty: 'medium', icon: 'üëÇ' },
            { id: 'texture_feel', name: 'Trova 3 tessuti diversi', type: 'sensory', difficulty: 'easy', icon: 'üßµ' },
            { id: 'weight_guess', name: 'Indovina il peso di un oggetto', type: 'sensory', difficulty: 'hard', icon: '‚öñÔ∏è' },
            { id: 'color_identification', name: 'Identifica 5 colori nella stanza', type: 'sensory', difficulty: 'easy', icon: 'üé®' },
            { id: 'shape_recognition', name: 'Trova 3 forme geometriche', type: 'sensory', difficulty: 'easy', icon: 'üî∑' },
            { id: 'distance_estimation', name: 'Stima la distanza di un oggetto', type: 'sensory', difficulty: 'medium', icon: 'üìè' },
            { id: 'balance_test', name: 'Stai in equilibrio su un piede per 20 secondi', type: 'sensory', difficulty: 'medium', icon: '‚öñÔ∏è' },
            
            // Social Challenges
            { id: 'call_someone', name: 'Chiama qualcuno e saluta', type: 'social', difficulty: 'easy', icon: 'üìû' },
            { id: 'compliment_mirror', name: 'Fai un complimento allo specchio', type: 'social', difficulty: 'easy', icon: 'ü™û' },
            { id: 'gratitude_list', name: 'Pensa a 3 cose per cui sei grato', type: 'social', difficulty: 'easy', icon: 'üôè' },
            { id: 'positive_affirmation', name: 'Ripeti 3 affermazioni positive', type: 'social', difficulty: 'easy', icon: 'üí™' },
            { id: 'smile_challenge', name: 'Sorridi per 30 secondi', type: 'social', difficulty: 'easy', icon: 'üòä' },
            { id: 'laugh_out_loud', name: 'Ridi ad alta voce per 10 secondi', type: 'social', difficulty: 'easy', icon: 'üòÇ' },
            { id: 'deep_breathing', name: 'Fai 5 respiri profondi', type: 'social', difficulty: 'easy', icon: 'ü´Å' },
            { id: 'meditation_moment', name: 'Medita per 1 minuto', type: 'social', difficulty: 'medium', icon: 'üßò' },
            { id: 'goal_setting', name: 'Pensa a 3 obiettivi per oggi', type: 'social', difficulty: 'easy', icon: 'üéØ' },
            { id: 'self_motivation', name: 'D√¨ a te stesso "Posso farcela!"', type: 'social', difficulty: 'easy', icon: 'üí™' },
            
            // Extreme Challenges
            { id: 'cold_shower', name: 'Fai una doccia fredda di 30 secondi', type: 'extreme', difficulty: 'hard', icon: 'üöø' },
            { id: 'ice_cube_challenge', name: 'Tieni un cubetto di ghiaccio per 30 secondi', type: 'extreme', difficulty: 'hard', icon: 'üßä' },
            { id: 'burpee_burpee', name: 'Fai 20 burpees consecutivi', type: 'extreme', difficulty: 'extreme', icon: 'üî•' },
            { id: 'plank_marathon', name: 'Mantieni il plank per 2 minuti', type: 'extreme', difficulty: 'extreme', icon: 'üèãÔ∏è' },
            { id: 'sprint_challenge', name: 'Fai 5 sprint di 20 secondi', type: 'extreme', difficulty: 'extreme', icon: 'üèÉ' },
            { id: 'jump_rope', name: 'Salta la corda per 2 minuti', type: 'extreme', difficulty: 'hard', icon: 'ü¶ò' },
            { id: 'wall_sit_marathon', name: 'Mantieni il wall sit per 3 minuti', type: 'extreme', difficulty: 'extreme', icon: 'üß±' },
            { id: 'mountain_climber_marathon', name: 'Fai 100 mountain climbers', type: 'extreme', difficulty: 'extreme', icon: '‚õ∞Ô∏è' },
            { id: 'burpee_ladder', name: 'Fai 1, 2, 3, 4, 5 burpees', type: 'extreme', difficulty: 'extreme', icon: 'üî•' },
            { id: 'plank_variations', name: 'Fai 5 variazioni di plank', type: 'extreme', difficulty: 'hard', icon: 'üèãÔ∏è' }
        ];
        
        // Challenge Selection System
        function getRandomChallenge() {
            const randomIndex = Math.floor(Math.random() * secretChallenges.length);
            return secretChallenges[randomIndex];
        }
        
        function getChallengeByDifficulty(difficulty) {
            const filteredChallenges = secretChallenges.filter(challenge => challenge.difficulty === difficulty);
            const randomIndex = Math.floor(Math.random() * filteredChallenges.length);
            return filteredChallenges[randomIndex];
        }
        
        function getChallengeByType(type) {
            const filteredChallenges = secretChallenges.filter(challenge => challenge.type === type);
            const randomIndex = Math.floor(Math.random() * filteredChallenges.length);
            return filteredChallenges[randomIndex];
        }
        
        // Challenge Execution System
        function executeSecretChallenge(challenge) {
            return new Promise((resolve, reject) => {
                // Show challenge modal
                showChallengeModal(challenge);
                
                // Set up challenge completion
                window.currentChallenge = {
                    challenge: challenge,
                    resolve: resolve,
                    reject: reject,
                    startTime: Date.now()
                };
            });
        }
        
        function showChallengeModal(challenge) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay challenge-modal';
            modal.innerHTML = `
                <div class="modal challenge-modal-content">
                    <div class="modal-header">
                        <h3>üéØ Challenge Segreta!</h3>
                        <div class="challenge-icon">${challenge.icon}</div>
                    </div>
                    <div class="modal-body">
                        <div class="challenge-info">
                            <h4>${challenge.name}</h4>
                            <p class="challenge-description">Completa questa challenge per spegnere la sveglia!</p>
                            <div class="challenge-difficulty">
                                <span class="difficulty-badge ${challenge.difficulty}">${challenge.difficulty.toUpperCase()}</span>
                            </div>
                        </div>
                        <div class="challenge-actions">
                            <button class="btn-primary" onclick="completeChallenge()">‚úÖ Completato</button>
                            <button class="btn-secondary" onclick="skipChallenge()">‚è≠Ô∏è Salta</button>
                        </div>
                        <div class="challenge-timer">
                            <span id="challenge-timer">Tempo: 0s</span>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Start timer
            startChallengeTimer();
        }
        
        function startChallengeTimer() {
            const timerElement = document.getElementById('challenge-timer');
            const startTime = Date.now();
            
            const timer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                timerElement.textContent = `Tempo: ${elapsed}s`;
            }, 1000);
            
            window.challengeTimer = timer;
        }
        
        function completeChallenge() {
            if (window.currentChallenge) {
                const elapsed = Math.floor((Date.now() - window.currentChallenge.startTime) / 1000);
                showNotification(`üéâ Challenge completata in ${elapsed}s!`, 'success');
                window.currentChallenge.resolve();
                closeChallengeModal();
            }
        }
        
        function skipChallenge() {
            if (window.currentChallenge) {
                showNotification('‚è≠Ô∏è Challenge saltata - La sveglia continuer√†!', 'warning');
                window.currentChallenge.reject();
                closeChallengeModal();
            }
        }
        
        function closeChallengeModal() {
            const modal = document.querySelector('.challenge-modal');
            if (modal) {
                modal.remove();
            }
            if (window.challengeTimer) {
                clearInterval(window.challengeTimer);
            }
            window.currentChallenge = null;
        }

        // Sound Management
        let currentSound = null;
        let selectedSound = 'classic';
        
        const soundLibrary = {
            classic: {
                name: 'Classica',
                icon: 'üîî',
                description: 'Suoneria classica tradizionale',
                audio: null
            },
            urgent: {
                name: 'Urgente',
                icon: 'üö®',
                description: 'Allarme urgente e insistente',
                audio: null
            },
            nature: {
                name: 'Natura',
                icon: 'üåÖ',
                description: 'Suoni rilassanti della natura',
                audio: null
            },
            electronic: {
                name: 'Elettronica',
                icon: '‚ö°',
                description: 'Suoneria elettronica moderna',
                audio: null
            },
            motivational: {
                name: 'Motivazionale',
                icon: 'üí™',
                description: 'Suoneria energica e motivante',
                audio: null
            },
            custom: {
                name: 'Personalizzata',
                icon: 'üéµ',
                description: 'Carica la tua suoneria',
                audio: null
            }
        };
        
        function playSound(soundType) {
            // Stop current sound
            if (currentSound) {
                currentSound.pause();
                currentSound.currentTime = 0;
            }
            
            // Create audio context for sound generation
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Generate different sounds based on type
            let soundData = generateSoundData(soundType);
            
            // Create audio buffer
            const buffer = audioContext.createBuffer(1, soundData.length, audioContext.sampleRate);
            const channelData = buffer.getChannelData(0);
            
            for (let i = 0; i < soundData.length; i++) {
                channelData[i] = soundData[i];
            }
            
            // Play sound
            const source = audioContext.createBufferSource();
            source.buffer = buffer;
            source.connect(audioContext.destination);
            source.start();
            
            // Update UI
            updateSoundUI(soundType);
        }
        
        function generateSoundData(soundType) {
            const sampleRate = 44100;
            const duration = 2; // 2 seconds
            const length = sampleRate * duration;
            const soundData = new Float32Array(length);
            
            switch (soundType) {
                case 'classic':
                    // Classic alarm sound
                    for (let i = 0; i < length; i++) {
                        const t = i / sampleRate;
                        soundData[i] = 0.3 * Math.sin(2 * Math.PI * 800 * t) * Math.exp(-t * 2);
                    }
                    break;
                    
                case 'urgent':
                    // Urgent alarm sound
                    for (let i = 0; i < length; i++) {
                        const t = i / sampleRate;
                        soundData[i] = 0.5 * Math.sin(2 * Math.PI * 1200 * t) * (Math.sin(2 * Math.PI * 5 * t) + 1) / 2;
                    }
                    break;
                    
                case 'nature':
                    // Nature sound (bird chirping)
                    for (let i = 0; i < length; i++) {
                        const t = i / sampleRate;
                        soundData[i] = 0.2 * Math.sin(2 * Math.PI * 400 * t) * Math.sin(2 * Math.PI * 2 * t);
                    }
                    break;
                    
                case 'electronic':
                    // Electronic sound
                    for (let i = 0; i < length; i++) {
                        const t = i / sampleRate;
                        soundData[i] = 0.3 * Math.sin(2 * Math.PI * 600 * t) * Math.sin(2 * Math.PI * 10 * t);
                    }
                    break;
                    
                case 'motivational':
                    // Motivational sound (ascending tone)
                    for (let i = 0; i < length; i++) {
                        const t = i / sampleRate;
                        const freq = 400 + (t * 200);
                        soundData[i] = 0.4 * Math.sin(2 * Math.PI * freq * t);
                    }
                    break;
                    
                case 'custom':
                    // Custom sound (user upload)
                    for (let i = 0; i < length; i++) {
                        const t = i / sampleRate;
                        soundData[i] = 0.3 * Math.sin(2 * Math.PI * 500 * t) * Math.sin(2 * Math.PI * 3 * t);
                    }
                    break;
            }
            
            return soundData;
        }
        
        function updateSoundUI(soundType) {
            // Remove previous selection
            document.querySelectorAll('.sound-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selection to current option
            const selectedOption = document.querySelector(`[data-sound="${soundType}"]`);
            if (selectedOption) {
                selectedOption.classList.add('selected');
            }
            
            // Update hidden input
            document.getElementById('alarm-sound').value = soundType;
            selectedSound = soundType;
        }
        
        function selectSound(soundType) {
            updateSoundUI(soundType);
        }
        
        // Add click handlers for sound selection
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.sound-option').forEach(option => {
                option.addEventListener('click', function() {
                    const soundType = this.getAttribute('data-sound');
                    selectSound(soundType);
                });
            });
        });


        // Notification system with animations
        function showNotification(message, type = 'info') {
            const notifications = document.getElementById('notifications');
            const notification = document.createElement('div');
            notification.className = `notification ${type} fade-in-scale`;
            notification.textContent = message;
            
            notifications.appendChild(notification);
            
            // Add exit animation before removing
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOut 0.3s ease forwards';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }
            }, 5000);
        }

        // Simulate alarm trigger with animations
        async function simulateAlarm() {
            const statusIndicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            
            // Add shake animation to status indicator
            statusIndicator.className = 'status-indicator ringing shake';
            statusText.textContent = 'ALARME ATTIVO - Completa i challenge!';
            
            // Add bounce animation to status text
            statusText.classList.add('bounce-in');
            
            showNotification('Allarme attivato! üö®', 'warning');
            
            // Show challenges section with animation
            const challengesSection = document.getElementById('challenges-section');
            challengesSection.style.display = 'block';
            challengesSection.classList.add('fade-in-up');
            
            // Add alarm glow effect to the entire app
            document.body.classList.add('alarm-active');
            
            // Execute random secret challenge
            try {
                const randomChallenge = getRandomChallenge();
                await executeSecretChallenge(randomChallenge);
                
                // If challenge completed, show success
                showNotification('üéâ Challenge completata! Sveglia spenta!', 'success');
                stopAlarm();
            } catch (error) {
                // If challenge skipped, continue alarm
                showNotification('‚è≠Ô∏è Challenge saltata! La sveglia continua!', 'warning');
                
                // Try another challenge after 5 seconds
                setTimeout(async () => {
                    try {
                        const anotherChallenge = getRandomChallenge();
                        await executeSecretChallenge(anotherChallenge);
                        showNotification('üéâ Challenge completata! Sveglia spenta!', 'success');
                        stopAlarm();
                    } catch (error) {
                        showNotification('‚è≠Ô∏è Challenge saltata! La sveglia continua!', 'warning');
                    }
                }, 5000);
            }
        }
        
        function stopAlarm() {
            document.body.classList.remove('alarm-active');
            document.getElementById('status-indicator').className = 'status-indicator';
            document.getElementById('status-text').textContent = 'Sistema pronto';
            document.getElementById('challenges-section').style.display = 'none';
        }


        function completeChallenge(challengeId) {
            showNotification('Challenge completato! ‚úÖ', 'success');
            
            // Add success animation to completed challenge
            const challengeElement = document.querySelector(`[onclick="completeChallenge('${challengeId}')"]`);
            if (challengeElement) {
                challengeElement.closest('.alarm-item').classList.add('bounce-in');
                challengeElement.closest('.alarm-item').style.background = 'linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%)';
            }
            
            // Check if all challenges completed
            const remainingChallenges = document.querySelectorAll('.alarm-item');
            if (remainingChallenges.length <= 1) { // Only one challenge left
                // Stop alarm with animation
                setTimeout(() => {
                    const statusIndicator = document.getElementById('status-indicator');
                    const statusText = document.getElementById('status-text');
                    
                    statusIndicator.className = 'status-indicator fade-in-scale';
                    statusText.textContent = 'Sistema pronto';
                    statusText.classList.add('bounce-in');
                    
                    const challengesSection = document.getElementById('challenges-section');
                    challengesSection.style.display = 'none';
                    
                    // Remove alarm active state
                    document.body.classList.remove('alarm-active');
                    
                    showNotification('Allarme spento! üéâ', 'success');
                }, 1000);
            }
        }

    </script>
</body>
</html>
